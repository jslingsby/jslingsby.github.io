---
title: Fire!!!
author: Jasper
date: '2017-05-10'
slug: fire
image: /img/Fire.jpg
categories:
  - All
tags: []
---

```{r, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align="center")
```


<center>![](/img/scienceinprogress/sip1.jpg)</center>

<br>

This is a quick and dirty analysis of the [**CapeNature fire database**](http://bgis.sanbi.org/Projects/Detail/168) to see if the [**major drought**](http://www.ecologi.st/post/2017-04-01-Langrivier/) that is currently being experienced in the Cape Floristic Region has had any impact on the occurrence or extent of wildfires.

<br>

Wildfires are an essential component of fynbos, but components of the fire regime such as return interval need to be within certain bounds of variability to maintain healthy ecosystems. Too frequent fire and many species do not get time to reproduce, too infrequent fire and plants senesce and/or are invaded by thicket and forest species, eventually excluding fire. Another concern is that the weather conditions in the first year or so after fire can have a big impact on community composition and the postfire recovery trajectory. In a [**recent long-term study**](http://www.ecologi.st/post/intensifying-postfire-weather-and-biological-invasion-drive-species-loss-in-fynbos/), some co-authors and I have shown that sites where fires were followed by summers with extreme hot and dry weather showed a significant decline in species diversity. Unfortunately, these extremes are becoming more frequent and intense. I may follow this post up with an analysis of fire*postfire weather to highlight areas that have already suffered abnormal extremes, but don't hold your breath :)

<br>

Note that I can make no guarantees of the accuracy of the fire data. In fact, it is safe to assume that they are far from perfect as the technologies available and the interest in and capacity for mapping fire scars has grown through time. Fire scars are predominantly mapped so that reserve managers know the age of the vegetation, and thus fuel load and fire risk, and there is little incentive to invest time in improving the older records when there are other more pressing issues to deal with. I've excluded all reserves that have no data prior to 1980, and have indicated 1980 on the plots as a suggested date from which we could possibly have more confidence in the data, but this is entirely my own assumption...

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(rgdal)
library(dplyr)
library(maptools)
library(cleangeo)
library(ggplot2)
library(xts)

#giswd="/Users/jasper/Documents/GIS/"

#firelayers <- readOGR(dsn=paste0(giswd, "CFR/All_fires_15_16_gw"), layer="All_fires_15_16_gw", verbose = FALSE)

firelayers <- readShapePoly("/Users/jasper/Documents/GIS/CFR/All_fires_15_16_gw/All_fires_15_16_gw")

firelayers <- firelayers[-which(firelayers$Res_centre%in%c("De Mond", "Anysberg", "Geelkranz", "Goukamma", "Keurbooms", "Driftsands", "Ganzekraal", "Riverlands", "Robberg", "Matjiesrivier", "Walker Bay")),]

dat <- data.frame(Date = as.Date(firelayers$Datestart), Area_Ha = firelayers$Area_ha, Mountain = firelayers$Res_centre, Region = firelayers$Region, Reserve = firelayers$Res_name)

dat <- droplevels(na.omit(dat))

#levels(as.factor(dat$Reserve))

###Calculate number of fires:
dat$Fire <- as.numeric(1)
dxts <- xts(dat[,c(2,6)], order.by = dat$Date)

#Calculate number of summer fires
Summer1 = apply.yearly(dxts[.indexmon(dxts) %in% 9:11]$Fire, "sum", na.rm=F)  # last summer months for all years (note zero-based indexing!)
Summer2 = apply.yearly(dxts[.indexmon(dxts) %in% 0:2]$Fire, "sum", na.rm=F) 
Summer1$Year <- format(index(Summer1),"%Y")
Summer2$Year <- format(index(Summer2),"%Y")
Summer2$Year <- Summer2$Year - 1
names(Summer1)[1] <- "Fires"

Hmm <- merge(as.data.frame(Summer1), as.data.frame(Summer2))
Summer <- data.frame(Year = Hmm$Year, Count.of.fires = rowSums(Hmm[,2:3]), Season = "Summer")

#Calculate number of winter fires
Winter = apply.yearly(dxts[.indexmon(dxts) %in% 3:8]$Fire, "sum", na.rm=F) 
Winter$Year <- format(index(Winter),"%Y")
names(Winter)[1] <- "Count.of.fires"
Winter <- as.data.frame(Winter)
Winter$Season <- "Winter"

Fires <- rbind(Summer, Winter)


###Calculate annual burnt area:
dat$Fire <- as.numeric(1)
dxts <- xts(dat[,c(2,6)], order.by = dat$Date)

#Calculate number of summer fires
Summer1 = apply.yearly(dxts[.indexmon(dxts) %in% 9:11]$Area_Ha, "sum", na.rm=F)  # last summer months for all years (note zero-based indexing!)
Summer2 = apply.yearly(dxts[.indexmon(dxts) %in% 0:2]$Area_Ha, "sum", na.rm=F) 
Summer1$Year <- format(index(Summer1),"%Y")
Summer2$Year <- format(index(Summer2),"%Y")
Summer2$Year <- Summer2$Year - 1
names(Summer1)[1] <- "Fires"

Hmm <- merge(as.data.frame(Summer1), as.data.frame(Summer2))
Summer <- data.frame(Year = Hmm$Year, Burnt.Area.Ha = rowSums(Hmm[,2:3]), Season = "Summer")

#Calculate number of winter fires
Winter = apply.yearly(dxts[.indexmon(dxts) %in% 3:8]$Area_Ha, "sum", na.rm=F) 
Winter$Year <- format(index(Winter),"%Y")
names(Winter)[1] <- "Burnt.Area.Ha"
Winter <- as.data.frame(Winter)
Winter$Season <- "Winter"

BurntArea <- rbind(Summer, Winter)

###Plot

#Number of fires
nf <- ggplot(Fires, aes(Year, y = Count.of.fires, fill=as.factor(Season))) + 
  geom_bar(stat="identity") +
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5)) +
  ylab(bquote("Number of fires")) +
  scale_fill_manual(name="",values=c("#D6604D","#4393C3")) +
  geom_vline(xintercept = 1980, linetype=3)

af <- ggplot(BurntArea, aes(Year, y = Burnt.Area.Ha, fill=as.factor(Season))) + 
  geom_bar(stat="identity") +
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5)) +
  ylab(bquote("Burnt Area (Ha)")) +
  scale_fill_manual(name="",values=c("#D6604D","#4393C3")) +
  geom_vline(xintercept = 1980, linetype=3)

##Fix issues with spatial object to allow plotting fires on map - see https://gis.stackexchange.com/questions/113964/fixing-orphaned-holes-in-r
report <- clgeo_CollectionReport(firelayers)
#summary <- clgeo_SummaryReport(report)
#issues <- report[report$valid == FALSE,]
nv <- clgeo_SuspiciousFeatures(report)
firelayers <- firelayers[-nv,]

##try to clean data
#mysp.clean <- clgeo_Clean(mysp)
##check if they are still errors
#report.clean <- clgeo_CollectionReport(mysp.clean)
#summary.clean <- clgeo_SummaryReport(report.clean)

# Plot fires with ggplot2
firelayers@data$id = rownames(firelayers@data)
firelayers.points = fortify(firelayers, region="id")
firelayers.df = left_join(firelayers.points, firelayers@data, by="id")

map <- ggplot(firelayers.df) + 
aes(long, lat, group = group, fill = "#4393C3") + 
geom_polygon(alpha = 0.5) +
coord_equal() + 
theme(legend.position="none")
```

Here's a map of the fires in space. They essentially cover most of the mountainous regions of the Cape.

```{r, echo = F}
map
```

<br>

Now let's look at the number of fires through time. Note that I have split fires into Winter (April to October) vs Summer (November to March) fires. Given that the Austral summer spans the change in calendar year I have labeled each summer based on the start year, e.g. the 2015/2016 fire season is labelled as the summer of 2015. Also note that the record ends in the winter of 2016 as data for the summer of 2016/2017 are still being compiled.

<br>

```{r, echo=FALSE}
nf
```

<br>

Lots more fires in the last few years, with the top 6 in the last decade. But note that there may be many many small fires (e.g. due to arson) that are easily put out. A better reflection is burnt area as this integrates ignition frequency with the state (i.e. moisture content) of the fuel (i.e. vegetation) and the weather at the time of the fire.

<br>

```{r, echo=FALSE}
af
```

<br>

Still lots more burnt area in the past few years, but interestingly the 1988/1989, 1999/2000 and 2015/2016 fire seasons stand head and shoulders above the rest, while both 2014/2015 and 2015/2016 are in the top 5. It sounds like 2016/2017 may be a little lower in number of fires and burnt area than 2015/2016, but still very high relative to the record.

There are some interestingly low years too (e.g. 1995/1996, 2006/2007, 2013/2014). 

What determined the years with particularly high vs particularly low numbers of fires and burnt area? It looks like I may well have to get stuck into the weather data, but it is likely to be much more complicated than that. A hot, dry year may bear many fires and large burnt areas, but this is not sustainable, because after a few years of these conditions there is less to be burnt. Similarly, one would assume that the accumulation of vegetation biomass is slower in hot, dry years, further reducing the probability of fires in subsequent years. One alternative hypothesis (and there are many) is that frequent fires and hotter, drier weather may shift the system to a grassier state, resulting in more frequent, but less intense fires. Lots of science to be done here...

<br>

```{r, echo = F}
#map

## Histograms of fires by month by region
#m <- ggplot(firelayers.df) + geom_histogram(binwidth=1, #position="dodge", aes(x=Month, fill=Region))

#m
```

