<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Research on Jasper Slingsby</title>
    <link>/categories/research/index.xml</link>
    <description>Recent content in Research on Jasper Slingsby</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy;2016 Your name or company</copyright>
    <atom:link href="/categories/research/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Humans and forests in a changing sea of fire</title>
      <link>/post/fire-shadows/</link>
      <pubDate>Wed, 28 Jun 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/fire-shadows/</guid>
      <description>&lt;center&gt;
&lt;img src=&#34;/img/scienceinprogress/sip1.jpg&#34; /&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;This is a study recently completed by one of my MSc students, Annabelle Rogers, who I co-supervised with Prof &lt;a href=&#34;http://www.biologicalsciences.uct.ac.za/bio/staff/academic/february&#34;&gt;&lt;strong&gt;Ed February&lt;/strong&gt;&lt;/a&gt; and &lt;a href=&#34;https://scholar.google.co.za/citations?user=_FFdaCUAAAAJ&amp;amp;hl=en&#34;&gt;&lt;strong&gt;Glenn Moncrieff&lt;/strong&gt;&lt;/a&gt;. We’re busy writing it up for publication, but here’s a little preview.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;The study was inspired by &lt;a href=&#34;https://researchspace.csir.co.za/dspace/handle/10204/2045&#34;&gt;&lt;strong&gt;this great paper&lt;/strong&gt;&lt;/a&gt; published by Dr Coert Geldenhuys in 1994, explaining how fire determines the distribution of forests in the Southern Cape. You can also read about it, and get a nice intro to our forests, in this interesting &lt;a href=&#34;http://saforestryonline.co.za/articles/southern-cape-forests-survive-largely-unchanged-for-centuries/&#34;&gt;&lt;strong&gt;SA Forestry Online article&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;The premise of the Geldenhuys study was that certain parts of the landscape are protected from fire due to topographic features interacting with the prevailing winds to create “fire shadows”, where fires will rarely occur. Forests establish and expand in these areas, but are periodically “trimmed back” when severe conditions allow fires to burn into the otherwise non-flammable forest edge.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Our hypothesis, beyond confirming the work by Geldenhuys, was that land cover transformation (e.g. urban expansion) is altering the flow of fire through the landscape and creating new or larger fire shadows.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;The footprint of the City of Cape Town has expanded quite drastically since the 1940s, providing a good site for this study. Here’s a little Youtube clip I put together using the 1:50 000 topo maps of the City made available by OpenStreetMaps &lt;a href=&#34;http://htonl.dev.openstreetmap.org/50k-ct/#11/-34.1232/18.7066/c2010&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://youtu.be/qmscq6-25z0&#34;&gt;&lt;img src=&#34;https://i.ytimg.com/vi/qmscq6-25z0/0.jpg&#34; alt=&#34;city of cape town&#34; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Another advantage is that &lt;a href=&#34;https://www.researchgate.net/profile/Zoe_Poulsen/publication/279234745_Changes_in_the_distribution_of_indigenous_forest_in_Table_Mountain_National_Park_during_the_20th_Century/links/57a9c7b508aef300152aa8b3.pdf&#34;&gt;&lt;strong&gt;Zoë Poulsen and Timm Hoffman&lt;/strong&gt;&lt;/a&gt; mapped the change in indigenous forest extent in Table Mountain National Park over the period 1944 to 2008, providing the perfect dataset to validate our models and test our hypothesis.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So, we set Annabelle the task of modelling fire on the Cape Peninsula with and without (i.e. pre-settlement) transformation, to identify areas where the probability of burning may have been affected. This gives us a map of “change in burn probability” and highlights areas that have become fire shadows, which we can compare to the change in forest extent.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;I’m not going to go into the details of the fire modelling, including topographic features, developing a fuel model, wind fields and iterations of random ignitions. If you’d like to know more, you’ll have to wait for the paper. Here I present the burn probability maps and quantify the change in burn probability in relation to forest expansion.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;First, let’s look at the reduction in burn probabilities when we “disrupt” the fire catchments by making the transformed areas non-flammable. I’ll only present the simple case where we use a homogenous fuel model - i.e. all vegetation burns on the Peninsula in the same way. In reality the vegetation types can differ in flammability quite considerably, especially fynbos vs forest.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Here we present the burn probabilities without transformation, the burn probabilities with transformation, and the difference between the two.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;NOTE&lt;/strong&gt;: I present the code from the R statistical programming language used to do the analysis. Just skip these if you are only interested in the story. I’ve tried to write this so that it makes sense without the code, but include the code for Annabelle and other students interested in performing this kind of analysis. Send me a comment below or &lt;a href=&#34;http://www.ecologi.st/contact/&#34;&gt;&lt;strong&gt;email&lt;/strong&gt;&lt;/a&gt; if you feel I haven’t got this right. The code appears in grey boxes, and the output of the code appears either as the images or grey boxes with all lines preceeded by “##”.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(raster)
library(rgdal)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning: package &amp;#39;rgdal&amp;#39; was built under R version 3.4.3&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(spBayes)
library(rgeos)
library(dplyr)
library(ggplot2)
library(cleangeo)

datwd &amp;lt;- &amp;quot;/Users/jasper/Dropbox/SAEON/Projects/Cape Peninsula/FireShadow/&amp;quot;

#Get and stack files
change &amp;lt;- raster(paste0(datwd,&amp;quot;BP/changeHomog_clip.asc&amp;quot;))
proj4string(change) &amp;lt;- &amp;quot;+proj=utm +zone=34 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0&amp;quot;
transformed &amp;lt;- raster(paste0(datwd,&amp;quot;BP/trans_homog_clip.asc&amp;quot;))
proj4string(transformed) &amp;lt;- &amp;quot;+proj=utm +zone=34 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0&amp;quot;
untransformed &amp;lt;- raster(paste0(datwd,&amp;quot;BP/untrans_homog_clip.asc&amp;quot;))
proj4string(untransformed) &amp;lt;- &amp;quot;+proj=utm +zone=34 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0&amp;quot;
untransformed &amp;lt;- projectRaster(untransformed, transformed)

bp &amp;lt;- stack(untransformed, transformed, change)

par(mfrow=c(1,3))
plot(bp[[1]], main = &amp;quot;Untransformed&amp;quot;, col = rev(heat.colors(100)))
plot(bp[[2]], main = &amp;quot;Transformed&amp;quot;, col = rev(heat.colors(100)))
plot(bp[[3]], main = &amp;quot;Change (U - T)&amp;quot;, col = rev(heat.colors(100)))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-06-13-fire-shadows_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;672&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;par(mfrow=c(1,1))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So higher, “redder” values represent a greater probability of burning, but note that positive values in the “change” layer represent reduced burn probability, because it represents the difference &lt;em&gt;Untransformed - Transformed&lt;/em&gt;. Also note that the funny numbers around the border are metres from the South Pole (y-axis) and from the Greenwich Meridian (x-axis), because the data are projected with the &lt;a href=&#34;https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system&#34;&gt;&lt;strong&gt;UTM 34S coordinate reference system&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Where’s your house?&lt;/p&gt;
&lt;p&gt;Now let’s get the forest change layers from Poulsen and Hoffman 2015 and plot forest change around Table Mountain.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;f1944 &amp;lt;- readOGR(paste0(datwd, &amp;quot;forest/forestUTM1944.shp&amp;quot;), &amp;quot;forestUTM1944&amp;quot;) #Get the layers&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## OGR data source with driver: ESRI Shapefile 
## Source: &amp;quot;/Users/jasper/Dropbox/SAEON/Projects/Cape Peninsula/FireShadow/forest/forestUTM1944.shp&amp;quot;, layer: &amp;quot;forestUTM1944&amp;quot;
## with 224 features
## It has 7 fields&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;f2008 &amp;lt;- readOGR(paste0(datwd, &amp;quot;forest/forestUTM2008.shp&amp;quot;), &amp;quot;forestUTM2008&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## OGR data source with driver: ESRI Shapefile 
## Source: &amp;quot;/Users/jasper/Dropbox/SAEON/Projects/Cape Peninsula/FireShadow/forest/forestUTM2008.shp&amp;quot;, layer: &amp;quot;forestUTM2008&amp;quot;
## with 205 features
## It has 15 fields&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;###Ignore this code for now. It&amp;#39;s a nicer way of plotting the map, but...
# f2008[205,] #Orangekloof polygon needs fixing!!!
# f1944@data$id = rownames(f1944@data)
# f1944=gUnionCascaded(f1944,id=f1944$id)%&amp;gt;%
#   gSimplify(0.001,topologyPreserve = T) #Fix topology issues
# 
# f2008@data$id = rownames(f2008@data)
# f2008=gUnionCascaded(f2008,id=f2008$id)%&amp;gt;%
#   gSimplify(0.001,topologyPreserve = T) #Fix topology issues

# map &amp;lt;- ggplot(f2008) + 
# aes(long, lat, group = group, fill = &amp;quot;#4393C3&amp;quot;) + 
# geom_polygon(alpha = 0.5) +
# coord_equal() + 
# theme(legend.position=&amp;quot;none&amp;quot;)

sf1944 &amp;lt;- crop(f1944, extent(255000, 270000, 6230000, 6240000))
#sf2008 &amp;lt;- crop(f2008, extent(255000, 270000, 6230000, 6240000))

plot(sf1944, col = &amp;quot;forestgreen&amp;quot;, border = &amp;quot;white&amp;quot;)
plot(f2008, add = T, col = &amp;quot;green&amp;quot;, border = &amp;quot;white&amp;quot;)
plot(f1944, add = T, col = &amp;quot;forestgreen&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-06-13-fire-shadows_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;672&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Here the dark green is the forest extent in 1944, while the light green indicates the additional forest extent in 2008 - lots of expansion!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now I’d like to overlay the burn probabilities with the areas that were “stable fynbos” vs “stable forest” vs “forest expansion” over the 1944 to 2008 period and show you the difference as boxplots, but to work with them we’ll need them as raster data (i.e. gridded as opposed to polygons). So first I rasterize each layer to a 90m grid and plot fynbos (0 - grey), stable forest (2 - green) and areas of forest expansion (1 - yellow). Please ignore the confusing scale bar.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;fr1944 &amp;lt;- rasterize(f1944, bp, fun = &amp;quot;count&amp;quot;, field = 1, background = 0) #create a raster with &amp;quot;1&amp;quot; where forest occurred
fr2008 &amp;lt;- rasterize(f2008, bp, fun = &amp;quot;count&amp;quot;, field = 1, background = 0) #create a raster with &amp;quot;1&amp;quot; where forest occurred

frDelta &amp;lt;- fr2008 + fr1944

plot(crop(frDelta, extent(255000, 270000, 6230000, 6240000)))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-06-13-fire-shadows_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now we can extract them into one dataframe (i.e. a table of data) and bin them into vegetation change classes…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat &amp;lt;- as.data.frame(na.omit(rasterToPoints(stack(bp, frDelta))))

dat$layer[which(dat$layer == 0)] &amp;lt;- &amp;quot;Stable Fynbos&amp;quot;
dat$layer[which(dat$layer == 1)] &amp;lt;- &amp;quot;Forest Gain&amp;quot;
dat$layer[which(dat$layer %in% c(2,3))] &amp;lt;- &amp;quot;Stable Forest&amp;quot; #Note there is some erroneous overlap in the 2008 polygons

dat$layer &amp;lt;- as.factor(dat$layer)

#write.csv(dat, &amp;quot;/Users/jasper/Dropbox/SAEON/Projects/Cape Peninsula/FireShadow/spBayes/data.csv&amp;quot;)

head(dat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##        x       y untrans_homog_clip trans_homog_clip changeHomog_clip
## 1 259845 6244515           0.066660         0.009665         0.056995
## 2 259935 6244515           0.066940         0.008860         0.058080
## 3 260025 6244515           0.067385         0.008220         0.059165
## 4 260115 6244515           0.067505         0.007085         0.060420
## 5 259665 6244425           0.063040         0.010975         0.052065
## 6 259755 6244425           0.063715         0.010565         0.053150
##           layer
## 1 Stable Fynbos
## 2 Stable Fynbos
## 3 Stable Fynbos
## 4 Stable Fynbos
## 5 Stable Fynbos
## 6 Stable Fynbos&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So there’s the top few lines of the table above. Now we use these data to draw a box and whisker plot of the reduction in burn probability by class. Here the horizontal mid-line represents the midpoint of the observed values for each class (the median), the box represents the upper and lower quartiles (i.e. 50% of the records for each class fall inside the box), the “whiskers” represent ~75% of the data in each class, and the points (i.e. the black smudge above “Stable Fynbos”) represent outliers that are further from the rest of the data than we would expect.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;g &amp;lt;- ggplot(dat)
g &amp;lt;- g + stat_boxplot(aes(y = changeHomog_clip, x = layer, group = layer), position = &amp;quot;dodge&amp;quot;) + 
  ylab(&amp;quot;Reduction in burn probability&amp;quot;) + 
  xlab(&amp;quot;Vegetation Change&amp;quot;)
g #to plot&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-06-13-fire-shadows_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;672&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;That “Forest Gain” and “Stable Forest” have much higher medians and “boxes” clearly indicates that forest has remained stable and/or expanded in the areas where there has been a reduction in burn probability. There are many possible reasons for the “outliers” in the “Stable Fynbos” class, but the two main reasons are likely to be that a) not all fynbos sites that have suffered a reduction in burn probability are able to sustain forest (e.g. too dry), and b) these sites may well be transitioning to forest, but more time is needed for them to do so.&lt;/p&gt;
&lt;p&gt;While this plot looks very convincing, unfortunately it would never fool journal reviewer number three…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=-VRBWLpYCPY&#34;&gt;&lt;img src=&#34;http://img.youtube.com/vi/-VRBWLpYCPY/0.jpg&#34; alt=&#34;journal reviewer number three&#34; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;They’ll argue there’s spatial autocorrelation (i.e. things that are close in space are likely to be similar anyway) and will want to see some fancy spatially explicit statistics that don’t tell you any more than this boxplot.&lt;/p&gt;
&lt;p&gt;So here are some convolutedly fancy stats for those of you who are interested. Skip to the brief discussion at the end if you’re not interested in the stats :)&lt;/p&gt;
&lt;p&gt;We’ll start by thinning the data a little by subsampling. Running a spatially explicit Bayesian model on the ~34000 data points (i.e. 90m grid cells) we have requires a very very big computer, and this is just a blog post. Let’s try 10% of the data and plot it to check that it’s representative of the full dataset (as plotted above).&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;set.seed(1) #Pick a string of random numbers so that we can replicate the sampling

sdat &amp;lt;- dat[sample(1:nrow(dat), nrow(dat)/10),] #Take a 10% sample

g &amp;lt;- ggplot(sdat)
g &amp;lt;- g + stat_boxplot(aes(y = changeHomog_clip, x = layer, group = layer), position = &amp;quot;dodge&amp;quot;) + 
  ylab(&amp;quot;Reduction in burn probability&amp;quot;) + 
  xlab(&amp;quot;Vegetation Change Class&amp;quot;)
g #Plot the sample to see if it is representative of the whole&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-06-13-fire-shadows_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Looks pretty representative.&lt;/p&gt;
&lt;p&gt;It turns out it takes ~12 hours to run the following code on the 10% subset of the data on a x86_64-apple-darwin13.4.0 MacBook Pro (so I’ve commented out the next code chunk so I don’t have to run it each time I compile this blog post). I think we’ll need to run the full dataset on a cluster…&lt;/p&gt;
&lt;p&gt;Skip this section if you’re more interested in the results.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# ### Set up a convolutedly long set of model inputs which I won&amp;#39;t eplain
# B &amp;lt;- as.matrix(c(1:3))
# p &amp;lt;- length(B)
# 
# sigma.sq &amp;lt;- 2
# tau.sq &amp;lt;- 0.1
# phi &amp;lt;- 3/0.5
# 
# n.samples &amp;lt;- 2000
# 
# starting &amp;lt;- list(&amp;quot;phi&amp;quot;=3/0.5, &amp;quot;sigma.sq&amp;quot;=50, &amp;quot;tau.sq&amp;quot;=1)
# 
# tuning &amp;lt;- list(&amp;quot;phi&amp;quot;=0.1, &amp;quot;sigma.sq&amp;quot;=0.1, &amp;quot;tau.sq&amp;quot;=0.1)
# 
# ### Set up 2 sets of different &amp;quot;prior beliefs&amp;quot; to see how much this affects the model - note that I&amp;#39;ve just gone with some simple ones here and should really explore a bigger range
# priors.1 &amp;lt;- list(&amp;quot;beta.Norm&amp;quot;=list(rep(0,p), diag(1000,p)),
#                  &amp;quot;phi.Unif&amp;quot;=c(3/1, 3/0.1), &amp;quot;sigma.sq.IG&amp;quot;=c(2, 2),
#                  &amp;quot;tau.sq.IG&amp;quot;=c(2, 0.1))
# 
# priors.2 &amp;lt;- list(&amp;quot;beta.Flat&amp;quot;, &amp;quot;phi.Unif&amp;quot;=c(3/1, 3/0.1),
#                  &amp;quot;sigma.sq.IG&amp;quot;=c(2, 2), &amp;quot;tau.sq.IG&amp;quot;=c(2, 0.1))
# 
# ### Choose a model for the spatial autocorrelation
# cov.model &amp;lt;- &amp;quot;exponential&amp;quot; #A very rapid decay model. This should be fair for our data, but I&amp;#39;ll need to play with this for publication
# 
# n.report &amp;lt;- 500
# verbose &amp;lt;- TRUE
# 
# ###Run the models
# m.1 &amp;lt;- spLM(changeHomog_clip~layer, coords=as.matrix(sdat[,1:2]),
#             data = sdat, starting=starting,
#             tuning=tuning, priors=priors.1, cov.model=cov.model,
#             n.samples=n.samples, verbose=verbose, n.report=n.report)
# 
# m.2 &amp;lt;- spLM(changeHomog_clip~layer, coords=as.matrix(sdat[,1:2]),
#             data = sdat, starting=starting,
#             tuning=tuning, priors=priors.2, cov.model=cov.model,
#             n.samples=n.samples, verbose=verbose, n.report=n.report)
# 
# burn.in &amp;lt;- 0.5*n.samples
# 
# ###Recover beta and spatial random effects
# m.1 &amp;lt;- spRecover(m.1, start=burn.in, verbose=FALSE)
# m.2 &amp;lt;- spRecover(m.2, start=burn.in, verbose=FALSE)
# 
# round(summary(m.1$p.theta.recover.samples)$quantiles[,c(3,1,5)],2)
# round(summary(m.2$p.theta.recover.samples)$quantiles[,c(3,1,5)],2)
# 
# round(summary(m.1$p.beta.recover.samples)$quantiles[,c(3,1,5)],2)
# round(summary(m.2$p.beta.recover.samples)$quantiles[,c(3,1,5)],2)
# 
# m.1.w.summary &amp;lt;- summary(mcmc(t(m.1$p.w.recover.samples)))$quantiles[,c(3,1,5)]
# m.2.w.summary &amp;lt;- summary(mcmc(t(m.2$p.w.recover.samples)))$quantiles[,c(3,1,5)]
#
# save(m.1, paste0(datwd, &amp;quot;model1.RData&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Here’s one I prepared earlier ;)&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;load(paste0(datwd, &amp;quot;model1.RData&amp;quot;)) #Get previously run model output

#round(summary(m.1$p.theta.recover.samples)$quantiles,2) #If you&amp;#39;re running this code this gives you the spatial autocorrelation estimates

round(summary(m.1$p.beta.recover.samples)$quantiles,3)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                      2.5%    25%    50%    75%  97.5%
## (Intercept)         0.009  0.016  0.020  0.024  0.032
## layerStable Forest -0.015 -0.005  0.000  0.004  0.013
## layerStable Fynbos -0.031 -0.023 -0.019 -0.015 -0.008&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So this gives us the median (50%) and quantiles (0.025, 0.25, 0.75, 0.975) of the posterior probability distributions of the estimated average values for each class. “Forest Gain” is the intercept, which is all positive (i.e. lower probability of burning), and overlaps with “Stable Forest”, but does not overlap with “Stable Fynbos”, which confirms what we knew already! Although it’s a little difficult to interpret. Let’s try a boxplot to illustrate this more clearly.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;- as.data.frame(round(summary(m.1$p.beta.recover.samples)$quantiles,3))

rownames(x) &amp;lt;- levels(sdat$layer)
colnames(x) &amp;lt;- c(&amp;quot;min&amp;quot;, &amp;quot;lower&amp;quot;, &amp;quot;mid&amp;quot;, &amp;quot;upper&amp;quot;, &amp;quot;max&amp;quot;)
  
#m.1.w.summary &amp;lt;- summary(mcmc(t(m.1$p.w.recover.samples)))$quantiles[,c(3,1,5)]

Pa &amp;lt;-  ggplot(x,aes(rownames(x))) +
  geom_boxplot(aes(ymin=min,lower=lower,middle=mid,upper=upper,ymax=max),
              stat=&amp;quot;identity&amp;quot;) +
   ylab(&amp;quot;Reduction in burn probability&amp;quot;) + xlab(&amp;quot;Vegetation Change Class&amp;quot;)

Pa&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-06-13-fire-shadows_files/figure-html/unnamed-chunk-10-1.png&#34; width=&#34;672&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So the forest expanded at sites where the probability of burning has been reduced, because land cover transformation has created new “fire shadows”. Null hypothesis accepted?&lt;/p&gt;
&lt;p&gt;Note that there are a bunch of assumptions etc that I haven’t included here. E.g. having more people usually increases ignitions, resulting in more fires. This may also have a biased spatial pattern, like fires are most likely to start along the wildland-urban interface, etc.&lt;/p&gt;
&lt;p&gt;Either way, I think there are many reasons why this analysis is interesting despite it’s flaws, and I suspect the story is at least partially true. The real question is how can we manage this? Do we allow these areas to succeed to forest, despite the loss of fynbos biodiversity at these sites? And the risk of catestrophically big fires if a fire is started in the ~50-100 year period while the fynbos is being invaded by forest and is incredibly flammable?&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;For the reviewer #3’s among you - here are the model diagnostics:&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(m.1$p.beta.recover.samples)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-06-13-fire-shadows_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;672&#34; style=&#34;display: block; margin: auto;&#34; /&gt;&lt;/p&gt;
&lt;p&gt;It looks like the model converged nicely :)&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Intensifying postfire weather and biological invasion drive species loss in fynbos</title>
      <link>/post/intensifying-postfire-weather-and-biological-invasion-drive-species-loss-in-fynbos/</link>
      <pubDate>Fri, 21 Apr 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/intensifying-postfire-weather-and-biological-invasion-drive-species-loss-in-fynbos/</guid>
      <description>&lt;p&gt;After a decade of hard slog I finally had a &lt;a href=&#34;http://www.pnas.org/content/early/2017/04/11/1619014114.abstract&#34;&gt;&lt;strong&gt;study come out this week&lt;/strong&gt;&lt;/a&gt; showing that increasingly prolonged periods of severe hot and dry weather during the first summer after wild fires is inhibiting vegetation recovery and causing loss of plant diversity in the Fynbos. If you don’t have access to the journal through the link above, I made a &lt;a href=&#34;https://www.youtube.com/watch?v=-xSHX8ZK_KM&#34;&gt;&lt;strong&gt;short video&lt;/strong&gt;&lt;/a&gt; explaining the general gist.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=-xSHX8ZK_KM&#34; title=&#34;Climate change impacts in Fynbos at the Cape of Good Hope Section of Table Mountain National Park&#34;&gt;&lt;img src=&#34;http://img.youtube.com/vi/-xSHX8ZK_KM/0.jpg&#34; alt=&#34;Climate change impacts in Fynbos at the Cape of Good Hope Section of Table Mountain National Park&#34; /&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Otherwise &lt;a href=&#34;http://jslingsby.github.io/contact/&#34;&gt;&lt;strong&gt;shoot me a message&lt;/strong&gt;&lt;/a&gt; and I’ll send it to you. Besides being some of the first empirical evidence of a climate change impact on biodiversity in the Fynbos Biome, and in South Africa in general, it is a testament to the importance of long-term research, and taking one’s time to do it. But I’ll get back to that and give you the back history at a later stage. For now, I thought I’d just put it out there, and perhaps say a few words about why this is important.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/leuca.jpg&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Firstly, &lt;em&gt;you may wonder why this paper is important?&lt;/em&gt; While we’ve known that climate change will affect our ecosystems, we haven’t known how much the climate needs to change before we’ll detect an impact, or how that impact plays out in different ecosystems subject to different ecological processes. Our study not only shows that fynbos is already responding to changing climate, it demonstrates an important interaction between fire and climate change that may affect flammable ecosystems worldwide. The more we begin to understand these kinds of interactions and their impacts, the better we can anticipate what is to come, and the more prepared we can be.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/diastella.jpg&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Secondly, &lt;em&gt;why should we care about how fynbos will be affected by climate change?&lt;/em&gt; Beyond it’s sheer spectacular beauty, the usual argument about pharmaceutical potential, and the impact its loss would have on our national pride – fynbos being restricted to South Africa - perhaps the biggest concern is what would fill it’s place? “Nature abhors a vacuum” - to borrow from the physicists - and all indications are that the winners from climate change in the Cape are the invasive species from other Mediterranean type ecosystems like the pines, eucalypts and wattles. These invasive alien plants seriously alter landscape-level processes, using more water than the indigenous vegetation and greatly upping the game in terms of scale and impact of fires (a strong motivation for &lt;a href=&#34;https://www.environment.gov.za/projectsprogrammes#workingfor&#34;&gt;&lt;strong&gt;the Department for Environmental Affairs’ Working for/on programmes&lt;/strong&gt;&lt;/a&gt;). It’s &lt;a href=&#34;http://www.saeon.ac.za/enewsletter/archives/2017/february2017/doc02&#34;&gt;&lt;strong&gt;not like we have a lot of water to spare…&lt;/strong&gt;&lt;/a&gt;, and while everyone was shocked by the March 2015 fires in Cape Town &lt;a href=&#34;http://www.saeon.ac.za/enewsletter/archives/2015/april2015/doc01&#34;&gt;&lt;strong&gt;it’s impacts pale in comparison to those experienced in California, Australia and the Mediterranean Basin&lt;/strong&gt;.&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/deadconocarp.jpg&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Unfortunately our study doesn’t provide any simple solutions for adapting to or mitigating climate change impacts, but it does provide is some indication of which kinds of species seem to be more sensitive, some of which were surprising. For example, until now most researchers believed that species that resprout from underground storage organs after fire should be less sensitive to climate impacts, but we found that these were the most sensitive species. The loss of species that resprout could have serious implications for the post-fire recovery of vegetation, with knock-on effects for important ecosystem processes like hydrology, habitat provision, carbon uptake and the fire regime. This kind of information can guide future research efforts and helps us envision the potential range of future outcomes. Knowing which species may be most sensitive also helps guide monitoring programmes and management efforts like assisted dispersal or ex situ conservation, …if we can find ways to make these options affordable.&lt;/p&gt;
&lt;p&gt;Thanks &lt;a href=&#34;http://ottowhitehead.com/&#34;&gt;&lt;strong&gt;Otto&lt;/strong&gt;&lt;/a&gt; for the great pics!&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>MODIS and Landsat primer for Hannah</title>
      <link>/post/modis-primer-for-hannah/</link>
      <pubDate>Tue, 04 Apr 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/modis-primer-for-hannah/</guid>
      <description>&lt;p&gt;This is a quick primer on how to handle MODIS and Landsat NDVI data from &lt;a href=&#34;https://earthengine.google.com/&#34;&gt;&lt;strong&gt;Google Earth Engine (GEE)&lt;/strong&gt;&lt;/a&gt; in R. It’s primarily for my Honours student, Hannah Simon, but I thought why not make it public for all to share? I first posted the MODIS section and had Hannah play with the Landsat data as a learning exercise, so full credit to her for the Landsat code.&lt;/p&gt;
&lt;p&gt;For a general introduction for many of the functions used and handling spatial data in general see &lt;a href=&#34;https://jslingsby.github.io/post/2017-04-01-PrimerSpatialData/&#34;&gt;&lt;strong&gt;A Primer for Handling Spatial Data in R&lt;/strong&gt;&lt;/a&gt; posted previously.&lt;/p&gt;
&lt;p&gt;We start by getting the necessary libraries:&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#Get libraries
library(raster) #to handle rasters&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Loading required package: methods&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Loading required package: sp&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(rgdal) #to handle shapefiles&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## rgdal: version: 1.1-10, (SVN revision 622)
##  Geospatial Data Abstraction Library extensions to R successfully loaded
##  Loaded GDAL runtime: GDAL 1.11.4, released 2016/01/25
##  Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/3.3/Resources/library/rgdal/gdal
##  Loaded PROJ.4 runtime: Rel. 4.9.1, 04 March 2015, [PJ_VERSION: 491]
##  Path to PROJ.4 shared files: /Library/Frameworks/R.framework/Versions/3.3/Resources/library/rgdal/proj
##  Linking to sp version: 1.2-3&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(reshape) #for data wrangling
library(ggplot2) #for pretty plotting
library(animation) #for silly animations

datwd &amp;lt;- &amp;quot;/Users/jasper/Documents/GIS/CFR/MODISforHannah/&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s start with…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div id=&#34;modis&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;MODIS&lt;/h2&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#Get data
mNDVI &amp;lt;- stack(paste0(datwd, &amp;quot;2017043_MODIS_v1g_JNP_MOD_NDVI.tif&amp;quot;)) #Note that the file has multiple bands so stack() is the easiest way to read all bands

mNDVI #See what the data look like&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterStack 
## dimensions  : 15, 20, 300, 393  (nrow, ncol, ncell, nlayers)
## resolution  : 250, 250  (x, y)
## extent      : 361250, 366250, 6242250, 6246000  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=34 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names       : X2017043_//MOD_NDVI.1, X2017043_//MOD_NDVI.2, X2017043_//MOD_NDVI.3, X2017043_//MOD_NDVI.4, X2017043_//MOD_NDVI.5, X2017043_//MOD_NDVI.6, X2017043_//MOD_NDVI.7, X2017043_//MOD_NDVI.8, X2017043_//MOD_NDVI.9, X2017043_//OD_NDVI.10, X2017043_//OD_NDVI.11, X2017043_//OD_NDVI.12, X2017043_//OD_NDVI.13, X2017043_//OD_NDVI.14, X2017043_//OD_NDVI.15, ... 
## min values  :                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768, ... 
## max values  :                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767, ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So we’ve pulled in the full record of NDVI from the “MODIS/MOD13Q1 16-day composite vegetation indices” product from the dawn of time (i.e. the 18th February 2000) until as recent as possible (6th March 2017), but you’ll notice the names in the raster, e.g. X2017043_MODIS_v1g_JNP_MOD_NDVI.1 aren’t very informative, simply numbering the layers from 1 to 393, but not giving us the dates… For some reason I still haven’t worked out how to embed the dates in the .tif raster exported from GEE, so I save them manually from the console into a text file (stone age, I know, sorry…).&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;metdat &amp;lt;- read.delim(paste0(datwd, &amp;quot;MODIS_metadata.txt&amp;quot;), sep = &amp;quot; &amp;quot;, header = F)

head(metdat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   V1    V2                                   V3 V4    V5
## 1 0: Image MODIS/MOD13Q1/MOD13Q1_005_2000_02_18 (1 band)
## 2 1: Image MODIS/MOD13Q1/MOD13Q1_005_2000_03_05 (1 band)
## 3 2: Image MODIS/MOD13Q1/MOD13Q1_005_2000_03_21 (1 band)
## 4 3: Image MODIS/MOD13Q1/MOD13Q1_005_2000_04_06 (1 band)
## 5 4: Image MODIS/MOD13Q1/MOD13Q1_005_2000_04_22 (1 band)
## 6 5: Image MODIS/MOD13Q1/MOD13Q1_005_2000_05_08 (1 band)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Still not pretty, but getting closer…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;date &amp;lt;- substr(metdat[,3], start = 27, stop = 37)
date[1:5]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;2000_02_18&amp;quot; &amp;quot;2000_03_05&amp;quot; &amp;quot;2000_03_21&amp;quot; &amp;quot;2000_04_06&amp;quot; &amp;quot;2000_04_22&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;With a bit of squint-counting and trial and error we manage to use substr() to extract the dates!&lt;/p&gt;
&lt;p&gt;But for R to treat them as dates we need to tell it they are dates with as.Date(), and specify the date format (see ?strptime).&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;date &amp;lt;- as.Date(date, format = &amp;quot;%Y_%m_%d&amp;quot;)
date[1:5]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;2000-02-18&amp;quot; &amp;quot;2000-03-05&amp;quot; &amp;quot;2000-03-21&amp;quot; &amp;quot;2000-04-06&amp;quot; &amp;quot;2000-04-22&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Et voilà!&lt;/p&gt;
&lt;p&gt;So we now have a stack of MODIS NDVI images through time, and we know their dates. We can embed the dates into the raster like so:&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;names(mNDVI) &amp;lt;- date

mNDVI #Have another look at the data&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterStack 
## dimensions  : 15, 20, 300, 393  (nrow, ncol, ncell, nlayers)
## resolution  : 250, 250  (x, y)
## extent      : 361250, 366250, 6242250, 6246000  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=34 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names       : X2000.02.18, X2000.03.05, X2000.03.21, X2000.04.06, X2000.04.22, X2000.05.08, X2000.05.24, X2000.06.09, X2000.06.25, X2000.07.11, X2000.07.27, X2000.08.12, X2000.08.28, X2000.09.13, X2000.09.29, ... 
## min values  :      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768, ... 
## max values  :       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767, ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Great! But now you’ll notice that the min and max values are rather strange (-32767 to 32767) when we know that NDVI can only range from -1 to 1, and rarely goes below 0. Very strange! Let’s have a look at our first image.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(mNDVI[[1]])&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;0 to 4000? Even stranger!&lt;/p&gt;
&lt;p&gt;It turns out the issue is that GEE has exported the data in what appears to be a strange format to reduce the file size. We need to tell R how to interpret it by setting a gain and offset.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;NAvalue(mNDVI)=-32767
offs(mNDVI)=0
gain(mNDVI)=.0001
plot(mNDVI[[1]])&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-8-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Much more reasonable!&lt;/p&gt;
&lt;p&gt;Ok, so now we can begin to look at our questions; namely, how does MODIS NDVI vary in space and time?&lt;/p&gt;
&lt;p&gt;But first, we should set our focal area.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;site &amp;lt;- readOGR(dsn=paste0(datwd, &amp;quot;Jonaskop 120m.kml&amp;quot;), layer=&amp;quot;Jonaskop 120m.kml&amp;quot;) # A Google Earth KML file&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## OGR data source with driver: KML 
## Source: &amp;quot;/Users/jasper/Documents/GIS/CFR/MODISforHannah/Jonaskop 120m.kml&amp;quot;, layer: &amp;quot;Jonaskop 120m.kml&amp;quot;
## with 1 features
## It has 2 fields&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning in readOGR(dsn = paste0(datwd, &amp;quot;Jonaskop 120m.kml&amp;quot;), layer =
## &amp;quot;Jonaskop 120m.kml&amp;quot;): Z-dimension discarded&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;site &amp;lt;- spTransform(site, CRS(proj4string(mNDVI))) #Reproject to match the projection of the MODIS data (UTM 34S in this case)

plot(mNDVI[[1]])
plot(site, add=T)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-9-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;It looks like we’re wrangling a lot more MODIS data than we need to. Let’s crop to out focal area…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;mNDVI &amp;lt;- crop(mNDVI, site, snap = &amp;quot;out&amp;quot;) #&amp;quot;snap=&amp;quot;out&amp;quot;&amp;quot; adds a buffer around the site

plot(mNDVI[[1]])
plot(site, add=T)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-10-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;…and look at a few images through time.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(mNDVI) #Note that R limits it to the first 16 images&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Lots of variation in space! What about time?&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if(!file.exists(&amp;quot;/Users/jasper/GIT/jslingsby.github.io_local/static/img/output/mNDVI.gif&amp;quot;)) { # Check if the file exists
  saveGIF({
    for (i in 1:dim(mNDVI)[3]) plot(mNDVI[[i]],
                      main=names(mNDVI)[i],
                      legend.lab=&amp;quot;NDVI&amp;quot;,
                      col=rev(terrain.colors(length(c(seq(0,.7,.05),1)))),
                      breaks=seq(0,.7,.05))}, 
    movie.name = &amp;quot;/Users/jasper/GIT/jslingsby.github.io_local/static/img/output/mNDVI.gif&amp;quot;, 
    ani.width = 600, ani.height = 500, 
    interval=.25)
}&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/output/mNDVI.gif&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;*NOTE: this writes a .gif to file and does not render in R (or R notebook), so I had to insert it in the Markdown script.&lt;/p&gt;
&lt;p&gt;You could make it a lot prettier, but still pretty fancy. Not very useful for the print edition though. How about just a simple line graph? this requires extracting the data to a data.frame.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat &amp;lt;- as.data.frame(mNDVI)

dat[1:10,1:10] #look at the data&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    X2000.02.18 X2000.03.05 X2000.03.21 X2000.04.06 X2000.04.22 X2000.05.08
## 1       0.2889      0.3280      0.3723      0.3743      0.3979      0.3902
## 2       0.3127      0.3745      0.3850      0.3872      0.3680      0.4681
## 3       0.3205      0.3508      0.3909      0.3878      0.3647      0.4488
## 4       0.3256      0.3323      0.3823      0.4001      0.3542      0.4050
## 5       0.3206      0.3841      0.3934      0.3817      0.3864      0.3987
## 6       0.2866      0.3567      0.3723      0.3757      0.3799      0.4278
## 7       0.2866      0.3567      0.3832      0.3808      0.3510      0.4681
## 8       0.3340      0.3709      0.4215      0.3787      0.4191      0.4681
## 9       0.3205      0.4144      0.4215      0.4099      0.3900      0.4615
## 10      0.3256      0.4278      0.4363      0.4085      0.4115      0.4615
##    X2000.05.24 X2000.06.09 X2000.06.25 X2000.07.11
## 1       0.4644      0.4777      0.4730      0.4220
## 2       0.4704      0.4777      0.4730      0.4289
## 3       0.4698      0.4574      0.4340      0.4532
## 4       0.4596      0.4574      0.4636      0.4228
## 5       0.4522      0.4193      0.4636      0.4517
## 6       0.4493      0.4538      0.4091      0.4160
## 7       0.4043      0.4913      0.4730      0.4359
## 8       0.4885      0.4913      0.4616      0.4300
## 9       0.4318      0.4589      0.4908      0.4363
## 10      0.4212      0.4413      0.4697      0.4489&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So each date is a column and each cell in space is a row in our data frame. This isn’t ideal for plotting so let’s reshape the data into long format.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rownames(dat) &amp;lt;- paste0(&amp;quot;A&amp;quot;,1:20) #Add dummy column labels

dat &amp;lt;- as.data.frame(t(dat)) #transpose data.frame

dat$Date &amp;lt;- as.Date(rownames(dat), format = &amp;quot;X%Y.%m.%d&amp;quot;)

dat &amp;lt;- melt(dat, id=c(&amp;quot;Date&amp;quot;))

head(dat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##         Date variable  value
## 1 2000-02-18       A1 0.2889
## 2 2000-03-05       A1 0.3280
## 3 2000-03-21       A1 0.3723
## 4 2000-04-06       A1 0.3743
## 5 2000-04-22       A1 0.3979
## 6 2000-05-08       A1 0.3902&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s make some pretty pictures!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(data = dat, aes(x = Date, y = value, colour = variable)) + geom_line()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-15-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Pretty neat! It looks like our site burnt in the summer of 2000/2001. Now let’s split them up.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(data = dat, aes(x = Date, y = value, colour = variable)) + geom_line() + facet_wrap(~variable)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-16-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Well there’s definitely clear seasonality and, while subtle, there are differences among the cells. What do we see with…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;landsat&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Landsat&lt;/h2&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;First we read in the full record of data for Landsat 8 for our area of interest.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;lsNDVI &amp;lt;- stack(paste0(datwd,&amp;quot;Landsat/2017045_v1_LC8_L1T_TOA_Jonaskop_daily__2013-04-15-2017-03-25.tif&amp;quot;)) #note that I have used LC8 (LandSat 8)
lsNDVI&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterStack 
## dimensions  : 114, 157, 17898, 154  (nrow, ncol, ncell, nlayers)
## resolution  : 30, 30  (x, y)
## extent      : 361320, 366030, 6242370, 6245790  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=34 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names       : X2017045_//17.03.25.1, X2017045_//17.03.25.2, X2017045_//17.03.25.3, X2017045_//17.03.25.4, X2017045_//17.03.25.5, X2017045_//17.03.25.6, X2017045_//17.03.25.7, X2017045_//17.03.25.8, X2017045_//17.03.25.9, X2017045_//7.03.25.10, X2017045_//7.03.25.11, X2017045_//7.03.25.12, X2017045_//7.03.25.13, X2017045_//7.03.25.14, X2017045_//7.03.25.15, ... 
## min values  :                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768, ... 
## max values  :                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767, ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Then the metadata with dates.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;metdat2 &amp;lt;- read.delim(paste0(datwd,&amp;quot;Landsat/LC8_L1T_TOA_metadata.txt&amp;quot;), sep = &amp;quot; &amp;quot;, header = F) 
head(metdat2) #first few rows of metdat&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   V1         V2
## 1 0: 2013-04-15
## 2 1: 2013-04-22
## 3 2: 2013-05-17
## 4 3: 2013-05-24
## 5 4: 2013-06-09
## 6 5: 2013-06-18&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tail(metdat2) #last few rows of metdat (our data goes up to 25th march, 2017)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##       V1         V2
## 149 148: 2017-02-12
## 150 149: 2017-02-21
## 151 150: 2017-02-28
## 152 151: 2017-03-09
## 153 152: 2017-03-16
## 154 153: 2017-03-25&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Extract the dates, embed into the raster and have a look at the first scene.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;date2 &amp;lt;- substr(metdat2[,2], start = 0, stop = 10) #will extract YYYY_MM_DD
names(lsNDVI) &amp;lt;- date2 #assign the date to the &amp;#39;names&amp;#39; of each NDVI value
plot(lsNDVI[[1]]) &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-19-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Looks good, but the scale’s all wrong again, so we need to fix the gain and offset&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;NAvalue(lsNDVI)=0
offs(lsNDVI)=-1.5
gain(lsNDVI)=.001
plot(lsNDVI[[1]])
plot(site, add=T)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-20-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Better! But still suspiscious… Note that I hacked the offset at -1.5 (it’s usually 2) I’ll need to recheck what the gain and offset values should be and fix this later…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s zoom in on our focal site&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;lsNDVI &amp;lt;- crop(lsNDVI, site, snap = &amp;quot;out&amp;quot;) #&amp;quot;snap=&amp;quot;out&amp;quot;&amp;quot; adds a buffer around the site

plot(lsNDVI[[1]])
plot(site, add=T)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-21-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s have a look at the variation in both space and time.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(lsNDVI)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-22-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Lots of errors because of NA’s! It looks like some scenes are empty, while others are dominated by cloud (we applied a cloud masking algorithm in GEE). We’ll need to get rid of these. Note that this isn’t a problem with the MODIS data, because the MODIS data are an 8-day composite based on 2 scenes per day (i.e the choice of 16 scenes to make up one complete one). We can easily exclude the blank Landsat scenes by identifying those with NA values only (if the minimum or maximum value is NA, then there are no values other than NA).&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;metdat2 &amp;lt;- metdat2[-which(is.na(minValue(lsNDVI))),] #Drop empty scenes from metadata
lsNDVI &amp;lt;- lsNDVI[[-which(is.na(minValue(lsNDVI)))]] #Drop empty scenes from rasterStack&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now we can look at variation through time using an animation as we did before. Note that in the previous plots the colour range varies. For the animation we need to set a fixed colour range so that a particular shade of green or yellow represents the same value across scenes. For the Landsat data these range from 0.255 to 0.555&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if(!file.exists(&amp;quot;/Users/jasper/GIT/jslingsby.github.io_local/static/img/output/lsNDVI.gif&amp;quot;)) { # Check if the file exists
  saveGIF({
    for (i in 1:dim(lsNDVI)[3]) plot(lsNDVI[[i]],
                      main=names(lsNDVI)[i],
                      legend.lab=&amp;quot;NDVI&amp;quot;,
                      col=rev(terrain.colors(length(c(seq(min(minValue(lsNDVI)),max(maxValue(lsNDVI)),.01),1)))),
                      breaks=seq(min(minValue(lsNDVI)),max(maxValue(lsNDVI)),.01))}, 
    movie.name = &amp;quot;/Users/jasper/GIT/jslingsby.github.io_local/static/img/output/lsNDVI.gif&amp;quot;, 
    ani.width = 600, ani.height = 500, 
    interval=.25)
}&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/output/lsNDVI.gif&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Looks like there’s generally lower NDVI in the lower righthand corner parhaps?&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Let’s look at some time-series graphs. First the data wrangling, then plotting; following just about the same formula as for the MODIS data.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ldat &amp;lt;- as.data.frame(lsNDVI)

#ldat[1:10,1:10] #look at the data

rownames(ldat) &amp;lt;- paste0(1:nrow(ldat)) #dummy column labels

ldat &amp;lt;- as.data.frame(t(ldat)) #transpose data.frame

ldat$Date &amp;lt;- as.Date(rownames(ldat), format = &amp;quot;X%Y.%m.%d&amp;quot;)

ldat &amp;lt;- melt(ldat, id=c(&amp;quot;Date&amp;quot;))

colnames(ldat)&amp;lt;- c(&amp;quot;Date&amp;quot;,&amp;quot;Pixel.Number&amp;quot;,&amp;quot;NDVI.Value&amp;quot;)

#head(ldat)

NDVIplot2 &amp;lt;- ggplot(data = ldat, aes(x = Date, y = NDVI.Value, colour = Pixel.Number)) + geom_line() + theme(legend.position=&amp;quot;none&amp;quot;) #remove legend as plot space cannot accommodate it - there are &amp;gt;800 pixels!

NDVIplot2 &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-25-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So we still pick up some nice seasonality! Note this is “zoom in” on just the last ~4 years. It is a bit messy with all &amp;gt;800 pixels though, so let’s select just a few.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Converting a rasterStack into a data.frame fills the dataframe with raster cell values by row from left to right and numbers them. We know there are 28 rows and 31 columns (= 868 pixels), so we can use this to sample cells of interest.&lt;/p&gt;
&lt;p&gt;This is how the grid is numbered:&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;matrix(1:868, 28, 31, byrow = T)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
##  [1,]    1    2    3    4    5    6    7    8    9    10    11    12    13
##  [2,]   32   33   34   35   36   37   38   39   40    41    42    43    44
##  [3,]   63   64   65   66   67   68   69   70   71    72    73    74    75
##  [4,]   94   95   96   97   98   99  100  101  102   103   104   105   106
##  [5,]  125  126  127  128  129  130  131  132  133   134   135   136   137
##  [6,]  156  157  158  159  160  161  162  163  164   165   166   167   168
##  [7,]  187  188  189  190  191  192  193  194  195   196   197   198   199
##  [8,]  218  219  220  221  222  223  224  225  226   227   228   229   230
##  [9,]  249  250  251  252  253  254  255  256  257   258   259   260   261
## [10,]  280  281  282  283  284  285  286  287  288   289   290   291   292
## [11,]  311  312  313  314  315  316  317  318  319   320   321   322   323
## [12,]  342  343  344  345  346  347  348  349  350   351   352   353   354
## [13,]  373  374  375  376  377  378  379  380  381   382   383   384   385
## [14,]  404  405  406  407  408  409  410  411  412   413   414   415   416
## [15,]  435  436  437  438  439  440  441  442  443   444   445   446   447
## [16,]  466  467  468  469  470  471  472  473  474   475   476   477   478
## [17,]  497  498  499  500  501  502  503  504  505   506   507   508   509
## [18,]  528  529  530  531  532  533  534  535  536   537   538   539   540
## [19,]  559  560  561  562  563  564  565  566  567   568   569   570   571
## [20,]  590  591  592  593  594  595  596  597  598   599   600   601   602
## [21,]  621  622  623  624  625  626  627  628  629   630   631   632   633
## [22,]  652  653  654  655  656  657  658  659  660   661   662   663   664
## [23,]  683  684  685  686  687  688  689  690  691   692   693   694   695
## [24,]  714  715  716  717  718  719  720  721  722   723   724   725   726
## [25,]  745  746  747  748  749  750  751  752  753   754   755   756   757
## [26,]  776  777  778  779  780  781  782  783  784   785   786   787   788
## [27,]  807  808  809  810  811  812  813  814  815   816   817   818   819
## [28,]  838  839  840  841  842  843  844  845  846   847   848   849   850
##       [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24]
##  [1,]    14    15    16    17    18    19    20    21    22    23    24
##  [2,]    45    46    47    48    49    50    51    52    53    54    55
##  [3,]    76    77    78    79    80    81    82    83    84    85    86
##  [4,]   107   108   109   110   111   112   113   114   115   116   117
##  [5,]   138   139   140   141   142   143   144   145   146   147   148
##  [6,]   169   170   171   172   173   174   175   176   177   178   179
##  [7,]   200   201   202   203   204   205   206   207   208   209   210
##  [8,]   231   232   233   234   235   236   237   238   239   240   241
##  [9,]   262   263   264   265   266   267   268   269   270   271   272
## [10,]   293   294   295   296   297   298   299   300   301   302   303
## [11,]   324   325   326   327   328   329   330   331   332   333   334
## [12,]   355   356   357   358   359   360   361   362   363   364   365
## [13,]   386   387   388   389   390   391   392   393   394   395   396
## [14,]   417   418   419   420   421   422   423   424   425   426   427
## [15,]   448   449   450   451   452   453   454   455   456   457   458
## [16,]   479   480   481   482   483   484   485   486   487   488   489
## [17,]   510   511   512   513   514   515   516   517   518   519   520
## [18,]   541   542   543   544   545   546   547   548   549   550   551
## [19,]   572   573   574   575   576   577   578   579   580   581   582
## [20,]   603   604   605   606   607   608   609   610   611   612   613
## [21,]   634   635   636   637   638   639   640   641   642   643   644
## [22,]   665   666   667   668   669   670   671   672   673   674   675
## [23,]   696   697   698   699   700   701   702   703   704   705   706
## [24,]   727   728   729   730   731   732   733   734   735   736   737
## [25,]   758   759   760   761   762   763   764   765   766   767   768
## [26,]   789   790   791   792   793   794   795   796   797   798   799
## [27,]   820   821   822   823   824   825   826   827   828   829   830
## [28,]   851   852   853   854   855   856   857   858   859   860   861
##       [,25] [,26] [,27] [,28] [,29] [,30] [,31]
##  [1,]    25    26    27    28    29    30    31
##  [2,]    56    57    58    59    60    61    62
##  [3,]    87    88    89    90    91    92    93
##  [4,]   118   119   120   121   122   123   124
##  [5,]   149   150   151   152   153   154   155
##  [6,]   180   181   182   183   184   185   186
##  [7,]   211   212   213   214   215   216   217
##  [8,]   242   243   244   245   246   247   248
##  [9,]   273   274   275   276   277   278   279
## [10,]   304   305   306   307   308   309   310
## [11,]   335   336   337   338   339   340   341
## [12,]   366   367   368   369   370   371   372
## [13,]   397   398   399   400   401   402   403
## [14,]   428   429   430   431   432   433   434
## [15,]   459   460   461   462   463   464   465
## [16,]   490   491   492   493   494   495   496
## [17,]   521   522   523   524   525   526   527
## [18,]   552   553   554   555   556   557   558
## [19,]   583   584   585   586   587   588   589
## [20,]   614   615   616   617   618   619   620
## [21,]   645   646   647   648   649   650   651
## [22,]   676   677   678   679   680   681   682
## [23,]   707   708   709   710   711   712   713
## [24,]   738   739   740   741   742   743   744
## [25,]   769   770   771   772   773   774   775
## [26,]   800   801   802   803   804   805   806
## [27,]   831   832   833   834   835   836   837
## [28,]   862   863   864   865   866   867   868&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So let’s take a few from the bottom right (where the NDVI is generally low):&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;lowc &amp;lt;- c(614, 617, 707, 710)
highc &amp;lt;- c(128, 131, 221, 224)

lowdat &amp;lt;- subset(ldat, Pixel.Number%in%lowc)
highdat &amp;lt;- subset(ldat, Pixel.Number%in%highc)

NDVIplot_low &amp;lt;- ggplot(data = lowdat, aes(x = Date, y = NDVI.Value, colour = Pixel.Number)) + geom_line() #+ theme(legend.position=&amp;quot;none&amp;quot;) #remove legend as plot space cannot accommodate it - there are &amp;gt;800 pixels!

NDVIplot_low &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-27-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;And a few from the top left (where the NDVI is generally high):&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;NDVIplot_high &amp;lt;- ggplot(data = highdat, aes(x = Date, y = NDVI.Value, colour = Pixel.Number)) + geom_line() #+ theme(legend.position=&amp;quot;none&amp;quot;) #remove legend as plot space cannot accommodate it - there are &amp;gt;800 pixels!

NDVIplot_high&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-28-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>