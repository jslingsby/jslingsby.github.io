<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>R Tutorials on Jasper Slingsby</title>
    <link>/categories/r-tutorials/index.xml</link>
    <description>Recent content in R Tutorials on Jasper Slingsby</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>&amp;copy;2018 Jasper Slingsby</copyright>
    <atom:link href="/categories/r-tutorials/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Handling Spatial Data in R - #3. Big Data and Memory Management</title>
      <link>/post/big-spatial-data/</link>
      <pubDate>Thu, 30 Aug 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/big-spatial-data/</guid>
      <description>&lt;div id=&#34;TOC&#34;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#the-basics&#34;&gt;The Basics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#interlude&#34;&gt;Interlude&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#doing-gis-from-r&#34;&gt;Doing GIS &lt;em&gt;from&lt;/em&gt; R&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Since I first started maintaining blog posts on handling spatial data in R perhaps the most common question I’ve received is “How do I handle big spatial data in R?”. I thought its finally time to provide a blog post to deal with this particular topic. The answer of course is that there are many, many ways.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now I know those of you who have asked me in person are thinking “That’s not what he said when I asked?”, he said “That depends on what you mean by big spatial data?”, which was cryptic and unhelpful. I hope this blog post convinces you that both are valid answers and need to be unpacked together.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Note that for now I’ll address raster data only, but I hope to add to this post (or create another) for vector data. Either way, many of the principals I’ll demonatrate apply for any R coding exercise no matter what the data or objective. For those needing to work with large vector data I recommend you have a look at &lt;a href=&#34;https://cran.r-project.org/web/packages/sf/index.html&#34;&gt;&lt;strong&gt;Simple Features for R - library(sf)&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;I should point out before we get started that while some of what I cover here may help speed up processing, that is not the focus of this post. My goal here is to help you avoid slowing yourself down. I will not cover topics like parallel processing (although I touched on it in my &lt;a href=&#34;http://www.ecologi.st/post/spatial-data-in-r-2-a-practical-example/#going-parallel&#34;&gt;&lt;strong&gt;previous post&lt;/strong&gt;&lt;/a&gt;) or processing rasters in chunks - for the latter see &lt;a href=&#34;https://cran.r-project.org/web/packages/raster/vignettes/functions.pdf&#34;&gt;&lt;strong&gt;this vignette&lt;/strong&gt;&lt;/a&gt; for library(raster).&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div id=&#34;the-basics&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;The Basics&lt;/h3&gt;
&lt;center&gt;
&lt;img src=&#34;/img/memoryfull.jpg&#34; alt=&#34;drawing&#34; width=&#34;400&#34;/&gt;
&lt;/center&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;The issue is memory (RAM). Think of it as brain capacity, and if R’s brain is full, things start to happen slowly or not at all. The goal is somewhat like Taoism - keeping the mind clear of all distractions and just being - placing our will in harmony with the natural univeRse.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Sorry, I’ll avoid all philosophy from here ;) Note that I am also going to avoid complexities and will try to use laymens terms. This may require some abstractions of the truth that could fill whole blogs with caveats and explanations, so I’ll just ask advanced R users to please forgive me and turn a blind eye. I hope some of what I’ll demonstrate here is useful for advanced users, but otherwise I’d recommend reading resources like Hadley Wickham’s section on the way in which R uses memory in his book &lt;a href=&#34;http://adv-r.had.co.nz/memory.html&#34;&gt;&lt;strong&gt;Advanced R&lt;/strong&gt;&lt;/a&gt; as it really can help you improve your code to manage memory better.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Let’s start by seeing how full R’s brain is before we’ve asked it to think about anything.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ls() #lists all objects in memory&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## character(0)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(pryr)
mem_used() #gives estimate of memory being used&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 33.2 MB&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;No objects in memory, and not much being used! Note that there’s always something happening so mem_used() will never return 0. I’ll keep calling the mem_used() function throughout to show you how different operations affect how full R’s brain is.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s see what happens when we add a raster. Note that I’ll start by using the SRTM90 digital elevation model used in the &lt;a href=&#34;http://www.ecologi.st/post/spatial-data-in-r-2-a-practical-example/#data-description&#34;&gt;&lt;strong&gt;Handling Spatial Data in R - #2&lt;/strong&gt;&lt;/a&gt; post, which you can download &lt;a href=&#34;https://www.dropbox.com/s/xqjzeg8uypf45a2/SRTM.zip?dl=0&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt; if you don’t have it already. It’s not a particularly big raster, but it’ll suffice for the purposes of demonatration.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;I’ll also use the working directory tricks I explain in the &lt;a href=&#34;http://www.ecologi.st/post/spatial-data-in-r-2-a-practical-example/#housekeeping&#34;&gt;&lt;strong&gt;Housekeeping&lt;/strong&gt;&lt;/a&gt; section of that post. Note the addition of &lt;em&gt;tempwd&lt;/em&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if (Sys.getenv(&amp;quot;USER&amp;quot;)==&amp;#39;jasper&amp;#39;) {datwd=&amp;quot;/Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/Data/&amp;quot;
giswd=&amp;quot;/Users/jasper/Documents/GIS/&amp;quot;
reswd=&amp;quot;/Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/Results/&amp;quot;
tempwd=&amp;quot;/Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/temp/&amp;quot;}
if (Sys.getenv(&amp;quot;USER&amp;quot;)==&amp;#39;MACUseR&amp;#39;) {datwd=&amp;quot;&amp;quot;; giswd=&amp;quot;&amp;quot;; reswd=&amp;quot;&amp;quot;} #For Mac/Linux users
if (Sys.getenv(&amp;quot;USERNAME&amp;quot;)==&amp;#39;WINDOZEUseR&amp;#39;) {datwd=&amp;quot;&amp;quot;; giswd=&amp;quot;&amp;quot;; reswd=&amp;quot;&amp;quot;} #For Windows

mem_used()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 33.6 MB&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(raster, quietly = T)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Attaching package: &amp;#39;raster&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## The following object is masked from &amp;#39;package:pryr&amp;#39;:
## 
##     subs&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dem &amp;lt;- raster(paste0(giswd, &amp;quot;SRTM/srtm_40_19.tif&amp;quot;))

mem_used()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 87.1 MB&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So adding the directory file paths made almost no difference, but the raster is occupying ~50MB! But hang on… I recall that file being larger when I downloaded it. Let’s check?&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;file.size(paste0(giswd, &amp;quot;SRTM/srtm_40_19.tif&amp;quot;))/10^6 #Note the &amp;quot;/10^6&amp;quot; to convert to MB&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 72.12069&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;The real file is bigger? This is because the raster() function doesn’t call the whole file into memory. It creates a link to the file and only calls the info it needs to manipulate it. This is very clever (thanks Robert Hijmans!), and avoids R’s brain getting too full.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Ok, so what if we create a new object based on the object that is linked to file?&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;newdem &amp;lt;- dem

mem_used()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 87.2 MB&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It hardly changed the memory usage? The reason being that R is very very clever, and knows that &lt;em&gt;newdem&lt;/em&gt; is identical to &lt;em&gt;dem&lt;/em&gt; in all but name, so all the &lt;em&gt;newdem&lt;/em&gt; object is storing is enough info to manipulate it and it’ll call what it needs from &lt;em&gt;dem&lt;/em&gt; (or directly from the source file) when it needs it.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Where we start to get into trouble is when we start to do stupid things like…&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;newdem &amp;lt;- dem*2

mem_used()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 376 MB&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Whoa?! ~300MB of brain space filled by one operation!!!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;The issue is that by multiplying &lt;em&gt;dem&lt;/em&gt; by 2 we’ve created an object with different properties to the source file, so R has to keep it somewhere, and since you didn’t tell R where to store it on your computer it has to remember it. Let’s compare the properties of &lt;em&gt;dem&lt;/em&gt; and &lt;em&gt;newdem&lt;/em&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dem&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterLayer 
## dimensions  : 6001, 6001, 36012001  (nrow, ncol, ncell)
## resolution  : 0.0008333333, 0.0008333333  (x, y)
## extent      : 14.99958, 20.00042, -35.00042, -29.99958  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## data source : /Users/jasper/Documents/GIS/SRTM/srtm_40_19.tif 
## names       : srtm_40_19 
## values      : -32768, 32767  (min, max)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;newdem&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterLayer 
## dimensions  : 6001, 6001, 36012001  (nrow, ncol, ncell)
## resolution  : 0.0008333333, 0.0008333333  (x, y)
## extent      : 14.99958, 20.00042, -35.00042, -29.99958  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       : srtm_40_19 
## values      : -56, 4464  (min, max)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;See how the “data source” for &lt;em&gt;dem&lt;/em&gt; is a file path, whereas for &lt;em&gt;newdem&lt;/em&gt; it says “in memory”.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;This isn’t a problem if the file is small, but it is a problem for big files or the accumulation of many smaller ones. If you’re working with big files, a better alternative to the code above would be to write out the file and create a link to it. Let’s put it in the &lt;em&gt;tempwd&lt;/em&gt; we created earlier.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;newdem &amp;lt;- writeRaster(dem*2, paste0(tempwd, &amp;quot;newdem&amp;quot;))

mem_used()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 88.6 MB&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Wow!&lt;/p&gt;
&lt;p&gt;But hang on? It seems like &lt;em&gt;newdem&lt;/em&gt; is much smaller than &lt;em&gt;dem&lt;/em&gt;, which was ~50MB? Surely they should be similar? Let’s look at their properties again.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dem&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterLayer 
## dimensions  : 6001, 6001, 36012001  (nrow, ncol, ncell)
## resolution  : 0.0008333333, 0.0008333333  (x, y)
## extent      : 14.99958, 20.00042, -35.00042, -29.99958  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## data source : /Users/jasper/Documents/GIS/SRTM/srtm_40_19.tif 
## names       : srtm_40_19 
## values      : -32768, 32767  (min, max)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;newdem&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterLayer 
## dimensions  : 6001, 6001, 36012001  (nrow, ncol, ncell)
## resolution  : 0.0008333333, 0.0008333333  (x, y)
## extent      : 14.99958, 20.00042, -35.00042, -29.99958  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## data source : /Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/temp/newdem.grd 
## names       : srtm_40_19 
## values      : -56, 4464  (min, max)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;This confirms that &lt;em&gt;newdem&lt;/em&gt; is now linked to a file, but also that the objects have the same extent and resolution as we expected. Only the pixel values differ, but that should not make a big difference?&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;It turns out that the difference ooccurs because by writing out the raster without indicating a file extention or format R has used the native format for library(raster), which in your file system creates the files “newdem.grd” and “newdem.gri” in your &lt;em&gt;tempwd&lt;/em&gt; folder. This file format was designed specifically so that R can create a link calling all the info it needs to manipulate the file while minimizing memory usage. The memory required for R to create a link to raster files varies quite a bit between file formats (.asc, .sdat, .img, etc) and it turns out that GeoTiffs (.tif) like the SRTM data we called earlier are particularly bad.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;I know what you’re thinking - “This is cool to know, but adding &lt;em&gt;newdem &amp;lt;- writeRaster()&lt;/em&gt; to each line of code where I manipulate a raster is cumbersome and untidy”. Fortunately, Prof R.J. Hijmans has provided a solution for this in most cases by including the “filename =” option in most functions. To do the calculation above we could use the calc() function and rewrite it like so…&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;newdem &amp;lt;- calc(dem, fun=function(x){x * 2}, filename = paste0(tempwd, &amp;quot;newdem&amp;quot;), overwrite=TRUE)

mem_used()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 89.5 MB&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;In this particular case the code is still more cumbersome than simple raster maths, but in most cases all you’d need add is the “filename = paste0(tempwd,”newdem“)” bit. Note I had to add “overwrite=TRUE” too, otherwise R returns an error. This may seem irritating, but it does save one from embarrasing scenarios like overwriting your source data if you just copied and pasted the filepath and forgot to change it…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Ok, ok, I hear you! So adding “filename = …, overwrite = …” etc every time is cumbersome and irritating too. You may as well go and pay ESRI lotsa $ and click away in ArcGIS?&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Well it turns out that Prof Bobby J. H. has created a way for eternally lazy typers like you to solve this, but with great power comes great responsibility! The solution is rasterOptions().&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rasterOptions()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## format        : raster 
## datatype      : FLT4S 
## overwrite     : FALSE 
## progress      : none 
## timer         : FALSE 
## chunksize     : 1e+07 
## maxmemory     : 1e+09 
## tmpdir        : /var/folders/93/lxzmv0k90xs0lhsgwtdt5s640000gn/T//Rtmpp0F0QM/raster// 
## tmptime       : 168 
## setfileext    : TRUE 
## tolerance     : 0.1 
## standardnames : TRUE 
## warn depracat.: TRUE 
## header        : none&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Firstly, you’ll notice that “overwrite = FALSE” is the default. You can change this at your own peril. I do not advise it.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Secondly, if you look at the help file with &lt;em&gt;?rasterOptions&lt;/em&gt;, you’ll also note a setting called “todisk”, which by default is set to FALSE. If you set this to TRUE, all operations that create new rasters will write the new raster to disk as a temporary file and the raster object in memory will be linked to that file.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Neat? Not really. The problem with this solution is that all raster operations will now involve reading and writing files, even if the rasters are small. Reading and writing operations take time, and if you have lots of small file operations this will probably slow you down more than if you just ask R to remember all the small files…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;In short, I’d advocate just typing “filename = …, overwrite = …” when you need it.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;interlude&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Interlude&lt;/h3&gt;
&lt;p&gt;To carry on with the irritating mind-reading, I bet you’ve come around to thinking “Well if the goal is to keep everything out of R’s memory, why are we trying to do GIS in R at all?”&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;My answer is “Exactly! You’re starting to get it!!!” We’re not trying to do GIS in R, we’re trying to do GIS &lt;em&gt;from&lt;/em&gt; R!!!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;If you’re reading this blog, you’re likely already sold on the value of working in R for a variety of other reasons including things like statistical flexibility, visualization tools, reproducibility, etc. You’re probably only interested in handling spatial data in R because you’re sick of clicking on stuff in ArcGIS or QGIS and want to do everything you need in one workflow.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;The beauties are 1) if you’re familiar with R, learning to handle spatial data with R is not that tricky, and 2) you can do massively powerful spatial data analyses from R, because if the internal* functions can’t do it, R can call just about whatever software you need to get the job done!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;*Here I mean functions like those in library(raster), but I should add the proviso that this and many other R libraries are already cleverly designed to call other software to do their bidding wherever it is deemed more efficient to do so.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;doing-gis-from-r&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Doing GIS &lt;em&gt;from&lt;/em&gt; R&lt;/h3&gt;
&lt;p&gt;In the past few years I have started working with very large datasets like the 30m &lt;a href=&#34;https://egis.environment.gov.za/national_land_cover_data_sa&#34;&gt;&lt;strong&gt;National Land Cover Data for South Africa&lt;/strong&gt;&lt;/a&gt; and the full record of daily or 16-day composite MODIS images for the Cape Floristic Region. As you would imagine, I have started to come up against some computational issues and have had to find ways around them since just getting a bigger computer is not always a viable option.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;One of my best finds has been library(gdalUtils), which provides wrapper functions for &lt;a href=&#34;https://www.gdal.org/&#34;&gt;&lt;strong&gt;GDAL (Geospatial Data Abstraction Library)&lt;/strong&gt;&lt;/a&gt;. GDAL is a massively powerful software library (written in C and C++) for reading and writing raster and vector geospatial data formats, and includes many command line utilities for data translation and processing. It actually forms the basis of many (if not most) commonly used GIS programmes like QGIS, GRASS, SAGA, IDRISI, etc - &lt;a href=&#34;https://trac.osgeo.org/gdal/wiki/SoftwareUsingGdal&#34;&gt;&lt;strong&gt;here’s a list!&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Here’s a quick demonstration calling on GDAL to project our DEM to UTM34S, using library(gdalUtils)’ gdalwarp() wrapper function.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;mem_used()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 89.7 MB&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(gdalUtils)

gdalwarp(paste0(giswd, &amp;quot;SRTM/srtm_40_19.tif&amp;quot;),
                  dstfile=paste0(tempwd, &amp;quot;srtm_UTM34S&amp;quot;),
                  t_srs=&amp;quot;+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs&amp;quot;,
                  output_Raster=TRUE,
                  overwrite=TRUE,verbose=TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Checking gdal_installation...&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Scanning for GDAL installations...&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Checking Sys.which...&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Checking common locations...&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## GDAL version 1.11.4&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## GDAL command being used: &amp;quot;/Library/Frameworks/GDAL.framework/Versions/1.11/Programs/gdalwarp&amp;quot; -overwrite  -t_srs &amp;quot;+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs&amp;quot; -of &amp;quot;GTiff&amp;quot; &amp;quot;/Users/jasper/Documents/GIS/SRTM/srtm_40_19.tif&amp;quot; &amp;quot;/Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/temp/srtm_UTM34S&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterBrick 
## dimensions  : 6654, 5693, 37881222, 1  (nrow, ncol, ncell, nlayers)
## resolution  : 85.7311, 85.7311  (x, y)
## extent      : -79261.36, 408805.8, 6110386, 6680840  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=34 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## data source : /Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/temp/srtm_UTM34S 
## names       : srtm_UTM34S 
## min values  :      -32768 
## max values  :       32767&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;mem_used()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 93.1 MB&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Very little memory taken, because nothing ever came into R’s memory.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s compare the time taken to reproject our DEM using library(raster)’s projectRaster() function versus gdalwarp().&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;system.time(
  gdalwarp(paste0(giswd, &amp;quot;SRTM/srtm_40_19.tif&amp;quot;),
                  dstfile=paste0(tempwd, &amp;quot;srtm_UTM34S&amp;quot;),
                  t_srs=&amp;quot;+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs&amp;quot;,
                  output_Raster=TRUE,
                  overwrite=TRUE,verbose=TRUE)
)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Checking gdal_installation...&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Scanning for GDAL installations...&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Checking the gdalUtils_gdalPath option...&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## GDAL version 1.11.4&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## GDAL command being used: &amp;quot;/Library/Frameworks/GDAL.framework/Versions/1.11/Programs/gdalwarp&amp;quot; -overwrite  -t_srs &amp;quot;+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs&amp;quot; -of &amp;quot;GTiff&amp;quot; &amp;quot;/Users/jasper/Documents/GIS/SRTM/srtm_40_19.tif&amp;quot; &amp;quot;/Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/temp/srtm_UTM34S&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    user  system elapsed 
##   1.323   0.438   1.994&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;system.time(
demUTM &amp;lt;- projectRaster(dem, crs = CRS(&amp;quot;+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs&amp;quot;), filename = paste0(tempwd, &amp;quot;newdem&amp;quot;), overwrite=TRUE)
)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    user  system elapsed 
##  57.080  75.095 180.687&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Phew! Well that was painful… I think it’s pretty clear that gdalwarp() was MUCH more efficient! Note that you can also use gdalwarp() to read the raster into R (by just assigning it “myobject &amp;lt;- gdalwarp(…)”). This does slow it down, but only by a couple of seconds. If you have a set of different operations you’d like to perform it’s quickest to run them line by line - writing new files from GDAL each time - and then only read in the last file.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Note that to give projectRaster() a fair chance, I’ve tried it with and without “filename =” and with and without creating the new &lt;em&gt;demUTM&lt;/em&gt; object and the results were very similar.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;I’ll leave it there. Have fun exploring other library(gdalUtils) functions! Note that the are similar R packages with wrapper functions for GRASS and SAGA, and probably others, but I’ll leave exploring those up to you too.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Before we go, lets delete all our temporary files.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;file.remove(list.files(tempwd, full.names = T)) #remove all files from our temp folder&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] TRUE TRUE TRUE&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;And of course…&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sessionInfo()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## R version 3.5.1 (2018-07-02)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.2
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] gdalUtils_2.0.1.14 raster_2.6-7       sp_1.3-1          
## [4] pryr_0.1.4        
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.18      knitr_1.20        magrittr_1.5     
##  [4] lattice_0.20-35   foreach_1.4.4     stringr_1.3.1    
##  [7] tools_3.5.1       rgdal_1.3-4       grid_3.5.1       
## [10] xfun_0.3          R.oo_1.22.0       htmltools_0.3.6  
## [13] iterators_1.0.10  yaml_2.2.0        rprojroot_1.3-2  
## [16] digest_0.6.15     bookdown_0.7      R.utils_2.6.0    
## [19] codetools_0.2-15  evaluate_0.11     rmarkdown_1.10   
## [22] blogdown_0.8      stringi_1.2.4     compiler_3.5.1   
## [25] R.methodsS3_1.7.1 backports_1.1.2&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Handling Spatial Data in R - #2. A practical example</title>
      <link>/post/spatial-data-in-r-2-a-practical-example/</link>
      <pubDate>Wed, 29 Aug 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/spatial-data-in-r-2-a-practical-example/</guid>
      <description>&lt;div id=&#34;TOC&#34;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#a-quick-note-on-the-structure-of-this-tutorial&#34;&gt;A quick note on the structure of this tutorial&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#data-description&#34;&gt;Data Description&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#housekeeping&#34;&gt;Housekeeping&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#getting-and-cleaning-the-data-but-first-and-foremost-projection&#34;&gt;Getting and cleaning the data, but first and foremost, &lt;em&gt;projection!!!&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#lets-start-with-point-data&#34;&gt;Let’s start with point data&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#raster-data-mostly-functions-from-libraryraster&#34;&gt;Raster data (mostly functions from library(raster))&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#polygons&#34;&gt;Polygons!&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#going-parallel&#34;&gt;Going parallel!!!&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#animation&#34;&gt;Animation!&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#some-other-data-visualization-and-analysis&#34;&gt;Some other data visualization and analysis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#but-what-about-our-poor-cedars&#34;&gt;But what about our poor cedars?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#options-for-writing-out-spatial-data&#34;&gt;Options for writing out spatial data&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;

&lt;hr /&gt;
&lt;p&gt;This post follows on from &lt;a href=&#34;http://www.ecologi.st/post/2017-04-01-PrimerSpatialData/&#34;&gt;&lt;strong&gt;Handling Spatial Data in R - #1. Getting started&lt;/strong&gt;&lt;/a&gt;, which gives the basics on installing &lt;a href=&#34;https://cran.r-project.org/&#34;&gt;&lt;strong&gt;R&lt;/strong&gt;&lt;/a&gt; and &lt;a href=&#34;https://www.rstudio.com/products/RStudio/&#34;&gt;&lt;strong&gt;RStudio&lt;/strong&gt;&lt;/a&gt;, CRAN Spatial Task Views and &lt;a href=&#34;http://www.ecologi.st/post/2017-04-01-PrimerSpatialData/#useful-diy-resources&#34;&gt;&lt;strong&gt;useful DIY resources&lt;/strong&gt;&lt;/a&gt;. Obviously, if you’re already familiar with these topics then no need to go through that post. You may also be interested in the next post on &lt;a href=&#34;http://www.ecologi.st/post/big-spatial-data/&#34;&gt;&lt;strong&gt;handling big spatial data and memory management&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Here we’ll work through a practical example exploring fire history layers (polygon), topographic (raster) and locality (point) data using the libraries ‘rgdal’, ‘raster’ and ‘sp’ and a few others. The example will cover setting and changing projections and extents, subseting polygons, raster calculations, rasterizing polygons and extracting data with a few neat tricks and visualisations along the way. Note that you can navigate to and/or bookmark the various sections using the links in the table of contents above.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div id=&#34;a-quick-note-on-the-structure-of-this-tutorial&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;A quick note on the structure of this tutorial&lt;/h3&gt;
&lt;p&gt;From here this tutorial will include embedded chunks of R code and the output that R returns in little grey boxes. The R code I call starts at the beginning of the line, while each line of R’s output starts with “##”, e.g.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;1+1&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 2&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Note that I occassionally include additional comments in the R chunks as one often does in normal R code. Comments are preceded by “#”, e.g.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;1+1 #My comment&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 2&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Hopefully this will all make sense as you get into the tutorial…&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;data-description&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Data Description&lt;/h3&gt;
&lt;p&gt;For this exercise we’ll play with fine-scale locality (point) data for the critically endangered Clanwilliam cedar (&lt;em&gt;Widdringtonia cedarbergensis&lt;/em&gt;) mapped by my father for the &lt;em&gt;Hike the Cederberg&lt;/em&gt; map (check out &lt;strong&gt;&lt;a href=&#34;http://www.slingsbymaps.com/&#34; class=&#34;uri&#34;&gt;http://www.slingsbymaps.com/&lt;/a&gt;&lt;/strong&gt;; data for 1000 trees downloadable &lt;a href=&#34;https://www.dropbox.com/s/1ucycs7vcaa5cm9/Cedars.kml?dl=0&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt;, a 90m (raster) digital elevation model (DEM) &lt;a href=&#34;https://www.dropbox.com/s/xqjzeg8uypf45a2/SRTM.zip?dl=0&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt; (I will also show you how to download the DEM directly with R using the &lt;em&gt;raster&lt;/em&gt; package), and two “polygon” data sets consisting of mapped burn scars for CapeNature reserves (available from SANBI’s BGIS website &lt;a href=&#34;http://bgis.sanbi.org/Projects/Detail/168&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt; and the National Vegetation Map (available &lt;a href=&#34;http://bgis.sanbi.org/SpatialDataset/Detail/18&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;You will need to download the cedar dataset into your chosen local data directory (see &lt;em&gt;datwd&lt;/em&gt; under “Housekeeping” below) and download the other data into your chosen GIS data directory (see &lt;em&gt;giswd&lt;/em&gt; below) and unzip them. &lt;em&gt;datwd&lt;/em&gt; and &lt;em&gt;giswd&lt;/em&gt; can be the same for the purposes of this tutorial. You can download the R code (with the RMarkdown content commented out) at &lt;a href=&#34;https://www.dropbox.com/s/pwzccav07zwbwj4/PrimerSpatialData.R?dl=0&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;housekeeping&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Housekeeping&lt;/h3&gt;
&lt;p&gt;Apologies, this bit is a little long-winded, but please read it carefully as it will likely affect your ability to run the code below.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div id=&#34;working-directories&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Working directories&lt;/h4&gt;
&lt;p&gt;I usually work from a “Project” in RStudio linked to a GIT repository (see &lt;strong&gt;&lt;a href=&#34;https://git-scm.com/&#34; class=&#34;uri&#34;&gt;https://git-scm.com/&lt;/a&gt;&lt;/strong&gt; and &lt;strong&gt;&lt;a href=&#34;https://github.com/&#34; class=&#34;uri&#34;&gt;https://github.com/&lt;/a&gt;&lt;/strong&gt;) for version control and easy code sharing/collaboration. I’m not going to go there with this tutorial, but it is worth exploring if you intend to do big projects in R. R projects set the working directory to a good place automatically. Alternatively you can use the setwd() function. If I’m not in a repo or I am working with large data sets that I don’t want to replicate in every GIT repo on my hard drive I usually set separate “data”, “GIS data” (i.e. biggish data) and “results” working directories by making each path an object and inserting as appropriate for different read and write functions using paste() or paste0(). These would look something like:&lt;/p&gt;
&lt;p&gt;datwd = “/Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/Data/”&lt;br /&gt;
giswd = “/Users/jasper/Documents/GIS/”&lt;br /&gt;
reswd = “/Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/Results/”&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;sharing-code-between-multiple-machines&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Sharing code between multiple machines&lt;/h4&gt;
&lt;p&gt;If you plan run the same code on multiple machines (e.g. your laptop and a workstation) or are sharing code with a collaborator (and are not using GitHub) it’s easiest to automatically detect what computer the code is being run on and set the appropriate working directories (and anything else you like).&lt;/p&gt;
&lt;p&gt;This can be done by identifying the machine/user using Sys.getenv() and wrapping the code for setting working directories etc in an if() statement for each user, like so:&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if (Sys.getenv(&amp;quot;USER&amp;quot;)==&amp;#39;jasper&amp;#39;) {datwd=&amp;quot;/Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/Data/&amp;quot;
giswd=&amp;quot;/Users/jasper/Documents/GIS/&amp;quot;
reswd=&amp;quot;/Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/Results/&amp;quot;}
if (Sys.getenv(&amp;quot;USER&amp;quot;)==&amp;#39;MACUseR&amp;#39;) {datwd=&amp;quot;&amp;quot;; giswd=&amp;quot;&amp;quot;; reswd=&amp;quot;&amp;quot;} #For Mac/Linux users
if (Sys.getenv(&amp;quot;USERNAME&amp;quot;)==&amp;#39;WINDOZEUseR&amp;#39;) {datwd=&amp;quot;&amp;quot;; giswd=&amp;quot;&amp;quot;; reswd=&amp;quot;&amp;quot;} #For Windows&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;This way a new project member can add a new line of code without deleting anything, and it only sets the working directories (and any other settings you want) for the appropriate user - i.e. the if() statement ignores settings for all other users. NOTE!!! the “USER/USERNAME” difference for Mac vs Windows (I’m pretty sure Linux is the same as Mac, but try Sys.getenv() and see what you get).&lt;/p&gt;
&lt;p&gt;If you are running the code from this tutorial you need to set your username and working directories here. You can just set &lt;em&gt;datwd&lt;/em&gt;, &lt;em&gt;giswd&lt;/em&gt; and &lt;em&gt;reswd&lt;/em&gt; to the same file path for the purposes of this tutorial (if you’ve put all the data in the same place).&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;a-quick-aside-on-slashes&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;A quick aside on slashes&lt;/h4&gt;
&lt;p&gt;Often the reason you can’t read in data is because you need to add (or delete) a “/” at the end! - Silly, but that pro tip should help.&lt;/p&gt;
&lt;p&gt;Note that we generally use single forwardslashes “/” in R. Windows likes to use single backslashes, but R (and just about every other computer programme in the world) doesn’t like this. You can use double backslashes on Windows if you must…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;librariespackages&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Libraries/packages&lt;/h4&gt;
&lt;p&gt;Here we call the extention libraries with functions we’ll need for this session. More on what R libraries/packages are in my previous post &lt;a href=&#34;http://www.ecologi.st/post/2017-04-01-PrimerSpatialData/#installing-r-and-rstudio&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;You should install the libraries before running the code below using &lt;a href=&#34;https://www.rdocumentation.org/packages/utils/versions/3.5.1/topics/install.packages&#34;&gt;&lt;strong&gt;install.packages()&lt;/strong&gt;&lt;/a&gt; while connected to the internet - e.g. install.packages(“raster”). Note that one occasionally encounters issues installing doMC, but you can usually install it from their development page using install.packages(“doMC”, repos=“&lt;a href=&#34;http://R-Forge.R-project.org&#34; class=&#34;uri&#34;&gt;http://R-Forge.R-project.org&lt;/a&gt;”). If neither of these work for you don’t worry, it is not an essential component of the tutorial.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(raster, quietly = T) # To handle rasters
library(rasterVis, quietly = T) # For fancy raster visualisations
library(rgdal, quietly = T) # To communicate with GDAL and handle shape files&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## rgdal: version: 1.3-4, (SVN revision 766)
##  Geospatial Data Abstraction Library extensions to R successfully loaded
##  Loaded GDAL runtime: GDAL 2.1.3, released 2017/20/01
##  Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/3.5/Resources/library/rgdal/gdal
##  GDAL binary built with GEOS: FALSE 
##  Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
##  Path to PROJ.4 shared files: /Library/Frameworks/R.framework/Versions/3.5/Resources/library/rgdal/proj
##  Linking to sp version: 1.3-1&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(sp, quietly = T) # To handle shapefiles
library(doMC, quietly = T) # To run code in parallel
library(animation, quietly = T) # To make fancy animations...
library(dismo, quietly = T) # For fancy tricks in Google Earth
suppressPackageStartupMessages(library(googleVis, quietly = T)) # For even more fancy tricks in Google Earth&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Creating a generic function for &amp;#39;toJSON&amp;#39; from package &amp;#39;jsonlite&amp;#39; in package &amp;#39;googleVis&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;R should have give you a bunch of feedback after calling the libraries. Look out for errors or warnings suggesting that the packages aren’t installed properly. You can often ignore warnings, but it is useful to take note of them in case you encounter confusing problems later on.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;getting-and-cleaning-the-data-but-first-and-foremost-projection&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Getting and cleaning the data, but first and foremost, &lt;em&gt;projection!!!&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;R typically uses the PROJ.4 conventions for cartographic projections (or coordinate reference systems - CRS). Check out &lt;a href=&#34;http://proj4js.org&#34; class=&#34;uri&#34;&gt;http://proj4js.org&lt;/a&gt; or &lt;a href=&#34;http://spatialreference.org/&#34; class=&#34;uri&#34;&gt;http://spatialreference.org/&lt;/a&gt; or google for the “proj4string” for various coordinate reference systems.&lt;/p&gt;
&lt;p&gt;NOTE!!! Many R functions will allow you to play with objects with different CRS resulting in GARBAGE! Others will reproject one or other of the objects for you, but this can be slow and it’s not worth taking the chance. I recommend checking and setting your CRS for all objects. You can check CRS with proj4string(), check that multiple objects have the same CRS using identicalCRS(), and reproject objects of class “Spatial” with spTransform() and objects of class “Raster” with projectRaster(). Note that not all reprojections are possible or sensible, but I’ll leave that homework to you. One key case where reprojection in R appears to work (but hasn’t!) is reprojecting MODIS satellite data from its native &lt;em&gt;Sinusoidal&lt;/em&gt; projection. My workaround is to use the &lt;a href=&#34;https://www.rdocumentation.org/packages/gdalUtils/versions/2.0.1.14/topics/gdalwarp&#34;&gt;&lt;strong&gt;gdalwarp()&lt;/strong&gt;&lt;/a&gt; function in &lt;a href=&#34;https://cran.r-project.org/web/packages/gdalUtils/index.html&#34;&gt;&lt;strong&gt;library(gdalUtils)&lt;/strong&gt;&lt;/a&gt; - a very powerful set of functions which I hope to write another post about.&lt;/p&gt;
&lt;p&gt;I like to set a standardized CRS as an object that I can call throughout my workflow.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#Set a standardized projection using the PROJ.4 string convention
stdCRS &amp;lt;- &amp;quot;+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs&amp;quot; 
#This is also &amp;quot;EPSG:32734&amp;quot; - the European Petroleum Survey Group - another common CRS convention&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;This is the Universal Transverse Mercator (UTM) projection, which is useful for studies with smallish extents (~&amp;lt;100km a side), because the unit is metres and is easily interpretable. The UTM zone we’re in for this example is 34 South &lt;a href=&#34;http://whatutmzoneamiin.blogspot.co.za/p/map.html&#34; class=&#34;uri&#34;&gt;http://whatutmzoneamiin.blogspot.co.za/p/map.html&lt;/a&gt; - so I’ve used UTM34S. More on projections for those interested &lt;a href=&#34;https://en.wikipedia.org/wiki/Map_projection#Projections_by_preservation_of_a_metric_property&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;lets-start-with-point-data&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Let’s start with point data&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Note!!!&lt;/strong&gt; Here I’ll mostly use functions from library(rgdal) and library(sp). These have recently been superceded by &lt;a href=&#34;https://cran.r-project.org/web/packages/sf/index.html&#34;&gt;&lt;strong&gt;library(sf)&lt;/strong&gt;&lt;/a&gt;, which covers functionality from these two packages and library(rgeos) and follows a &lt;a href=&#34;https://www.tidyverse.org/&#34;&gt;&lt;strong&gt;Tidyverse&lt;/strong&gt;&lt;/a&gt; approach to R coding. I’ve stuck with library(rgdal) and library(sp) because I first started this primer before library(sf) was released. I also feel its useful to see the diversity of ways in which things can be done in R (each have their pros and cons), and once you’ve learned it one way its easier to learn other ways. I hope to add a library(sf) tutorial (or section to this tutorial) at a later stage and will endeavour to add the link here ;) Note that library(sf) doesn’t deal with rasters so its still worth checking out the raster section of this post either way.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div id=&#34;reading-in-shapefiles&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Reading in shapefiles&lt;/h4&gt;
&lt;p&gt;Ok, so lets use readOGR() from library(rgdal) to read the point data in as a shapefile. Note that readOGR() is incredibly versatile and can read in all kinds of shapefiles with different features (point, line, polygon) from different software - type ?rgdal for more info. Here R essentially calls the GDAL &lt;a href=&#34;http://www.gdal.org/&#34; class=&#34;uri&#34;&gt;http://www.gdal.org/&lt;/a&gt; software (the underpinning for QGIS and a number of other GIS software products). Unfortunately some PCs struggle to automatically install GDAL, but there are plenty of online fora providing solutions. Sometimes (although this issue may be fixed) there are conflicts between library(sp) and library(rgdal) depending on what order they are called.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rawpts &amp;lt;- readOGR(dsn=paste0(datwd, &amp;quot;Cedars.kml&amp;quot;), layer=&amp;quot;Cedars.kml&amp;quot;) # A Google Earth KML file&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## OGR data source with driver: KML 
## Source: &amp;quot;/Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/Data/Cedars.kml&amp;quot;, layer: &amp;quot;Cedars.kml&amp;quot;
## with 1000 features
## It has 2 fields&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;proj4string(rawpts) # Check projection&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;pts &amp;lt;- spTransform(rawpts, CRS(stdCRS)) # Do spatial transform to project to our chosen CRS&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Note the strange &lt;em&gt;dsn=…, layer=…&lt;/em&gt; syntax. This will mess with you at first!!! This syntax is used to allow the function to read in many different file formats - type “ogrDrivers()” into the console to see a list. Different drivers often require different inputs for &lt;em&gt;dsn=&lt;/em&gt; and &lt;em&gt;layer=&lt;/em&gt;. I often have to play around or ask Google before I get it right for a new file type…&lt;/p&gt;
&lt;p&gt;Also note the use of the &lt;em&gt;paste0(datwd, “Cedars.kml”)&lt;/em&gt; trick I mentioned earlier:&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;paste0(datwd, &amp;quot;Cedars.kml&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;/Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/Data/Cedars.kml&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Again, note that the presence and number of /’s are very important… It’s the first thing to check if you get an error!!! IF YOU HAVE ANY ISSUES READING IN DATA AT ANY STAGE THE FIRST THING TO DO IS TO RUN THE &lt;em&gt;“paste0(…)”&lt;/em&gt; SECTION OF THE SCRIPT AND MAKE SURE IT MATCHES EXACTLY THE PATH TO YOUR FILE!!!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;spatialdataframes&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;SpatialDataFrames&lt;/h4&gt;
&lt;p&gt;Let’s explore our point data a little more. Firstly, let’s look at the data class attribute.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;class(pts)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;SpatialPointsDataFrame&amp;quot;
## attr(,&amp;quot;package&amp;quot;)
## [1] &amp;quot;sp&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;A “SpatialPointsDataFrame” - which is as it suggests - a set of spatial localities linked to a dataframe of information about each locality - like an attribute table in other GIS software. The nice thing is that R allows you to manipulate “Spatial(Point/Polygon/etc)Dataframes” in the same way as you can regular dataframes, e.g.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;head(pts)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   Name Description
## 1                 
## 2                 
## 3                 
## 4                 
## 5                 
## 6&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Revealing that there’s not much in this object’s “attribute table”. Note that you can also subset using indexing [,], access columns using $, apply summary functions, etc as one does with a normal dataframe. We’ll do more of this in the &lt;a href=&#34;http://www.ecologi.st/post/spatial-data-in-r-2-a-practical-example/#polygons&#34;&gt;&lt;strong&gt;Polygons&lt;/strong&gt;&lt;/a&gt; section.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;accessing-spatial-coordinates-and-creating-point-shapefiles-from-spreadsheet-data&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Accessing spatial coordinates and creating point shapefiles from spreadsheet data&lt;/h4&gt;
&lt;p&gt;We can easily extract the spatial coordinates from our object using coordinates().&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;head(coordinates(pts))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##      coords.x1 coords.x2
## [1,]  318630.2   6418166
## [2,]  329096.9   6411855
## [3,]  324656.3   6423442
## [4,]  324611.6   6427641
## [5,]  324156.0   6421462
## [6,]  320746.9   6429256&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;These may look funny if you’re not familiar with UTM - the unit is metres, usually from the equator or poles and the Greenwich Meridian depending on the exact UTM CRS used.&lt;/p&gt;
&lt;p&gt;We can also extract the coordinates and make them a regular “data.frame”&amp;quot; object (as if we’d read in a .txt or .csv file).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;x &amp;lt;- as.data.frame(coordinates(pts)) 
class(x)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;data.frame&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;This allows me to demonstrate making a “Spatial” object by setting coordinates for x.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;coordinates(x) &amp;lt;- ~ coords.x1 + coords.x2 # 
class(x)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;SpatialPoints&amp;quot;
## attr(,&amp;quot;package&amp;quot;)
## [1] &amp;quot;sp&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;As simple as that! But note that if you use this approach it will not have a coordinate reference system (the “proj4string”) and you have to assign it. Hopefully you know what CRS the geolocations were collected in!!!&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;str(x) # Note the lack of proj4string info&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Formal class &amp;#39;SpatialPoints&amp;#39; [package &amp;quot;sp&amp;quot;] with 3 slots
##   ..@ coords     : num [1:1000, 1:2] 318630 329097 324656 324612 324156 ...
##   .. ..- attr(*, &amp;quot;dimnames&amp;quot;)=List of 2
##   .. .. ..$ : chr [1:1000] &amp;quot;1&amp;quot; &amp;quot;2&amp;quot; &amp;quot;3&amp;quot; &amp;quot;4&amp;quot; ...
##   .. .. ..$ : chr [1:2] &amp;quot;coords.x1&amp;quot; &amp;quot;coords.x2&amp;quot;
##   ..@ bbox       : num [1:2, 1:2] 315518 6410827 333832 6434186
##   .. ..- attr(*, &amp;quot;dimnames&amp;quot;)=List of 2
##   .. .. ..$ : chr [1:2] &amp;quot;coords.x1&amp;quot; &amp;quot;coords.x2&amp;quot;
##   .. .. ..$ : chr [1:2] &amp;quot;min&amp;quot; &amp;quot;max&amp;quot;
##   ..@ proj4string:Formal class &amp;#39;CRS&amp;#39; [package &amp;quot;sp&amp;quot;] with 1 slot
##   .. .. ..@ projargs: chr NA&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;proj4string(x) &amp;lt;- stdCRS # To assign the CRS (IF IT IS KNOWN!!!)
str(x) # Note the presence of proj4string info&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Formal class &amp;#39;SpatialPoints&amp;#39; [package &amp;quot;sp&amp;quot;] with 3 slots
##   ..@ coords     : num [1:1000, 1:2] 318630 329097 324656 324612 324156 ...
##   .. ..- attr(*, &amp;quot;dimnames&amp;quot;)=List of 2
##   .. .. ..$ : chr [1:1000] &amp;quot;1&amp;quot; &amp;quot;2&amp;quot; &amp;quot;3&amp;quot; &amp;quot;4&amp;quot; ...
##   .. .. ..$ : chr [1:2] &amp;quot;coords.x1&amp;quot; &amp;quot;coords.x2&amp;quot;
##   ..@ bbox       : num [1:2, 1:2] 315518 6410827 333832 6434186
##   .. ..- attr(*, &amp;quot;dimnames&amp;quot;)=List of 2
##   .. .. ..$ : chr [1:2] &amp;quot;coords.x1&amp;quot; &amp;quot;coords.x2&amp;quot;
##   .. .. ..$ : chr [1:2] &amp;quot;min&amp;quot; &amp;quot;max&amp;quot;
##   ..@ proj4string:Formal class &amp;#39;CRS&amp;#39; [package &amp;quot;sp&amp;quot;] with 1 slot
##   .. .. ..@ projargs: chr &amp;quot;+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs +towgs84=0,0,0&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Lastly, its always good practice to remove objects from R’s memory if we won’t need them again… See next post on &lt;a href=&#34;http://www.ecologi.st/post/big-spatial-data/&#34;&gt;&lt;strong&gt;handling big spatial data and memory management&lt;/strong&gt;&lt;/a&gt; for more on this.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rm(x)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;NOTE: Many spatial data objects use “slots” to store various components of the data (the “@” symbols revealed when we look at the data structure with the str() function). The slots can be accessed using “@” like you would “$” to call a variable from a dataframe or object from a list, but it is RECOMMENDED THAT YOU DO NOT DO THIS… The reason being that slots were designed so that the R package developers can change the way slots work to improve efficiency, handle new or different objects etc. If you write code that accesses slots directly it may break next time the libraries are updated. There are functions for accessing all slots (e.g. proj4string(), coordinates(), etc.) or you can simply use regular dataframe functionality.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;raster-data-mostly-functions-from-libraryraster&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Raster data (mostly functions from library(raster))&lt;/h3&gt;
&lt;p&gt;Let’s get a digital elevation model (DEM) from the SRTM90 (Shuttle Radar Topography Mission)* digital elevation database, match projection, and trim to the same extent as “pts”.&lt;/p&gt;
&lt;p&gt;*&lt;sub&gt;&lt;sup&gt;Jarvis A., H.I. Reuter, A. Nelson, E. Guevara, 2008, Hole-filled seamless SRTM data V4, International Centre for Tropical Agriculture (CIAT), available from &lt;a href=&#34;http://srtm.csi.cgiar.org&#34; class=&#34;uri&#34;&gt;http://srtm.csi.cgiar.org&lt;/a&gt; &lt;/sup&gt;&lt;/sub&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div id=&#34;reading-in-reprojecting-and-cropping-raster-data&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Reading in, reprojecting and cropping raster data&lt;/h4&gt;
&lt;p&gt;We can download the data directly with R using the function getData() (type ?getData for details), but this can be slow because it downloads a much bigger area than we need. To save time I’ve downloaded the data before and saved it locally with the “path =” setting. I’ve also provided you with a link to the subsetted data you need in the &lt;a href=&#34;http://www.ecologi.st/post/spatial-data-in-r-2-a-practical-example/#data-description&#34;&gt;&lt;strong&gt;Data Description&lt;/strong&gt;&lt;/a&gt; section of the post above. Here’s the code if you’re interested - hashed (#) out so R sees it as a comment and doesn’t run it.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#dem &amp;lt;- getData(&amp;#39;SRTM&amp;#39;, lon=19, lat=-32.5, path = paste0(giswd, &amp;quot;SRTM/&amp;quot;)) # download data from CGIAR website&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Instead we’ll read the data in from the local source using the very versatile raster() function.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dem &amp;lt;- raster(paste0(giswd, &amp;quot;SRTM/srtm_40_19.tif&amp;quot;)) # read in data from local source - NOTE THAT YOU MAY NEED TO UNZIP THE FILE YOU DOWNLOADED in the Data Description section!!!
proj4string(dem)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;This is not our chosen projection for this tutorial so we need to reproject.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dem &amp;lt;- projectRaster(dem, crs=CRS(stdCRS)) # note that we use a different function for raster data than for shapefiles (points or polygon) - this can take a while...
proj4string(dem)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;+proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs +towgs84=0,0,0&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s look at the extent of the DEM relative to the cedar locality data.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;extent(dem)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : Extent 
## xmin        : -79731.16 
## xmax        : 409252.3 
## ymin        : 6109993 
## ymax        : 6681302&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;extent(pts)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : Extent 
## xmin        : 315517.9 
## xmax        : 333832.2 
## ymin        : 6410827 
## ymax        : 6434186&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Our DEM has a MUCH larger extent than our cedars of interest and we should crop it.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;E &amp;lt;- extent(pts) + c(-900, 900, -900, 900) # The &amp;quot;+ c(...)&amp;quot; term adds a 900m buffer around the trees
dem &amp;lt;- crop(dem, E) # Crop DEM to the buffered extent&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Let’s have a quick look at what we’re working with (using the basic plot functions).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(dem) #plot the digital elevation model
points(pts, pch=20, cex=.1) #add the cedar localities&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-20-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;calculating-topographic-information-from-a-dem&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Calculating topographic information from a DEM&lt;/h4&gt;
&lt;p&gt;Now that we have the DEM cleaned up for our study let’s use the terrain() function to calculate/extract some topographic information. Note that terrain() is based on the more versatile focal() function, should you want to design your own indices etc. Also see rasterEngine() in library(spatial.tools) which is an equivalent, but with easy parallel processing capability.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;slope &amp;lt;- terrain(dem, &amp;quot;slope&amp;quot;)
aspect &amp;lt;- terrain(dem, &amp;quot;aspect&amp;quot;)
TPI &amp;lt;- terrain(dem, &amp;quot;TPI&amp;quot;) # Topographic Position Index
TRI &amp;lt;- terrain(dem, &amp;quot;TRI&amp;quot;) # Terrain Ruggedness Index
roughness &amp;lt;- terrain(dem, &amp;quot;roughness&amp;quot;)
flowdir &amp;lt;- terrain(dem, &amp;quot;flowdir&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;But “aspect” is circular so small changes in the northern aspects (e.g. 2 to 358 degrees) look like big changes in the data. We can break aspect down into east-westness and north-southness using sin() and cos() - remember your trigonometry? (DISCLAIMER: This approach is not perfect and I’d recommend reading up about it if you intend to use it in your research).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;eastwest &amp;lt;- sin(aspect)
northsouth &amp;lt;- cos(aspect)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;renaming-and-stacking-rasters&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Renaming and stack()ing rasters&lt;/h4&gt;
&lt;p&gt;Dealing with all these different rasters gets a bit cumbersome, but they have the same extent, resolution and grid so we can stack() them into one object. But first, we should make sure the data are named in a sensible way otherwise they can all end out being named “layer”…&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;names(eastwest)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;layer&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;names(northsouth) &lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;layer&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;names(dem)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;srtm_40_19&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;names(eastwest) &amp;lt;- &amp;quot;eastwest&amp;quot; # To rename the data in the raster
names(northsouth) &amp;lt;- &amp;quot;northsouth&amp;quot;
names(dem) &amp;lt;- &amp;quot;dem&amp;quot;
topo &amp;lt;- stack(dem, slope, eastwest, northsouth, TPI, TRI, roughness, flowdir)
topo&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterStack 
## dimensions  : 272, 257, 69904, 8  (nrow, ncol, ncell, nlayers)
## resolution  : 78.3, 92.4  (x, y)
## extent      : 314587.6, 334710.7, 6409924, 6435056  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs +towgs84=0,0,0 
## names       :         dem,       slope,    eastwest,  northsouth,         tpi,         tri,   roughness,     flowdir 
## min values  : 296.3650828,   0.0006550,  -1.0000000,  -1.0000000, -70.5164504,   0.2751995,   0.8269874,   1.0000000 
## max values  : 1956.993141,    1.122555,    1.000000,    1.000000,   91.157818,  140.499398,  438.959923,  128.000000&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Another way to rename rasters in a stack
# names(topo) &amp;lt;- c(&amp;quot;name1&amp;quot;, &amp;quot;name2&amp;quot;&amp;quot;, etc)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Let’s look at what we’ve made.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(topo)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-24-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;rasterizing-aggregating-and-raster-calculations&#34; class=&#34;section level4&#34;&gt;
&lt;h4&gt;Rasterizing, aggregating and raster calculations&lt;/h4&gt;
&lt;p&gt;The &lt;em&gt;raster&lt;/em&gt; library provides an amazing and very versatile environment for creating and working with rasters.&lt;/p&gt;
&lt;p&gt;e.g. You easily can convert other data types into rasters using rasterize(), which allows you to specify the raster extent and resolution (or match an existing raster), and can apply functions so that you can chose what aspect of the data you’d like to focus on (e.g. the min, max or sum of a field in the attribute table of your vector layer). Here let’s rasterize the cedar points layer and calculate the tree density by 90m grid cell from the DEM.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dens &amp;lt;- rasterize(pts, dem, field=&amp;quot;Name&amp;quot;, fun=&amp;quot;count&amp;quot;)
plot(dens)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-25-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;See anything? Probably not, these are 90m pixels in a large landscape… We can aggregate() the 90m pixels into larger units to make them more visible - e.g. 210m pixels by aggregating by a factor of three.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(aggregate(dens, fact=3, fun=&amp;quot;sum&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-26-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt; Better!&lt;/p&gt;
&lt;p&gt;We can also apply raster calculations to only show the subset of cells with more than 10 trees - plotted in red to make it more visible.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(dens&amp;gt;10, col=&amp;quot;red&amp;quot;)  # Use raster calculations to subset&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-27-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Note that you can add, subtract, multiply and divide rasters using code like &lt;em&gt;raster1 + raster2&lt;/em&gt; etc, which allows you to easily do some quite complicated calculations. Its also worth exploring the calc() function for designing and implementing more complicated functions.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;polygons&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Polygons!&lt;/h3&gt;
&lt;p&gt;Perhaps the best place to start is the National Vegetation Map of South Africa, Lesotho and Swaziland. Let’s get the data, set the CRS and crop to our area/extent of interest. Note that polygons, points and lines are all vector data (as opposed to raster) and you can handle them using the same functions.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;vegmap &amp;lt;- readOGR(dsn=paste0(giswd, &amp;quot;VegMap/nvm2012beta2_wgs84_Geo&amp;quot;), layer=&amp;quot;nvm2012beta2_wgs84_Geo&amp;quot;) # Get the data&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## OGR data source with driver: ESRI Shapefile 
## Source: &amp;quot;/Users/jasper/Documents/GIS/VegMap/nvm2012beta2_wgs84_Geo&amp;quot;, layer: &amp;quot;nvm2012beta2_wgs84_Geo&amp;quot;
## with 44822 features
## It has 21 fields&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;head(vegmap) # Have a look at the first 6 rows of the attribute table &lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   OBJECTID_1                      NAME MAPCODE12 MPCDSUBT
## 0          0  Agulhas Limestone Fynbos      FFl1     &amp;lt;NA&amp;gt;
## 1          1  Agulhas Limestone Fynbos      FFl1     &amp;lt;NA&amp;gt;
## 2          2  Cape Seashore Vegetation      AZd3     &amp;lt;NA&amp;gt;
## 3          3  Cape Seashore Vegetation      AZd3     &amp;lt;NA&amp;gt;
## 4          4  Cape Seashore Vegetation      AZd3     &amp;lt;NA&amp;gt;
## 5          5 Overberg Sandstone Fynbos     FFs12     &amp;lt;NA&amp;gt;
##                      BIOREGION             BIOME CHANGE_VER  CHANGE_REF
## 0 South Coast Fynbos Bioregion            Fynbos       VM06 VegMap 2006
## 1 South Coast Fynbos Bioregion            Fynbos       VM06 VegMap 2006
## 2          Seashore Vegetation Azonal Vegetation       VM06 VegMap 2006
## 3          Seashore Vegetation Azonal Vegetation       VM06 VegMap 2006
## 4          Seashore Vegetation Azonal Vegetation       VM06 VegMap 2006
## 5   Southwest Fynbos Bioregion            Fynbos       VM06 VegMap 2006
##   CNSRV_TRGT SHAPE_LENG  SHAPE_AREA BIOMECODE GRPCODE               GROUP
## 0         32   5028.778   661226.69         F     FFl    Limestone Fynbos
## 1         32  25681.966 11720744.76         F     FFl    Limestone Fynbos
## 2         20   5624.948   332448.42        AZ     AZd Seashore Vegetation
## 3         20   2241.355    73488.36        AZ     AZd Seashore Vegetation
## 4         20  17366.045  1229468.26        AZ     AZd Seashore Vegetation
## 5         30   1295.837   120756.02         F     FFs    Sandstone Fynbos
##   BRGNCODE                            LEGEND VTYPSQKM12
## 0      F04   FFl 1  Agulhas Limestone Fynbos   294.4978
## 1      F04   FFl 1  Agulhas Limestone Fynbos   294.4978
## 2      AZd   AZd 3  Cape Seashore Vegetation   243.5824
## 3      AZd   AZd 3  Cape Seashore Vegetation   243.5824
## 4      AZd   AZd 3  Cape Seashore Vegetation   243.5824
## 5      F02 FFs 12  Overberg Sandstone Fynbos  1169.4725
##                         DOCLINK SUBTYPENM    BKSORT POLYSQKM
## 0 Descriptions\\FFl_1_2006.docx      &amp;lt;NA&amp;gt; 01 11 001   0.6612
## 1 Descriptions\\FFl_1_2006.docx      &amp;lt;NA&amp;gt; 01 11 001  11.7207
## 2 Descriptions\\AZd_3_2006.docx      &amp;lt;NA&amp;gt; 10 02 003   0.3324
## 3 Descriptions\\AZd_3_2006.docx      &amp;lt;NA&amp;gt; 10 02 003   0.0735
## 4 Descriptions\\AZd_3_2006.docx      &amp;lt;NA&amp;gt; 10 02 003   1.2295
## 5 Descriptions\\FFs12_2006.docx      &amp;lt;NA&amp;gt; 01 01 012   0.1208&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;extent(vegmap) # Check the extent&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : Extent 
## xmin        : 16.45696 
## xmax        : 32.8914 
## ymin        : -34.8334 
## ymax        : -22.12583&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;proj4string(vegmap) # Check the projection&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;vegmap &amp;lt;- spTransform(vegmap, CRS(stdCRS)) # Reproject - This can take a while...
vegmap &amp;lt;- crop(vegmap, E) # Note that extent (E) was created earlier&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Loading required namespace: rgeos&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s make a basic plot of what we’ve cropped…&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;cols &amp;lt;- rainbow(length(unique(vegmap$NAME))) # Make a set of 8 colours
plot(vegmap, col = cols[as.factor(as.character(vegmap$NAME))]) # Plot the map coloured by veg type
legend(&amp;quot;bottomleft&amp;quot;, legend = levels(as.factor(as.character(vegmap$NAME))), text.col = cols, cex=.6) # Add a legend
points(pts, pch=20, cex=.1) # Add the trees&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-29-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Looks like our cedars are restricted to “Cederberg Sandstone Fynbos”, but we can test that by extracting the veg type for each tree location. Note that there are a few ways of extracting data from spatial objects - we’ll use variants of the over() function for shapefiles.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;treeveg &amp;lt;- over(pts, vegmap)
treeveg2 &amp;lt;- pts %over% vegmap
identical(treeveg, treeveg2)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] TRUE&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Note the two different approaches give the same result! Each have their own advantages depending on your style of coding, but I’ll leave it to you to find out more.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;We’ve extracted the attribute table data for the vegtypes that each tree intersects into a new dataframe.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;head(treeveg)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   OBJECTID_1                       NAME MAPCODE12 MPCDSUBT
## 1       7421 Cederberg Sandstone Fynbos      FFs4     &amp;lt;NA&amp;gt;
## 2       7421 Cederberg Sandstone Fynbos      FFs4     &amp;lt;NA&amp;gt;
## 3       7421 Cederberg Sandstone Fynbos      FFs4     &amp;lt;NA&amp;gt;
## 4       7421 Cederberg Sandstone Fynbos      FFs4     &amp;lt;NA&amp;gt;
## 5       7421 Cederberg Sandstone Fynbos      FFs4     &amp;lt;NA&amp;gt;
## 6       7421 Cederberg Sandstone Fynbos      FFs4     &amp;lt;NA&amp;gt;
##                    BIOREGION  BIOME CHANGE_VER      CHANGE_REF CNSRV_TRGT
## 1 Northwest Fynbos Bioregion Fynbos       VM09 Helme (2007) WC         29
## 2 Northwest Fynbos Bioregion Fynbos       VM09 Helme (2007) WC         29
## 3 Northwest Fynbos Bioregion Fynbos       VM09 Helme (2007) WC         29
## 4 Northwest Fynbos Bioregion Fynbos       VM09 Helme (2007) WC         29
## 5 Northwest Fynbos Bioregion Fynbos       VM09 Helme (2007) WC         29
## 6 Northwest Fynbos Bioregion Fynbos       VM09 Helme (2007) WC         29
##   SHAPE_LENG SHAPE_AREA BIOMECODE GRPCODE            GROUP BRGNCODE
## 1    1590266 2151887041         F     FFs Sandstone Fynbos      F01
## 2    1590266 2151887041         F     FFs Sandstone Fynbos      F01
## 3    1590266 2151887041         F     FFs Sandstone Fynbos      F01
## 4    1590266 2151887041         F     FFs Sandstone Fynbos      F01
## 5    1590266 2151887041         F     FFs Sandstone Fynbos      F01
## 6    1590266 2151887041         F     FFs Sandstone Fynbos      F01
##                              LEGEND VTYPSQKM12
## 1 FFs 4  Cederberg Sandstone Fynbos   2512.221
## 2 FFs 4  Cederberg Sandstone Fynbos   2512.221
## 3 FFs 4  Cederberg Sandstone Fynbos   2512.221
## 4 FFs 4  Cederberg Sandstone Fynbos   2512.221
## 5 FFs 4  Cederberg Sandstone Fynbos   2512.221
## 6 FFs 4  Cederberg Sandstone Fynbos   2512.221
##                         DOCLINK SUBTYPENM    BKSORT POLYSQKM
## 1 Descriptions\\FFs_4_2006.docx      &amp;lt;NA&amp;gt; 01 01 004 2151.887
## 2 Descriptions\\FFs_4_2006.docx      &amp;lt;NA&amp;gt; 01 01 004 2151.887
## 3 Descriptions\\FFs_4_2006.docx      &amp;lt;NA&amp;gt; 01 01 004 2151.887
## 4 Descriptions\\FFs_4_2006.docx      &amp;lt;NA&amp;gt; 01 01 004 2151.887
## 5 Descriptions\\FFs_4_2006.docx      &amp;lt;NA&amp;gt; 01 01 004 2151.887
## 6 Descriptions\\FFs_4_2006.docx      &amp;lt;NA&amp;gt; 01 01 004 2151.887&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s look at the number of trees by veg type. Note the use of droplevels! If you don’t do this summary() will report all ~440 vegetation types in the country where cedars do not occur too… If you don’t know what I’m talking about you REALLY need to find out about factor levels - &lt;a href=&#34;https://swcarpentry.github.io/r-novice-inflammation/12-supp-factors/&#34;&gt;&lt;strong&gt;try this&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;summary(droplevels(treeveg$NAME))&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##            Cederberg Sandstone Fynbos 
##                                   980 
##            Fynbos Riparian Vegetation 
##                                    14 
## Northern Inland Shale Band Vegetation 
##                                     5 
##             Olifants Sandstone Fynbos 
##                                     1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So a few trees stray off Cederberg Sandstone Fynbos, but this could be errors in the veg mapping. Our vegmap is mostly mapped at 1:250 000 scale (i.e. ~2km error), while our tree locations are accurate to 10m…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s play with the CapeNature fire record data we downloaded earlier. Firstly, we get the data and transform to our standard CRS as for the vegmap.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;firelayers &amp;lt;- readOGR(dsn=paste0(giswd, &amp;quot;CFR/All_fires_16_17_gw&amp;quot;), layer=&amp;quot;All_fires_16_17_gw&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## OGR data source with driver: ESRI Shapefile 
## Source: &amp;quot;/Users/jasper/Documents/GIS/CFR/All_fires_16_17_gw&amp;quot;, layer: &amp;quot;All_fires_16_17_gw&amp;quot;
## with 3842 features
## It has 16 fields
## Integer64 fields read as strings:  id&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;proj4string(firelayers)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;firelayers &amp;lt;- spTransform(firelayers, CRS(stdCRS))
extent(firelayers)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : Extent 
## xmin        : 250253.7 
## xmax        : 733752.2 
## ymin        : 6150231 
## ymax        : 6453673&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Note that the fire data covers all CapeNature reserves across the CFR - I’ve done a quick and dirty exploration of patterns and trends for the whole region &lt;a href=&#34;http://www.ecologi.st/post/fire/&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt; for those interested. We could crop() to our extent (E), but there are other ways. Let’s explore and manipulate the data object a little. Note that the str() function is not useful when there are many layers (e.g. fires) - it just prints out all the details for each of the ~3500 separate fire layers… but calling the name of a spatial* object usually reports a summary and we can always explore the data as one does a dataframe.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;firelayers&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : SpatialPolygonsDataFrame 
## features    : 3842 
## extent      : 250253.7, 733752.2, 6150231, 6453673  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=34 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs +towgs84=0,0,0 
## variables   : 16
## names       :   id,       FIRE_CODE, Res_code,  Region, Month, Year, Res_centre,                Res_name,                   Local_desc,  Datestart, Dateexting,  Datewithd,     Report_off,    Police_Cas,                    Ignitionca, ... 
## min values  :    0, ANYS/00/1986/01,     ANYS, Central,     0, 1927,   Anysberg,            Anysberg MCA,                            ?, 1927/05/28, 1940/06/27, 1944/01/16,             ??,             -, Fire operations - Block burns, ... 
## max values  : 9012, WBAY/12/2015/01,     WBAY, Western,    12, 2017,   Waterval, Zuurberg Nature Reserve, Zwartnek - west of Bergplaas, 2017/06/06, 7197/07/31, 2915/09/18, Zibele Blekiwe, yb285/11/2000,             Unknown - Unknown, ...&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;head(firelayers)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   id       FIRE_CODE Res_code  Region Month Year Res_centre
## 0  0 OUTE/05/1927/01     OUTE Eastern     5 1927  Outeniqua
## 1  0 SWBG/12/1930/01     SWBG Eastern    12 1930  Swartberg
## 2  0 SWBG/01/1931/01     SWBG Eastern     1 1931  Swartberg
## 3  0 SWBG/08/1932/01     SWBG Eastern     8 1932  Swartberg
## 4  0 SWBG/02/1933/01     SWBG Eastern     2 1933  Swartberg
## 5  0 SWBG/02/1933/02     SWBG Eastern     2 1933  Swartberg
##                         Res_name                      Local_desc
## 0      Witfontein Nature Reserve                    3322CD - 342
## 1 Groot Swartberg Nature Reserve   Paardevley.3322BD.Fire no A1.
## 2 Groot Swartberg Nature Reserve  De Wetsvley.3322AC.Fire no A2.
## 3 Groot Swartberg Nature Reserve    Plaatberg.3321BD.Fire no.B1.
## 4             Grootswartberg MCA Blauwpunt.3322AD-BC.Fire no C1.
## 5 Groot Swartberg Nature Reserve    Grootvlei.3321BD.Fire no.C2.
##    Datestart Dateexting Datewithd Report_off Police_Cas
## 0 1927/05/28       &amp;lt;NA&amp;gt;      &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;
## 1 1930/12/28       &amp;lt;NA&amp;gt;      &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;
## 2 1931/01/18       &amp;lt;NA&amp;gt;      &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;
## 3 1932/08/17       &amp;lt;NA&amp;gt;      &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;
## 4 1933/02/11       &amp;lt;NA&amp;gt;      &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;
## 5 1933/02/11       &amp;lt;NA&amp;gt;      &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;
##            Ignitionca     Area_ha
## 0   Unknown - Unknown    3.852058
## 1 Natural - Lightning  172.562725
## 2 Natural - Lightning  198.357564
## 3     People - Farmer 2363.599963
## 4   Unknown - Unknown 5391.986432
## 5   Unknown - Unknown 2999.420641&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;names(firelayers)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;id&amp;quot;         &amp;quot;FIRE_CODE&amp;quot;  &amp;quot;Res_code&amp;quot;   &amp;quot;Region&amp;quot;     &amp;quot;Month&amp;quot;     
##  [6] &amp;quot;Year&amp;quot;       &amp;quot;Res_centre&amp;quot; &amp;quot;Res_name&amp;quot;   &amp;quot;Local_desc&amp;quot; &amp;quot;Datestart&amp;quot; 
## [11] &amp;quot;Dateexting&amp;quot; &amp;quot;Datewithd&amp;quot;  &amp;quot;Report_off&amp;quot; &amp;quot;Police_Cas&amp;quot; &amp;quot;Ignitionca&amp;quot;
## [16] &amp;quot;Area_ha&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;class(firelayers$Res_centre)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;factor&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;levels(firelayers$Res_centre)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;Anysberg&amp;quot;           &amp;quot;Cederberg&amp;quot;          &amp;quot;De Hoop&amp;quot;           
##  [4] &amp;quot;De Mond&amp;quot;            &amp;quot;Driftsands&amp;quot;         &amp;quot;Gamkaberg&amp;quot;         
##  [7] &amp;quot;Ganzekraal&amp;quot;         &amp;quot;Geelkranz&amp;quot;          &amp;quot;Goukamma&amp;quot;          
## [10] &amp;quot;Grootvadersbosch&amp;quot;   &amp;quot;Grootwinterhoek&amp;quot;    &amp;quot;Hottentots-Holland&amp;quot;
## [13] &amp;quot;Jonkershoek&amp;quot;        &amp;quot;Kammanassie&amp;quot;        &amp;quot;Keurbooms&amp;quot;         
## [16] &amp;quot;Kogelberg&amp;quot;          &amp;quot;Limietberg&amp;quot;         &amp;quot;Marloth&amp;quot;           
## [19] &amp;quot;Matjiesrivier&amp;quot;      &amp;quot;Outeniqua&amp;quot;          &amp;quot;Riverlands&amp;quot;        
## [22] &amp;quot;Robberg&amp;quot;            &amp;quot;Swartberg&amp;quot;          &amp;quot;Towerkop&amp;quot;          
## [25] &amp;quot;Vrolijkheid&amp;quot;        &amp;quot;Walker Bay&amp;quot;         &amp;quot;Waterval&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;unique(firelayers$Res_centre)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] Outeniqua          Swartberg          Jonkershoek       
##  [4] Towerkop           Gamkaberg          Cederberg         
##  [7] Kammanassie        Kogelberg          Limietberg        
## [10] Vrolijkheid        Hottentots-Holland Grootvadersbosch  
## [13] Marloth            Grootwinterhoek    Waterval          
## [16] De Hoop            Anysberg           De Mond           
## [19] Walker Bay         Goukamma           Riverlands        
## [22] Keurbooms          Robberg            Driftsands        
## [25] Ganzekraal         Geelkranz          Matjiesrivier     
## 27 Levels: Anysberg Cederberg De Hoop De Mond Driftsands ... Waterval&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Note that we can subset shapefiles based on fields in the attribute table using indexing as one does with a regular dataframe. Each fire polygon is a separate row in the attribute table so we can extract all fires from the Cederberg by subsetting only the rows where the Res_centre = “Cederberg”.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;firelayers &amp;lt;- firelayers[which(firelayers$Res_centre==&amp;quot;Cederberg&amp;quot;),]
firelayers$Res_centre &amp;lt;- droplevels(firelayers$Res_centre) # Remove unwanted factor levels that were passed on from the original full extent
levels(firelayers$Res_centre)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;Cederberg&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(firelayers) # Plot (without colours)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-35-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;A cobweb? But vaguely the right shape to suggest its the Cederberg.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Let’s use rasterize() to create a raster of the number of fires in each 90m pixel of our digital elevation model, which may be prettier to plot. Since we want a raster of the count of fires per pixel we’ll set the function argument withing rasterize() to fun=“count”. Note that this requires a field/column with a unique value for each fire and we’re not sure if we have that, so we’ll create a new unique ID field “uID” and apply the function to that field.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;firelayers$uID &amp;lt;- 1:nrow(firelayers) # Add an unique ID for each fire
firecount &amp;lt;- rasterize(firelayers, dem, field=&amp;quot;uID&amp;quot;, fun=&amp;quot;count&amp;quot;) # A count of all fires in each pixel
plot(firecount) # Note that the extent of our firelayers is larger than the DEM, but when rasterizing to an existing grid R trims it to the smaller extent automatically
points(pts, pch=20, cex=.1) # Add the trees&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-36-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now lets rasterize() each fire (date) into it’s own raster, but first we need to look at the underlying data and see if this will work…&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;names(firelayers)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##  [1] &amp;quot;id&amp;quot;         &amp;quot;FIRE_CODE&amp;quot;  &amp;quot;Res_code&amp;quot;   &amp;quot;Region&amp;quot;     &amp;quot;Month&amp;quot;     
##  [6] &amp;quot;Year&amp;quot;       &amp;quot;Res_centre&amp;quot; &amp;quot;Res_name&amp;quot;   &amp;quot;Local_desc&amp;quot; &amp;quot;Datestart&amp;quot; 
## [11] &amp;quot;Dateexting&amp;quot; &amp;quot;Datewithd&amp;quot;  &amp;quot;Report_off&amp;quot; &amp;quot;Police_Cas&amp;quot; &amp;quot;Ignitionca&amp;quot;
## [16] &amp;quot;Area_ha&amp;quot;    &amp;quot;uID&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;firelayers$Datestart&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   [1] 1944/01/01 &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       1948/02/01
##   [7] 1955/02/11 1956/04/15 1956/04/01 1958/03/29 1958/04/17 1958/04/18
##  [13] 1958/05/01 &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       1959/02/09
##  [19] 1959/03/23 1959/09/01 1959/10/01 1963/09/28 1963/01/10 1965/03/09
##  [25] 1965/11/14 1965/01/29 1966/10/06 1967/03/11 1967/09/06 1967/12/29
##  [31] &amp;lt;NA&amp;gt;       1968/09/13 &amp;lt;NA&amp;gt;       1969/03/22 1969/08/12 1969/09/29
##  [37] 1969/09/29 1969/09/29 1969/09/29 1970/02/03 1970/02/05 2006/03/18
##  [43] 2006/03/18 1970/04/21 1971/03/23 1971/07/20 &amp;lt;NA&amp;gt;       1972/03/11
##  [49] &amp;lt;NA&amp;gt;       1972/05/01 1972/10/14 1972/12/07 1973/02/27 1973/02/27
##  [55] 1973/04/24 1974/12/09 &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       1975/02/15 &amp;lt;NA&amp;gt;      
##  [61] 1975/11/26 1975/12/12 &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;      
##  [67] 1976/01/30 1978/09/07 1978/09/18 1978/09/26 1978/10/05 1978/10/25
##  [73] 1979/04/22 1979/08/06 1979/08/13 1979/08/14 1979/08/21 1979/08/24
##  [79] 1979/12/25 1979/01/03 &amp;lt;NA&amp;gt;       1980/05/12 1980/05/29 1980/06/02
##  [85] 1980/06/02 1980/06/02 1980/07/21 1980/08/14 1980/08/21 1980/08/25
##  [91] 1981/02/20 1981/06/10 &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       1982/05/12
##  [97] 1982/05/14 1982/05/14 1982/08/16 1982/08/17 1982/08/23 1982/08/25
## [103] 1982/09/22 1982/09/22 &amp;lt;NA&amp;gt;       1984/03/09 1984/03/22 1984/11/07
## [109] 1984/11/30 &amp;lt;NA&amp;gt;       1985/02/02 1985/02/02 1985/11/18 &amp;lt;NA&amp;gt;      
## [115] 1986/12/14 1986/01/02 1986/01/14 1987/04/13 1987/04/03 1987/01/24
## [121] &amp;lt;NA&amp;gt;       1988/12/28 1988/12/28 1988/12/28 1988/12/28 1988/01/17
## [127] 1989/03/09 1989/04/26 1989/12/15 1989/01/15 1989/01/18 1990/05/25
## [133] &amp;lt;NA&amp;gt;       1991/04/30 1991/05/01 1991/05/12 1991/05/12 1991/05/12
## [139] 1991/05/12 1993/05/17 1993/05/17 1993/10/27 1993/01/13 1994/02/04
## [145] 1994/02/24 1995/05/23 1995/12/16 &amp;lt;NA&amp;gt;       1997/01/23 1998/02/15
## [151] 1998/03/05 1998/05/15 1998/05/15 1998/10/15 1998/10/19 1998/12/29
## [157] 1998/01/12 &amp;lt;NA&amp;gt;       &amp;lt;NA&amp;gt;       1999/12/12 2000/10/11 &amp;lt;NA&amp;gt;      
## [163] &amp;lt;NA&amp;gt;       2000/01/06 2001/03/06 2001/10/04 2002/02/24 2002/04/19
## [169] 2002/05/09 2002/12/06 2002/01/20 2002/01/01 2004/04/02 2004/09/21
## [175] 2004/12/22 2005/03/01 2005/10/11 2005/10/27 2005/11/09 2005/11/28
## [181] 2005/12/01 2006/02/06 2006/03/13 2006/03/28 2006/09/29 2006/12/05
## [187] 2006/12/23 2007/03/02 2007/03/02 2007/10/26 2007/01/19 2007/01/05
## [193] 2008/02/05 2008/02/07 2008/02/08 2008/01/12 2009/02/06 2009/03/11
## [199] 2009/12/10 2009/12/17 2010/02/10 2010/02/21 2011/02/18 2011/03/16
## [205] 2011/12/18 2011/01/31 2012/02/21 2012/02/22 2012/11/08 2012/11/20
## [211] 2012/12/14 2012/12/15 2012/12/21 2013/02/02 2013/02/02 2013/02/05
## [217] 2013/02/05 2013/03/11 2013/12/10 2013/12/20 2013/01/31 2013/01/25
## [223] 2013/01/25 2013/01/30 2013/01/16 2013/01/16 2014/02/13 2014/02/14
## [229] 2014/04/21 2014/07/22 2014/09/22 2014/12/19 2015/02/07 2015/02/20
## [235] 2015/02/21 2015/09/14 2015/09/14 2015/09/14 2015/09/14 2015/09/14
## [241] 2015/10/23 2015/11/21 2015/12/29 2016/03/05 2016/04/15 2016/04/19
## [247] 2016/05/23 2016/06/01 2016/09/09 2016/11/11 2016/12/15 2016/12/31
## [253] 2016/01/20 2016/01/17 2016/01/17 2016/01/09 2017/01/02
## 2540 Levels: 1927/05/28 1930/12/28 1931/01/18 1932/08/17 ... 2017/06/06&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;What proportion of the “burnt area” recorded in the fire database does not have a start date?&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sum(firelayers$Area_ha[is.na(firelayers$Datestart)])/sum(firelayers$Area_ha) &lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] 0.07369786&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Oh dear, lets use “Year” instead…&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;firelayers$Year&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   [1] 1944 1945 1945 1945 1947 1948 1955 1956 1956 1958 1958 1958 1958 1958
##  [15] 1958 1958 1958 1959 1959 1959 1959 1963 1963 1965 1965 1965 1966 1967
##  [29] 1967 1967 1967 1968 1968 1969 1969 1969 1969 1969 1969 1970 1970 1970
##  [43] 1970 1970 1971 1971 1971 1972 1972 1972 1972 1972 1973 1973 1973 1974
##  [57] 1974 1974 1975 1975 1975 1975 1975 1975 1976 1976 1976 1978 1978 1978
##  [71] 1978 1978 1979 1979 1979 1979 1979 1979 1979 1979 1979 1980 1980 1980
##  [85] 1980 1980 1980 1980 1980 1980 1981 1981 1981 1981 1981 1982 1982 1982
##  [99] 1982 1982 1982 1982 1982 1982 1982 1984 1984 1984 1984 1984 1985 1985
## [113] 1985 1985 1986 1986 1986 1987 1987 1987 1987 1988 1988 1988 1988 1988
## [127] 1989 1989 1989 1989 1989 1990 1990 1991 1991 1991 1991 1991 1991 1993
## [141] 1993 1993 1993 1994 1994 1995 1995 1995 1997 1998 1998 1998 1998 1998
## [155] 1998 1998 1998 1999 1999 1999 2000 2000 2000 2000 2001 2001 2002 2002
## [169] 2002 2002 2002 2002 2004 2004 2004 2005 2005 2005 2005 2005 2005 2006
## [183] 2006 2006 2006 2006 2006 2007 2007 2007 2007 2007 2008 2008 2008 2008
## [197] 2009 2009 2009 2009 2010 2010 2011 2011 2011 2011 2012 2012 2012 2012
## [211] 2012 2012 2012 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013
## [225] 2013 2013 2014 2014 2014 2014 2014 2014 2015 2015 2015 2015 2015 2015
## [239] 2015 2015 2015 2015 2015 2016 2016 2016 2016 2016 2016 2016 2016 2016
## [253] 2016 2016 2016 2016 2017&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now we’re going to loop through our fire years and rasterize them one by one. There are some issues we need to address though:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Firstly, this may create a large object in R’s memory and slow it down. We can get around this by writing each raster out to a file. Geotif and some other formats allow writing multiple rasters to one file. We should also dump any unwanted objects from memory using rm().&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Secondly, if there are a lot of cells in the raster and/or there are a lot of layers this operation may take some time either way. If we are on a multicore machine we can speed things up by parallelizing our code.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Thirdly, in this case we would like rasters for all years even if there were no fires (you’ll see why in a minute). We’ll use if() statements to identify years with no fires and fill these in with empty rasters (0’s only).&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Lastly, if you end out running the code multiple times then you don’t want to have to repeat big operations like this. We can use file.exists() combined with an if() statement to only run this chunk of code if the file does not exist - see code below.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;First let’s dump unwanted objects from memory and try rasterizing the fires on a single core using a normal &lt;em&gt;for&lt;/em&gt; loop.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rm(&amp;quot;aspect&amp;quot;,&amp;quot;slope&amp;quot;, &amp;quot;eastwest&amp;quot;, &amp;quot;northsouth&amp;quot;, &amp;quot;TPI&amp;quot;, &amp;quot;TRI&amp;quot;, &amp;quot;roughness&amp;quot;, &amp;quot;flowdir&amp;quot;)

years &amp;lt;- min(firelayers$Year):max(firelayers$Year) # Get the unique list of years

rfifile &amp;lt;- paste0(datwd, &amp;quot;fires_annual_90m.tif&amp;quot;) # Set a file name

system.time( # To time the process
if(!file.exists(rfifile)) { # Check if the file exists. If not, run this
td &amp;lt;- list() # Create an empty list
# Loop through years making a raster of burnt cells (1/0) for each
  for (i in 1:length(years)) { 
  y &amp;lt;- years[i] # The index year
  # If no fires that year, return a raster of zeros
  if(sum(firelayers$Year==y)==0)  
      td[[i]] &amp;lt;-  raster(extent(dem),res=res(dem),vals=0)
  # If there are fires, rasterize
  if(sum(firelayers$Year==y)&amp;gt;0) 
      td[[i]] &amp;lt;- rasterize(firelayers[which(firelayers$Year==y),],dem, field=&amp;quot;Year&amp;quot;, fun=&amp;quot;count&amp;quot;, background=0) 
  } # End loop
rfi &amp;lt;- stack(td) 
writeRaster(rfi,file=rfifile) # Write out rasters to one file
} # End if() statement
) # End timing&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    user  system elapsed 
##  15.756   0.676  17.388&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Note that you’ll see it takes 0 seconds on my machine - that’s because the statement &lt;em&gt;if(!file.exists(rfifile))&lt;/em&gt; on my machine is true (i.e. I’ve already made the output geotif), so none of that code ran. You should see something different the first time you run it.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;going-parallel&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Going parallel!!!&lt;/h3&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now lets try it in parallel using the &lt;em&gt;foreach/%dopar%&lt;/em&gt; loop in library(doMC)… This is just one of many ways of setting up parallel processing in R, and not necessarily the best. I’ve just used it because foreach() is an easy extention of a for() loop. There are many options!!! For a quick primer have a look at &lt;a href=&#34;http://gforge.se/2015/02/how-to-go-parallel-in-r-basics-tips/#Memory_load&#34;&gt;&lt;strong&gt;this blog post&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;First, we need to set the machine up for parallel processing by registering the cores we want to use as a cluster. We’ll autodetect the number of cores on your machine (using detectCores()) and use one less - allowing you to still work on other programmes on your machine while the code runs&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;registerDoMC(detectCores()-1)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s set an output file name and run the code in parallel with the foreach() function.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rfifileP &amp;lt;- paste0(datwd, &amp;quot;fires_annual_90m_parallel.tif&amp;quot;) # Set a file name

system.time( # To time the process
if(!file.exists(rfifileP)) { # Check if the file exists. If not, run this
# Start parallel processing
rfi &amp;lt;- foreach(y=years,.combine=stack,.packages=&amp;quot;raster&amp;quot;) %dopar% { 
 # Loop through years making a raster of burnt cells (1/0) for each
  # Check if there were any fires that year, if not, return zeros
  if(sum(firelayers$Year==y)==0) 
      td &amp;lt;-  raster(extent(dem),res=res(dem),vals=0)
  # If there are fires, rasterize
  if(sum(firelayers$Year==y)&amp;gt;0)
      td &amp;lt;- rasterize(firelayers[which(firelayers$Year==y),],dem, field=&amp;quot;Year&amp;quot;, fun=&amp;quot;count&amp;quot;, background=0) 
  # Return the individual raster
  return(td)
  } # End parallelized code
writeRaster(rfi,file=rfifileP) # Write out the set of rasters to one file
} # End if() statement
) # End timing&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    user  system elapsed 
##  29.096   2.919  18.246&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;There shouldn’t be much time difference on your machine in this case, but then this is a small example and most of the time is spent interpreting the input code rather than processing. Going parallel really pays when crunching big analyses…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now lets read in the layers we wrote out and plot them.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rfi &amp;lt;- stack(rfifile) # Read the files back in as a stack
rfi # Look at the stack&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterStack 
## dimensions  : 272, 257, 69904, 74  (nrow, ncol, ncell, nlayers)
## resolution  : 78.3, 92.4  (x, y)
## extent      : 314587.6, 334710.7, 6409924, 6435056  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=34 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names       : fires_annual_90m.1, fires_annual_90m.2, fires_annual_90m.3, fires_annual_90m.4, fires_annual_90m.5, fires_annual_90m.6, fires_annual_90m.7, fires_annual_90m.8, fires_annual_90m.9, fires_annual_90m.10, fires_annual_90m.11, fires_annual_90m.12, fires_annual_90m.13, fires_annual_90m.14, fires_annual_90m.15, ...&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;names(rfi)=paste0(&amp;quot;Fire_&amp;quot;,years) # Add year as name for each raster
rfi &amp;lt;- crop(rfi, E) # Crop to just our area of interest (speeds things up)
plot(rfi) # Plot all layers&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-43-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Pretty messy… there must be a sexier way?&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;animation&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Animation!&lt;/h3&gt;
&lt;p&gt;There are more and more ways of producing cool animations and interactive graphics in R. Here’s a simple example using library(animation). Note that this reqires installing the stand-alone software &lt;strong&gt;&lt;a href=&#34;http://www.imagemagick.org/&#34; class=&#34;uri&#34;&gt;http://www.imagemagick.org/&lt;/a&gt;&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if(!file.exists(paste0(reswd,&amp;quot;fires.gif&amp;quot;))) { # Check if the file exists
  saveGIF({
    for (i in 1:dim(rfi)[3]) plot(rfi[[i]],
                      main=names(rfi)[i],
                      legend.lab=&amp;quot;Fire!&amp;quot;,
                      col=rev(terrain.colors(2)),
                      breaks=c(-0.1,.1,1.1))}, 
    movie.name = paste0(reswd,&amp;quot;fires.gif&amp;quot;), 
    ani.width = 480, ani.height = 600, 
    interval=.5)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/fires.gif&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Hmm… not that impressive… What if we take advantage of raster calculations and add all the rasters leading up to each time step using sum()?&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if(!file.exists(paste0(reswd,&amp;quot;firesadded.gif&amp;quot;))) { # Check if the file exists
  saveGIF({
    for (i in 1:dim(rfi)[3]) plot(sum(rfi[[1:i]], na.rm=T), #Note the summing of rasters 1 to i
                      main=names(rfi)[i],
                      legend.lab=&amp;quot;Fire!&amp;quot;,
                      col=rev(terrain.colors(11)),
                      breaks=c(seq(-0.5,10.5,1)))}, 
    movie.name = paste0(reswd,&amp;quot;firesadded.gif&amp;quot;), 
    ani.width = 480, ani.height = 600, 
    interval=.5)
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/firesadded.gif&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Much prettier!&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;some-other-data-visualization-and-analysis&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Some other data visualization and analysis&lt;/h3&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# Plotting functions in library(rasterVis)
levelplot(dem)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-46-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;contourplot(dem)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-46-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;persp(dem)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-46-3.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Some fancy tricks with Google Earth and library(googleVis)…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;gbmap &amp;lt;- gmap(Mercator(rawpts), type = &amp;quot;satellite&amp;quot;)
plot(gbmap) #draws a blank, but it pops up when you add points&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-47-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;points(Mercator(rawpts), pch = 20, col = &amp;quot;red&amp;quot;, cex=.3)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-47-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;If you thought that was fancy, check this out! (Note that this only works for embedding into RMarkdown or an html page).&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;op &amp;lt;- options(gvis.plot.tag=&amp;quot;chart&amp;quot;) # Set gvis options for rmarkdown

points.gb &amp;lt;- as.data.frame(rawpts[sample(1:1000, 20),]) # Just select a few trees
points.gb$latlon &amp;lt;- paste(points.gb$coords.x2, points.gb$coords.x1, sep=&amp;quot;:&amp;quot;)
map.gb &amp;lt;- gvisMap(points.gb, locationvar=&amp;quot;latlon&amp;quot;, tipvar=&amp;quot;Name&amp;quot;)
plot(map.gb)&lt;/code&gt;&lt;/pre&gt;
&lt;!-- Map generated in R 3.5.1 by googleVis 0.6.2 package --&gt;
&lt;!-- Thu Aug 30 11:10:40 2018 --&gt;
&lt;!-- jsHeader --&gt;
&lt;script type=&#34;text/javascript&#34;&gt;
 
// jsData 
function gvisDataMapID28dd90d0222 () {
var data = new google.visualization.DataTable();
var datajson =
[
 [
-32.3604409,
19.07229827,
&#34;&#34;
],
[
-32.31894955,
19.14131742,
&#34;&#34;
],
[
-32.33861934,
19.1131623,
&#34;&#34;
],
[
-32.22804978,
19.06800487,
&#34;&#34;
],
[
-32.28666554,
19.12908105,
&#34;&#34;
],
[
-32.35483019,
19.19307619,
&#34;&#34;
],
[
-32.31372884,
19.13603649,
&#34;&#34;
],
[
-32.35717619,
19.06980124,
&#34;&#34;
],
[
-32.35729474,
19.0774272,
&#34;&#34;
],
[
-32.2211819,
19.08510646,
&#34;&#34;
],
[
-32.23255777,
19.08601471,
&#34;&#34;
],
[
-32.32210523,
19.10179585,
&#34;&#34;
],
[
-32.32456092,
19.13469706,
&#34;&#34;
],
[
-32.29855415,
19.10817771,
&#34;&#34;
],
[
-32.42335745,
19.18637378,
&#34;&#34;
],
[
-32.2810063,
19.11242129,
&#34;&#34;
],
[
-32.3321902,
19.11513294,
&#34;&#34;
],
[
-32.21691461,
19.07624011,
&#34;&#34;
],
[
-32.24217522,
19.09339992,
&#34;&#34;
],
[
-32.38256557,
19.11882699,
&#34;&#34;
] 
];
data.addColumn(&#39;number&#39;,&#39;Latitude&#39;);
data.addColumn(&#39;number&#39;,&#39;Longitude&#39;);
data.addColumn(&#39;string&#39;,&#39;Name&#39;);
data.addRows(datajson);
return(data);
}
 
// jsDrawChart
function drawChartMapID28dd90d0222() {
var data = gvisDataMapID28dd90d0222();
var options = {};
options[&#34;showTip&#34;] = true;

    var chart = new google.visualization.Map(
    document.getElementById(&#39;MapID28dd90d0222&#39;)
    );
    chart.draw(data,options);
    

}
  
 
// jsDisplayChart
(function() {
var pkgs = window.__gvisPackages = window.__gvisPackages || [];
var callbacks = window.__gvisCallbacks = window.__gvisCallbacks || [];
var chartid = &#34;map&#34;;
  
// Manually see if chartid is in pkgs (not all browsers support Array.indexOf)
var i, newPackage = true;
for (i = 0; newPackage &amp;&amp; i &lt; pkgs.length; i++) {
if (pkgs[i] === chartid)
newPackage = false;
}
if (newPackage)
  pkgs.push(chartid);
  
// Add the drawChart function to the global list of callbacks
callbacks.push(drawChartMapID28dd90d0222);
})();
function displayChartMapID28dd90d0222() {
  var pkgs = window.__gvisPackages = window.__gvisPackages || [];
  var callbacks = window.__gvisCallbacks = window.__gvisCallbacks || [];
  window.clearTimeout(window.__gvisLoad);
  // The timeout is set to 100 because otherwise the container div we are
  // targeting might not be part of the document yet
  window.__gvisLoad = setTimeout(function() {
  var pkgCount = pkgs.length;
  google.load(&#34;visualization&#34;, &#34;1&#34;, { packages:pkgs, callback: function() {
  if (pkgCount != pkgs.length) {
  // Race condition where another setTimeout call snuck in after us; if
  // that call added a package, we must not shift its callback
  return;
}
while (callbacks.length &gt; 0)
callbacks.shift()();
} });
}, 100);
}
 
// jsFooter
&lt;/script&gt;
&lt;!-- jsChart --&gt;
&lt;script type=&#34;text/javascript&#34; src=&#34;https://www.google.com/jsapi?callback=displayChartMapID28dd90d0222&#34;&gt;&lt;/script&gt;
&lt;!-- divChart --&gt;
&lt;div id=&#34;MapID28dd90d0222&#34; style=&#34;width: 500; height: automatic;&#34;&gt;

&lt;/div&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;options(op) # Reset gvis options to default&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Note that you may get a “For development purposes only” or similar watermark. This is because &lt;a href=&#34;https://cloud.google.com/maps-platform/pricing/&#34;&gt;&lt;strong&gt;Google Maps is no longer free&lt;/strong&gt;&lt;/a&gt; - although it seems like their strategy is in flux. At one stage you needed to register with a credit card and get an API key. Google then allows $200 free usage per month (which is a lot!) before they start charging. This kind of visualization can also be done with &lt;a href=&#34;https://rstudio.github.io/leaflet/&#34;&gt;&lt;strong&gt;Leaflet for R&lt;/strong&gt;&lt;/a&gt; - for a demo from my work have a look at &lt;a href=&#34;http://www.ecologi.st/post/gsn/&#34;&gt;&lt;strong&gt;this post&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;but-what-about-our-poor-cedars&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;But what about our poor cedars?&lt;/h3&gt;
&lt;p&gt;I haven’t even shown you how to extract the topographic data from a raster!&lt;/p&gt;
&lt;p&gt;This is easily done with extract()&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;topo$fire &amp;lt;- firecount #add the layer of numbers of fires
pts_topo &amp;lt;- extract(topo, pts) #extract data to a dataframe
head(pts_topo) #have a look&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##           dem      slope   eastwest northsouth        tpi      tri
## [1,] 1041.944 0.51212442 -0.8172747 -0.5762482  -3.501576 35.57229
## [2,] 1256.394 0.62649156 -0.5460981 -0.8377212   2.350074 49.98390
## [3,] 1236.647 0.47959052  0.9325970  0.3609194 -18.461028 32.47396
## [4,] 1007.179 0.08345699  0.8329197  0.5533938 -12.690890 13.10339
## [5,] 1229.906 0.39745604  0.2018364 -0.9794193  -3.619142 31.03015
## [6,] 1420.102 0.50485605  0.9854354  0.1700503   1.978270 34.00052
##      roughness flowdir fire
## [1,]  133.6057       8    2
## [2,]  158.4853       8    4
## [3,]  123.0002       1    5
## [4,]   25.2136       1    2
## [5,]   85.2815       4    5
## [6,]  105.1424       1    5&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;But there are multiple trees per 90m pixel, so some sites (pixels) are repeated. Perhaps this is better dealt with by including the tree density count raster.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;topo$dens &amp;lt;- dens #add the tree density raster to the stack
dat = as.data.frame(topo) #check out ?rasterToPoints too

plot(dens ~ fire, data=dat)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-50-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(dens ~ tri, data=dat)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-50-2.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(dens ~ dem, data=dat)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-50-3.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(dens ~ northsouth, data=dat)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-50-4.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Current theories around the cedar’s decline include increased fire frequency and climate change. Here are a couple of basic hypotheses we could test:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Under increased fire frequency we would expect fewer cedars in areas where greater numbers of fires occur, but higher survival in areas with greater topographic roughness as this may provide refuge from fire (note that just the perimeters are mapped for most fires).&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Under climate change we may expect cedars to be more numerous at higher altitudes, at more southern latitudes (although we don’t cover much latitudinal range here), and on South-facing slopes.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;We can model the species’ distribution based on these variables using functions in the package &lt;em&gt;dismo&lt;/em&gt;. Here I just do a quick BioClim model, but you can run many other models too. Even MaxEnt is available if you install it separately and tell R where it is on your machine.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;bc &amp;lt;- bioclim(topo[[-10]], pts) # The [[-10]] tells R not to use the 10th raster (dens) in the model fitting as this would be circular...

p &amp;lt;- predict(topo, bc) # Predict potential distribution back onto base data
plot(p)
points(pts, pch=20, cex=.1)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/spatial-data-in-r-2-a-practical-example_files/figure-html/unnamed-chunk-51-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;NOTE THAT I DO NOT EVALUATE THE MODEL IN ANY WAY - so I will not interpret it either. This is just a quick and dirty, breaking all the rules. Read up on species distribution modelling if you plan to use these techniques - the vignette on Species Distribution Modelling with R in &lt;a href=&#34;https://cran.r-project.org/web/packages/dismo/index.html&#34;&gt;&lt;strong&gt;library(dismo)&lt;/strong&gt;&lt;/a&gt; is a good place to start. Type vignette(“sdm”) to call up the pdf.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;options-for-writing-out-spatial-data&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Options for writing out spatial data&lt;/h3&gt;
&lt;p&gt;Here are a few useful functions, but also look for the &lt;em&gt;“filename = …”&lt;/em&gt; or &lt;em&gt;“outputfile = …”&lt;/em&gt; or similar options in the functions you use as these are often the most efficient.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;?writeOGR # For shapefiles - can save in many many formats
?writeRaster # For rasters - also has many formats
?save # To write out a subset of objects from the project
?save.image # To write out the whole project with all objects (like a .mxd in ArcGIS really)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;THANKS!!!&lt;/p&gt;
&lt;p&gt;If you try this code and have issues the session info is below. Also note that all kinds of weird settings to Flash etc are required to do the gvisMap plot and it only works if embedded in an HTML webpage or similar. Feel free to leave a comment below - especially if you spot errors etc!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sessionInfo()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## R version 3.5.1 (2018-07-02)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.2
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.5/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
##  [1] googleVis_0.6.2     dismo_1.1-4         animation_2.5      
##  [4] doMC_1.3.5          iterators_1.0.10    foreach_1.4.4      
##  [7] rgdal_1.3-4         rasterVis_0.45      latticeExtra_0.6-28
## [10] RColorBrewer_1.1-2  lattice_0.20-35     raster_2.6-7       
## [13] sp_1.3-1           
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.18      knitr_1.20        magrittr_1.5     
##  [4] viridisLite_0.3.0 stringr_1.3.1     tools_3.5.1      
##  [7] grid_3.5.1        xfun_0.3          rgeos_0.3-28     
## [10] htmltools_0.3.6   yaml_2.2.0        rprojroot_1.3-2  
## [13] digest_0.6.15     bookdown_0.7      codetools_0.2-15 
## [16] evaluate_0.11     rmarkdown_1.10    blogdown_0.8     
## [19] stringi_1.2.4     compiler_3.5.1    backports_1.1.2  
## [22] jsonlite_1.5      hexbin_1.27.2     zoo_1.8-3&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;## processing file: /Users/jasper/GIT/jslingsby.github.io_local/content/post/spatial-data-in-r-2-a-practical-example.Rmd&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## output file: /Users/jasper/Dropbox/SAEON/Training/SpatialDataPrimer/Example/Data/PrimerSpatialData.R&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Handling Spatial Data in R - #1. Getting started</title>
      <link>/post/2017-04-01-PrimerSpatialData/</link>
      <pubDate>Tue, 28 Aug 2018 00:00:00 +0000</pubDate>
      
      <guid>/post/2017-04-01-PrimerSpatialData/</guid>
      <description>&lt;div id=&#34;TOC&#34;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#installing-r-and-rstudio&#34;&gt;Installing R (and RStudio)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#cran-spatial-task-views&#34;&gt;CRAN Spatial Task Views!!!&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#useful-diy-resources&#34;&gt;Useful DIY resources&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;

&lt;hr /&gt;
&lt;p&gt;Points, lines, polygons and rasters - R can handle them all. My aim for this post is to give you the basics required to teach yourself spatial data analysis in R - following 3 major sections listed above.&lt;/p&gt;
&lt;p&gt;In the &lt;a href=&#34;http://www.ecologi.st/post/spatial-data-in-r-2-a-practical-example/&#34;&gt;&lt;strong&gt;next post&lt;/strong&gt;&lt;/a&gt; I provide a practical example working with point, line, polygon and raster data. If you’re already familiar with R then you can skip straight there, but you may be interested to check out the &lt;a href=&#34;http://www.ecologi.st/post/2017-04-01-PrimerSpatialData/#useful-diy-resources&#34;&gt;&lt;strong&gt;useful DIY resources&lt;/strong&gt;&lt;/a&gt; before you go.&lt;/p&gt;
&lt;p&gt;If you’ve been using my old “Primer for Handling Spatial Data in R” post note that this is just an update, but I’ve decided to split it into a series of independent posts to make it less unwieldy and allow me to expand it in future - my apologies if you prefered the old scheme…&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div id=&#34;installing-r-and-rstudio&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Installing R (and RStudio)&lt;/h2&gt;
&lt;p&gt;You can download R for Windows, Mac or Linux from &lt;a href=&#34;https://cran.r-project.org/&#34;&gt;&lt;strong&gt;The Comprehensive R Archive Network (CRAN)&lt;/strong&gt;&lt;/a&gt; and install.&lt;/p&gt;
&lt;p&gt;Base R can be quite clunky to deal with, so there is a range of additional software packages designed to help you manage your R code, plots, projects etc. One of the better ones (i.e. the one that I use and I’m clearly not bias) is &lt;a href=&#34;https://www.rstudio.com/products/RStudio/&#34;&gt;&lt;strong&gt;RStudio&lt;/strong&gt;&lt;/a&gt;. You want to download the Open Source version of RStudio Desktop. When you open RStudio after installing you’ll see that it has opened R in the “Console” window.&lt;/p&gt;
&lt;p&gt;Note that the base version of R is as small as possible, trimmed down to only the essential functions etc. More advanced and user specific functions are available as “Contributed Extension Packages” or “libraries”. You can access the list of packages from &lt;a href=&#34;https://cran.r-project.org/&#34; class=&#34;uri&#34;&gt;https://cran.r-project.org/&lt;/a&gt;. At the time of writing there were almost 13 000 packages and growing!!! This can be quite bewildering if you’re not sure what you need, but fortunately there are…&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;cran-spatial-task-views&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;CRAN Spatial Task Views!!!&lt;/h2&gt;
&lt;p&gt;Some great fellas have taken the time to sift through all the R libraries and make some sense of them for different focal topics and created &lt;a href=&#34;https://cran.r-project.org/web/views/&#34;&gt;&lt;strong&gt;“Task Views”&lt;/strong&gt;&lt;/a&gt;. Fortunately for us there’s a &lt;a href=&#34;https://cran.r-project.org/web/views/Spatial.html&#34;&gt;&lt;strong&gt;Spatial Task View&lt;/strong&gt;&lt;/a&gt; maintained by Roger Bivand. There’s also a &lt;a href=&#34;https://cran.r-project.org/web/views/SpatioTemporal.html&#34;&gt;&lt;strong&gt;SpatioTemporal Task View&lt;/strong&gt;&lt;/a&gt; maintained by Edzer Pebesma, which overlaps somewhat, but specifically focuses on data where both location and time of observation are registered, and relevant for the analysis of the data.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Each Task View has a landing page with an overview highlighting what you can do with the different packages and their respective strengths, weaknesses etc., e.g.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/CRAN_spatial.jpg&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div id=&#34;topics-covered-by-the-spatial-task-view-which-focuses-on-analysis-of-spatial-data&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Topics covered by the &lt;em&gt;Spatial&lt;/em&gt; Task View, which focuses on “Analysis of Spatial Data”:&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Classes for spatial data&lt;/li&gt;
&lt;li&gt;Handling spatial data&lt;/li&gt;
&lt;li&gt;Reading and writing spatial data&lt;/li&gt;
&lt;li&gt;Reading and writing spatial data - other packages&lt;/li&gt;
&lt;li&gt;Visualisation&lt;/li&gt;
&lt;li&gt;Point pattern analysis&lt;/li&gt;
&lt;li&gt;Geostatistics&lt;/li&gt;
&lt;li&gt;Disease mapping and areal data analysis&lt;/li&gt;
&lt;li&gt;Spatial regression&lt;/li&gt;
&lt;li&gt;Ecological analysis&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Task Views also allow easy download and installation of all packages in a Task View using library(ctv) - see highlighted code below. But beware! It can take a while to download and install if it is a big Task View and the the Spatial one is BIG!!! You don’t need the whole Task View for my tutorials, so don’t bother downloading it if you’re just working through these.&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/CRAN_taskviews.jpg&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id=&#34;useful-diy-resources&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Useful DIY resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;The Analysis of Spatial Data Task View!&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://robinlovelace.net/&#34; class=&#34;uri&#34;&gt;http://robinlovelace.net/&lt;/a&gt; especially his new online book &lt;a href=&#34;https://geocompr.robinlovelace.net/&#34;&gt;&lt;strong&gt;Geocomputation with R&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.nceas.ucsb.edu/scicomp/solutions&#34; class=&#34;uri&#34;&gt;https://www.nceas.ucsb.edu/scicomp/solutions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://statnmap.com/&#34; class=&#34;uri&#34;&gt;https://statnmap.com/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://pakillo.github.io/R-GIS-tutorial/&#34; class=&#34;uri&#34;&gt;http://pakillo.github.io/R-GIS-tutorial/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://spatial.ly/&#34; class=&#34;uri&#34;&gt;http://spatial.ly/&lt;/a&gt; - For some visual R inspiration!&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.googleityoumoron.com&#34; class=&#34;uri&#34;&gt;http://www.googleityoumoron.com&lt;/a&gt; - There are plenty of resources!!!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;I’d also highly recommend &lt;em&gt;Applied Spatial Data Analysis with R&lt;/em&gt; by Roger Bivand et al. (2013) - While the R packages available change every day, this is still a great intro to handling spatial data and a great resource for getting deeper into the statistics!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/Bivand.jpg&#34; /&gt;

&lt;/div&gt;
&lt;hr /&gt;
&lt;p&gt;Move on to the &lt;a href=&#34;http://www.ecologi.st/post/spatial-data-in-r-2-a-practical-example/&#34;&gt;&lt;strong&gt;next post&lt;/strong&gt;&lt;/a&gt;, which provides a practical example working with point, line, polygon and raster data?&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Testing a citizen science App with the SAEON Graduate Student Network</title>
      <link>/post/gsn/</link>
      <pubDate>Thu, 14 Sep 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/gsn/</guid>
      <description>&lt;script src=&#34;/rmarkdown-libs/htmlwidgets/htmlwidgets.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/rmarkdown-libs/jquery/jquery.min.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/leaflet/leaflet.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;/rmarkdown-libs/leaflet/leaflet.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/leafletfix/leafletfix.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;/rmarkdown-libs/Proj4Leaflet/proj4-compressed.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/rmarkdown-libs/Proj4Leaflet/proj4leaflet.js&#34;&gt;&lt;/script&gt;
&lt;link href=&#34;/rmarkdown-libs/rstudio_leaflet/rstudio_leaflet.css&#34; rel=&#34;stylesheet&#34; /&gt;
&lt;script src=&#34;/rmarkdown-libs/leaflet-binding/leaflet.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/rmarkdown-libs/leaflet-providers/leaflet-providers.js&#34;&gt;&lt;/script&gt;
&lt;script src=&#34;/rmarkdown-libs/leaflet-providers-plugin/leaflet-providers-plugin.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;This is based on data collected when I took students from &lt;a href=&#34;http://gsn.dirisa.org/&#34;&gt;&lt;em&gt;SAEON’s Graduate Student Network&lt;/em&gt;&lt;/a&gt; into the field to introduce them to Fynbos and to show them a bit of the science I’m working on. To make things more interesting, I got them to help me test a smartphone app I’ve been developing (“VeldWatch”) that can be used to map any impacts on natural ecosystems observed in the field, like invasive species, plant mortality, etc.&lt;/p&gt;
&lt;p&gt;The aim behind developing VeldWatch is to provide a platform whereby citizen scientists can contribute these observations, but also help groundtruth &lt;a href=&#34;http://www.ecologi.st/post/emma/&#34;&gt;&lt;strong&gt;a model I’ve been working on&lt;/strong&gt;&lt;/a&gt; (with others!) that identifies anomalous changes in vegetation greenness using satellite data.&lt;/p&gt;
&lt;p&gt;If that’s not setting the bar high enough, I thought I’d use this blog post to both show them the results of our field trip (and the implications for the spatial accuracy of the App…) and provide a little tutorial on mapping in R. Here goes…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;We’ll start by calling the R libraries we need. If you don’t have the necessary packages installed use the function install.packages() as below.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#install.packages(&amp;quot;googlesheets&amp;quot;) #Don&amp;#39;t forget the the &amp;quot;&amp;quot;!
library(googlesheets)
suppressMessages(library(dplyr))
suppressMessages(library(tidyr))
suppressMessages(library(raster))
suppressMessages(library(rgdal))
suppressMessages(library(RColorBrewer))
suppressMessages(library(leaflet))
suppressPackageStartupMessages(library(ggmap))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;The VeldWatch App uploads the observation data directly into a Google Sheet in my GDrive (and the labeled photos into a folder), so it’s easiest if we can call the data directly from the online sheet rather than manually sharing and downloading the sheet every time. To do this, I use library(googlesheets) developed by Jenny Bryan and Joanna Zhao. Check out their &lt;a href=&#34;https://rawgit.com/jennybc/googlesheets/master/vignettes/basic-usage.html&#34;&gt;&lt;strong&gt;tutorial&lt;/strong&gt;&lt;/a&gt; for more of the basics.&lt;/p&gt;
&lt;p&gt;I’ve shared the sheet publically so you should just be able to access it, but you may get asked to authenticate R accessing your Google Sheets the first time you use this code. If googlesheets doesn’t work for you, you can access the spreadsheet &lt;a href=&#34;https://docs.google.com/spreadsheets/d/1dDOo-nizXC1XDECPkXts2VloDaObTuNwxPBhYJFNLdo/edit?usp=sharing&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt;, download as .xlsx or .csv and read into R as you normally would.&lt;/p&gt;
&lt;p&gt;Here we extract the google sheet key from the shared URL link, “register the key” (needed for accessing the spreadsheet), download the data and take a quick look at it.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;key &amp;lt;- extract_key_from_url(&amp;quot;https://docs.google.com/spreadsheets/d/1dDOo-nizXC1XDECPkXts2VloDaObTuNwxPBhYJFNLdo/edit?usp=sharing&amp;quot;) #extract the google sheet key from a shared URL

dat &amp;lt;- key %&amp;gt;% gs_key(verbose = FALSE) %&amp;gt;% gs_read(ws=1, verbose = FALSE) #register the key and download the data in the first worksheet

dat&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## # A tibble: 36 x 21
##    TimeStamp `Radius assesse… `Land cover` Impact `Alien grass de…
##    &amp;lt;time&amp;gt;    &amp;lt;chr&amp;gt;            &amp;lt;chr&amp;gt;        &amp;lt;chr&amp;gt;  &amp;lt;chr&amp;gt;           
##  1 10:05     15m              Natural      No ob… &amp;lt;NA&amp;gt;            
##  2 10:39     15m              Natural      Alien… &amp;lt;NA&amp;gt;            
##  3 10:41     15m              Natural      Recen… &amp;lt;NA&amp;gt;            
##  4 10:44     15m              Natural      Alien… &amp;lt;NA&amp;gt;            
##  5 09:03     100m             Near natural Dead … &amp;lt;NA&amp;gt;            
##  6 10:41     15m              Natural      Dead … &amp;lt;NA&amp;gt;            
##  7 08:33     100m             Near natural Veget… &amp;lt;NA&amp;gt;            
##  8 08:34     100m             Near natural Veget… &amp;lt;NA&amp;gt;            
##  9 08:42     5m               Near natural Alien… Individuals com…
## 10 08:49     100m             Near natural Veget… &amp;lt;NA&amp;gt;            
## # ... with 26 more rows, and 16 more variables: `No of alien plants in
## #   search radius` &amp;lt;chr&amp;gt;, `Clearing intensity` &amp;lt;lgl&amp;gt;, `No of dead plants
## #   in search radius` &amp;lt;chr&amp;gt;, `Size of land/rock slide` &amp;lt;lgl&amp;gt;, `Vegetation
## #   removal` &amp;lt;chr&amp;gt;, `Suggested species or common name` &amp;lt;chr&amp;gt;,
## #   Comment &amp;lt;chr&amp;gt;, `Phone location` &amp;lt;chr&amp;gt;, `Photo A` &amp;lt;chr&amp;gt;, `Photo
## #   B` &amp;lt;chr&amp;gt;, `Photo C` &amp;lt;chr&amp;gt;, `Photo D` &amp;lt;chr&amp;gt;, Geolocation &amp;lt;chr&amp;gt;,
## #   Date &amp;lt;chr&amp;gt;, Time &amp;lt;time&amp;gt;, Test &amp;lt;lgl&amp;gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now we want to extract the latitude and longitude stored in the “Geolocation” column into separate columns. This requires splitting the value in each row of “Geolocation” by the fixed divider “,” and assigning the first value from each split to latitude and the second to longitude. We’ll use the function &lt;a href=&#34;http://tidyr.tidyverse.org/reference/separate.html&#34;&gt;&lt;em&gt;separate()&lt;/em&gt; from &lt;strong&gt;library(tidyr)&lt;/strong&gt;&lt;/a&gt; to do this.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat &amp;lt;- dat %&amp;gt;% separate(Geolocation, sep = &amp;quot;, &amp;quot;, c(&amp;quot;Lat&amp;quot;, &amp;quot;Lon&amp;quot;), remove = FALSE, convert = TRUE)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;This has added new columns “Lat” and “Lon”. Setting “remove = FALSE” keeps the column “Geolocation”, while “convert = TRUE” coerces the new columns to class “numeric” from “character” if possible.&lt;/p&gt;
&lt;p&gt;We can then make the data frame a &lt;em&gt;spatial&lt;/em&gt; object of class “SpatialPointsDataFrame” using the function coordinates(). This is essentially like converting the table to a shapefile with point locations and an attribute table.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;class(dat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;tbl_df&amp;quot;     &amp;quot;tbl&amp;quot;        &amp;quot;data.frame&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sdat &amp;lt;- dat #Make a new data frame &amp;quot;sdat&amp;quot; that we&amp;#39;ll convert to a spatial object

coordinates(sdat) &amp;lt;- ~Lon+Lat

class(sdat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;SpatialPointsDataFrame&amp;quot;
## attr(,&amp;quot;package&amp;quot;)
## [1] &amp;quot;sp&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Note that if we are working with spatial data we need to assign a coordinate reference system (CRS). In this case the coordinates are geographic (unprojected) with the geodetic datum WGS84. We can tell R this by assigning a “proj4string”. I’m not going to go into the details of CRSs, but they differ in terms of whether they represent locations, distances or areas correctly, and can differ depending on where you are on the planet. You need to choose the correct CRS for the analysis you are doing. You can read more about them &lt;a href=&#34;http://desktop.arcgis.com/en/arcmap/10.3/guide-books/map-projections/what-are-map-projections.htm&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt;. In all cases, you want to make sure that all your spatial objects have the same CRS!!!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;proj4string(sdat) &amp;lt;- &amp;quot;+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Note that this merely assigns a CRS, it does not transform the data from one CRS to another. If you don’t know the original CRS your data are in they are useless for spatial analyses until you find out…&lt;/p&gt;
&lt;p&gt;Ok, let’s see where our points land…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;b &amp;lt;- bbox(extent(sdat)+.25)

smap &amp;lt;- ggmap(get_map(location = b, source = &amp;quot;stamen&amp;quot;, maptype = &amp;quot;watercolor&amp;quot;, 
    crop = T, zoom = 11))

smap + geom_point(data = dat, aes(x = Lon, y = Lat, col = &amp;quot;red2&amp;quot;), alpha = 1)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-09-13-gsn_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Looks like we have points all over the place, but this is not unexpected - ideally people will be using the app to collect data from across the country!&lt;/p&gt;
&lt;p&gt;We can trim the records to our area of interest by setting our desired extent and cropping the data.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;fdat &amp;lt;- crop(sdat, y = extent(18.38, 18.51, -34.15, -34.06)) #crop points to extent

fb &amp;lt;- bbox(extent(fdat)+.125)
fmap &amp;lt;- ggmap(get_map(location = fb, source = &amp;quot;stamen&amp;quot;, maptype = &amp;quot;watercolor&amp;quot;, 
    crop = T, zoom = 11))
fmap + geom_point(data = dat, aes(x = Lon, y = Lat, col = &amp;quot;red2&amp;quot;), alpha = 1)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-09-13-gsn_files/figure-html/unnamed-chunk-8-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Much better!&lt;/p&gt;
&lt;p&gt;BUT! Some of the points we logged with the app are FAR from where we were hiking?&lt;/p&gt;
&lt;p&gt;Let’s add a GPS track I took to see where we actually were. You can download the track &lt;a href=&#34;https://www.dropbox.com/s/w2xplo4zkbi1kot/Track_14-SEP-17%20164823.gpx?dl=0&#34;&gt;&lt;strong&gt;here&lt;/strong&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;track &amp;lt;- readOGR(dsn=&amp;quot;/Users/jasper/Dropbox/SAEON/GSN/2017/Track_14-SEP-17 164823.gpx&amp;quot;, layer=&amp;quot;tracks&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## OGR data source with driver: GPX 
## Source: &amp;quot;/Users/jasper/Dropbox/SAEON/GSN/2017/Track_14-SEP-17 164823.gpx&amp;quot;, layer: &amp;quot;tracks&amp;quot;
## with 1 features
## It has 13 fields&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s add the track to our plot, but to do this with the plotting functions we’ve been using we need to use the function &lt;em&gt;fortify()&lt;/em&gt; to arrange the track properly.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;track_f &amp;lt;- fortify(track)

head(track_f)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##       long       lat order piece id group
## 1 18.42222 -34.09084     1     1  0   0.1
## 2 18.42232 -34.09088     2     1  0   0.1
## 3 18.42241 -34.09093     3     1  0   0.1
## 4 18.42250 -34.09099     4     1  0   0.1
## 5 18.42259 -34.09106     5     1  0   0.1
## 6 18.42267 -34.09111     6     1  0   0.1&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now we can just add it to our existing plot with &lt;em&gt;geom_path()&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;fmap + geom_point(data = dat, aes(x = Lon, y = Lat, col = &amp;quot;red2&amp;quot;), alpha = 1) + 
  geom_path(data = track_f, aes(x=long, y=lat, group=group, col = &amp;quot;royalblue&amp;quot;))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-09-13-gsn_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Oh dear…&lt;/p&gt;
&lt;p&gt;Another “oh dear” is that it’s my 6-month old’s bath time, so I’ll have to stop here and come back to this. My plan is to identify the “errant” points by calculating the distance to the GPS track, and then see if it’s the same phone.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;But first, let’s look at some of the data interactively!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;fdat@data &amp;lt;- fdat@data %&amp;gt;% separate(Geolocation, sep = &amp;quot;, &amp;quot;, c(&amp;quot;Lat&amp;quot;, &amp;quot;Lon&amp;quot;), remove = FALSE, convert = TRUE)
leaflet(fdat) %&amp;gt;% addProviderTiles(providers$Esri.WorldImagery) %&amp;gt;% addMarkers(~Lon, ~Lat)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-1&#34; style=&#34;width:672px;height:480px;&#34; class=&#34;leaflet html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-1&#34;&gt;{&#34;x&#34;:{&#34;options&#34;:{&#34;crs&#34;:{&#34;crsClass&#34;:&#34;L.CRS.EPSG3857&#34;,&#34;code&#34;:null,&#34;proj4def&#34;:null,&#34;projectedBounds&#34;:null,&#34;options&#34;:{}}},&#34;calls&#34;:[{&#34;method&#34;:&#34;addProviderTiles&#34;,&#34;args&#34;:[&#34;Esri.WorldImagery&#34;,null,null,{&#34;errorTileUrl&#34;:&#34;&#34;,&#34;noWrap&#34;:false,&#34;detectRetina&#34;:false}]},{&#34;method&#34;:&#34;addMarkers&#34;,&#34;args&#34;:[[-34.107525,-34.104865,-34.091183,-34.091335,-34.092598,-34.093139,-34.093235,-34.09334,-34.13148,-34.122318,-34.098236,-34.099404,-34.099134,-34.100586,-34.101758,-34.105327,-34.103921,-34.091323,-34.093187,-34.093479,-34.093469,-34.100652,-34.091167,-34.101747,-34.093149,-34.101943,-34.105596,-34.10403,-34.10067,-34.100351,-34.097461],[18.464325,18.453626,18.422787,18.422804,18.423293,18.423523,18.42336,18.423487,18.388847,18.382913,18.416309,18.430032,18.42829,18.430966,18.385509,18.435118,18.444904,18.422835,18.423419,18.434371,18.434318,18.447805,18.422852,18.385832,18.423384,18.433125,18.435332,18.444854,18.447974,18.447814,18.441546],null,null,null,{&#34;interactive&#34;:true,&#34;draggable&#34;:false,&#34;keyboard&#34;:true,&#34;title&#34;:&#34;&#34;,&#34;alt&#34;:&#34;&#34;,&#34;zIndexOffset&#34;:0,&#34;opacity&#34;:1,&#34;riseOnHover&#34;:false,&#34;riseOffset&#34;:250},null,null,null,null,null,{&#34;interactive&#34;:false,&#34;permanent&#34;:false,&#34;direction&#34;:&#34;auto&#34;,&#34;opacity&#34;:1,&#34;offset&#34;:[0,0],&#34;textsize&#34;:&#34;10px&#34;,&#34;textOnly&#34;:false,&#34;className&#34;:&#34;&#34;,&#34;sticky&#34;:true},null]}],&#34;limits&#34;:{&#34;lat&#34;:[-34.13148,-34.091167],&#34;lng&#34;:[18.382913,18.464325]}},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;I need to add a bunch more context etc here, but for my and the students’ sake we’d like to visualize the model outputs. First lets look at the sites that are less green than the model expects.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;excbelow &amp;lt;- raster(&amp;quot;/Users/jasper/Dropbox/Shared/Data4ClimateAction/PeninsulaData/exceedbelow&amp;quot;)

pal &amp;lt;- colorNumeric(brewer.pal(9, &amp;quot;Reds&amp;quot;), values(excbelow), na.color = &amp;quot;transparent&amp;quot;)

leaflet()  %&amp;gt;% addProviderTiles(providers$Esri.WorldImagery) %&amp;gt;%
  addRasterImage(excbelow, colors = pal, opacity = 0.5) %&amp;gt;%
  addLegend(pal = pal, values = values(excbelow),
    title = &amp;quot;Exceedance Below&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-2&#34; style=&#34;width:672px;height:480px;&#34; class=&#34;leaflet html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-2&#34;&gt;{&#34;x&#34;:{&#34;options&#34;:{&#34;crs&#34;:{&#34;crsClass&#34;:&#34;L.CRS.EPSG3857&#34;,&#34;code&#34;:null,&#34;proj4def&#34;:null,&#34;projectedBounds&#34;:null,&#34;options&#34;:{}}},&#34;calls&#34;:[{&#34;method&#34;:&#34;addProviderTiles&#34;,&#34;args&#34;:[&#34;Esri.WorldImagery&#34;,null,null,{&#34;errorTileUrl&#34;:&#34;&#34;,&#34;noWrap&#34;:false,&#34;detectRetina&#34;:false}]},{&#34;method&#34;:&#34;addRasterImage&#34;,&#34;args&#34;:[&#34;data:image/png;base64,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&#34;,[[-33.9091715035979,18.3036518181693],[-34.358714011233,18.4931147722588]],0.5,null,null,null]},{&#34;method&#34;:&#34;addLegend&#34;,&#34;args&#34;:[{&#34;colors&#34;:[&#34;#FFF5F0 , #FFF5F0 0%, #FECCB7 19.2307692307692%, #FC8F6F 38.4615384615385%, #F44F37 57.6923076923077%, #C5171C 76.9230769230769%, #790310 96.1538461538462%, #67000D &#34;],&#34;labels&#34;:[&#34;0&#34;,&#34;5&#34;,&#34;10&#34;,&#34;15&#34;,&#34;20&#34;,&#34;25&#34;],&#34;na_color&#34;:null,&#34;na_label&#34;:&#34;NA&#34;,&#34;opacity&#34;:0.5,&#34;position&#34;:&#34;topright&#34;,&#34;type&#34;:&#34;numeric&#34;,&#34;title&#34;:&#34;Exceedance Below&#34;,&#34;extra&#34;:{&#34;p_1&#34;:0,&#34;p_n&#34;:0.961538461538462},&#34;layerId&#34;:null,&#34;className&#34;:&#34;info legend&#34;,&#34;group&#34;:null}]}],&#34;limits&#34;:{&#34;lat&#34;:[-34.358714011233,-33.9091715035979],&#34;lng&#34;:[18.3036518181693,18.4931147722588]}},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now the sites that are more green than expected…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;excabove &amp;lt;- raster(&amp;quot;/Users/jasper/Dropbox/Shared/Data4ClimateAction/PeninsulaData/exceedabove&amp;quot;)

pal &amp;lt;- colorNumeric(brewer.pal(9, &amp;quot;Blues&amp;quot;), values(excabove), na.color = &amp;quot;transparent&amp;quot;)

leaflet()  %&amp;gt;% addProviderTiles(providers$Esri.WorldImagery) %&amp;gt;%
  addRasterImage(excabove, colors = pal, opacity = 0.5) %&amp;gt;%
  addLegend(pal = pal, values = values(excabove),
    title = &amp;quot;Exceedance Above&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;div id=&#34;htmlwidget-3&#34; style=&#34;width:672px;height:480px;&#34; class=&#34;leaflet html-widget&#34;&gt;&lt;/div&gt;
&lt;script type=&#34;application/json&#34; data-for=&#34;htmlwidget-3&#34;&gt;{&#34;x&#34;:{&#34;options&#34;:{&#34;crs&#34;:{&#34;crsClass&#34;:&#34;L.CRS.EPSG3857&#34;,&#34;code&#34;:null,&#34;proj4def&#34;:null,&#34;projectedBounds&#34;:null,&#34;options&#34;:{}}},&#34;calls&#34;:[{&#34;method&#34;:&#34;addProviderTiles&#34;,&#34;args&#34;:[&#34;Esri.WorldImagery&#34;,null,null,{&#34;errorTileUrl&#34;:&#34;&#34;,&#34;noWrap&#34;:false,&#34;detectRetina&#34;:false}]},{&#34;method&#34;:&#34;addRasterImage&#34;,&#34;args&#34;:[&#34;data:image/png;base64,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&#34;,[[-33.9091715035979,18.3036518181693],[-34.358714011233,18.4931147722588]],0.5,null,null,null]},{&#34;method&#34;:&#34;addLegend&#34;,&#34;args&#34;:[{&#34;colors&#34;:[&#34;#F7FBFF , #F7FBFF 0%, #D1E2F3 19.2307692307692%, #9AC8E0 38.4615384615385%, #539DCC 57.6923076923077%, #1E6CB1 76.9230769230769%, #093A7A 96.1538461538462%, #08306B &#34;],&#34;labels&#34;:[&#34;0&#34;,&#34;5&#34;,&#34;10&#34;,&#34;15&#34;,&#34;20&#34;,&#34;25&#34;],&#34;na_color&#34;:null,&#34;na_label&#34;:&#34;NA&#34;,&#34;opacity&#34;:0.5,&#34;position&#34;:&#34;topright&#34;,&#34;type&#34;:&#34;numeric&#34;,&#34;title&#34;:&#34;Exceedance Above&#34;,&#34;extra&#34;:{&#34;p_1&#34;:0,&#34;p_n&#34;:0.961538461538462},&#34;layerId&#34;:null,&#34;className&#34;:&#34;info legend&#34;,&#34;group&#34;:null}]}],&#34;limits&#34;:{&#34;lat&#34;:[-34.358714011233,-33.9091715035979],&#34;lng&#34;:[18.3036518181693,18.4931147722588]}},&#34;evals&#34;:[],&#34;jsHooks&#34;:[]}&lt;/script&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;You’ll note that some sites are both above and below! These sites are just inherantly noisy. I still need to figure out why! One more item on the never-ending ToDo list!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>MODIS and Landsat primer for Hannah</title>
      <link>/post/modis-primer-for-hannah/</link>
      <pubDate>Tue, 04 Apr 2017 00:00:00 +0000</pubDate>
      
      <guid>/post/modis-primer-for-hannah/</guid>
      <description>&lt;p&gt;This is a quick primer on how to handle MODIS and Landsat NDVI data from &lt;a href=&#34;https://earthengine.google.com/&#34;&gt;&lt;strong&gt;Google Earth Engine (GEE)&lt;/strong&gt;&lt;/a&gt; in R. It’s primarily for my Honours student, Hannah Simon, but I thought why not make it public for all to share? I first posted the MODIS section and had Hannah play with the Landsat data as a learning exercise, so full credit to her for the Landsat code.&lt;/p&gt;
&lt;p&gt;For a general introduction for many of the functions used and handling spatial data in general see &lt;a href=&#34;https://jslingsby.github.io/post/2017-04-01-PrimerSpatialData/&#34;&gt;&lt;strong&gt;A Primer for Handling Spatial Data in R&lt;/strong&gt;&lt;/a&gt; posted previously.&lt;/p&gt;
&lt;p&gt;We start by getting the necessary libraries:&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#Get libraries
library(raster) #to handle rasters&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Loading required package: sp&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(rgdal) #to handle shapefiles&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## rgdal: version: 1.3-4, (SVN revision 766)
##  Geospatial Data Abstraction Library extensions to R successfully loaded
##  Loaded GDAL runtime: GDAL 2.1.3, released 2017/20/01
##  Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/3.5/Resources/library/rgdal/gdal
##  GDAL binary built with GEOS: FALSE 
##  Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
##  Path to PROJ.4 shared files: /Library/Frameworks/R.framework/Versions/3.5/Resources/library/rgdal/proj
##  Linking to sp version: 1.3-1&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(reshape) #for data wrangling
library(ggplot2) #for pretty plotting
library(animation) #for silly animations

datwd &amp;lt;- &amp;quot;/Users/jasper/Documents/GIS/CFR/MODISforHannah/&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s start with…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;div id=&#34;modis&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;MODIS&lt;/h2&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#Get data
mNDVI &amp;lt;- stack(paste0(datwd, &amp;quot;2017043_MODIS_v1g_JNP_MOD_NDVI.tif&amp;quot;)) #Note that the file has multiple bands so stack() is the easiest way to read all bands

mNDVI #See what the data look like&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterStack 
## dimensions  : 15, 20, 300, 393  (nrow, ncol, ncell, nlayers)
## resolution  : 250, 250  (x, y)
## extent      : 361250, 366250, 6242250, 6246000  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=34 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names       : X2017043_//MOD_NDVI.1, X2017043_//MOD_NDVI.2, X2017043_//MOD_NDVI.3, X2017043_//MOD_NDVI.4, X2017043_//MOD_NDVI.5, X2017043_//MOD_NDVI.6, X2017043_//MOD_NDVI.7, X2017043_//MOD_NDVI.8, X2017043_//MOD_NDVI.9, X2017043_//OD_NDVI.10, X2017043_//OD_NDVI.11, X2017043_//OD_NDVI.12, X2017043_//OD_NDVI.13, X2017043_//OD_NDVI.14, X2017043_//OD_NDVI.15, ... 
## min values  :                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768, ... 
## max values  :                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767, ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So we’ve pulled in the full record of NDVI from the “MODIS/MOD13Q1 16-day composite vegetation indices” product from the dawn of time (i.e. the 18th February 2000) until as recent as possible (6th March 2017), but you’ll notice the names in the raster, e.g. X2017043_MODIS_v1g_JNP_MOD_NDVI.1 aren’t very informative, simply numbering the layers from 1 to 393, but not giving us the dates… For some reason I still haven’t worked out how to embed the dates in the .tif raster exported from GEE, so I save them manually from the console into a text file (stone age, I know, sorry…).&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;metdat &amp;lt;- read.delim(paste0(datwd, &amp;quot;MODIS_metadata.txt&amp;quot;), sep = &amp;quot; &amp;quot;, header = F)

head(metdat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   V1    V2                                   V3 V4    V5
## 1 0: Image MODIS/MOD13Q1/MOD13Q1_005_2000_02_18 (1 band)
## 2 1: Image MODIS/MOD13Q1/MOD13Q1_005_2000_03_05 (1 band)
## 3 2: Image MODIS/MOD13Q1/MOD13Q1_005_2000_03_21 (1 band)
## 4 3: Image MODIS/MOD13Q1/MOD13Q1_005_2000_04_06 (1 band)
## 5 4: Image MODIS/MOD13Q1/MOD13Q1_005_2000_04_22 (1 band)
## 6 5: Image MODIS/MOD13Q1/MOD13Q1_005_2000_05_08 (1 band)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Still not pretty, but getting closer…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;date &amp;lt;- substr(metdat[,3], start = 27, stop = 37)
date[1:5]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;2000_02_18&amp;quot; &amp;quot;2000_03_05&amp;quot; &amp;quot;2000_03_21&amp;quot; &amp;quot;2000_04_06&amp;quot; &amp;quot;2000_04_22&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;With a bit of squint-counting and trial and error we manage to use substr() to extract the dates!&lt;/p&gt;
&lt;p&gt;But for R to treat them as dates we need to tell it they are dates with as.Date(), and specify the date format (see ?strptime).&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;date &amp;lt;- as.Date(date, format = &amp;quot;%Y_%m_%d&amp;quot;)
date[1:5]&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## [1] &amp;quot;2000-02-18&amp;quot; &amp;quot;2000-03-05&amp;quot; &amp;quot;2000-03-21&amp;quot; &amp;quot;2000-04-06&amp;quot; &amp;quot;2000-04-22&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Et voilà!&lt;/p&gt;
&lt;p&gt;So we now have a stack of MODIS NDVI images through time, and we know their dates. We can embed the dates into the raster like so:&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;names(mNDVI) &amp;lt;- date

mNDVI #Have another look at the data&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterStack 
## dimensions  : 15, 20, 300, 393  (nrow, ncol, ncell, nlayers)
## resolution  : 250, 250  (x, y)
## extent      : 361250, 366250, 6242250, 6246000  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=34 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names       : X2000.02.18, X2000.03.05, X2000.03.21, X2000.04.06, X2000.04.22, X2000.05.08, X2000.05.24, X2000.06.09, X2000.06.25, X2000.07.11, X2000.07.27, X2000.08.12, X2000.08.28, X2000.09.13, X2000.09.29, ... 
## min values  :      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768,      -32768, ... 
## max values  :       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767,       32767, ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Great! But now you’ll notice that the min and max values are rather strange (-32767 to 32767) when we know that NDVI can only range from -1 to 1, and rarely goes below 0. Very strange! Let’s have a look at our first image.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(mNDVI[[1]])&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;0 to 4000? Even stranger!&lt;/p&gt;
&lt;p&gt;It turns out the issue is that GEE has exported the data in what appears to be a strange format to reduce the file size. We need to tell R how to interpret it by setting a gain and offset.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;NAvalue(mNDVI)=-32767
offs(mNDVI)=0
gain(mNDVI)=.0001
plot(mNDVI[[1]])&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-8-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Much more reasonable!&lt;/p&gt;
&lt;p&gt;Ok, so now we can begin to look at our questions; namely, how does MODIS NDVI vary in space and time?&lt;/p&gt;
&lt;p&gt;But first, we should set our focal area.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;site &amp;lt;- readOGR(dsn=paste0(datwd, &amp;quot;Jonaskop 120m.kml&amp;quot;), layer=&amp;quot;Jonaskop 120m.kml&amp;quot;) # A Google Earth KML file&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## OGR data source with driver: KML 
## Source: &amp;quot;/Users/jasper/Documents/GIS/CFR/MODISforHannah/Jonaskop 120m.kml&amp;quot;, layer: &amp;quot;Jonaskop 120m.kml&amp;quot;
## with 1 features
## It has 2 fields&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Warning in readOGR(dsn = paste0(datwd, &amp;quot;Jonaskop 120m.kml&amp;quot;), layer =
## &amp;quot;Jonaskop 120m.kml&amp;quot;): Z-dimension discarded&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;site &amp;lt;- spTransform(site, CRS(proj4string(mNDVI))) #Reproject to match the projection of the MODIS data (UTM 34S in this case)

plot(mNDVI[[1]])
plot(site, add=T)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-9-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;It looks like we’re wrangling a lot more MODIS data than we need to. Let’s crop to out focal area…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;mNDVI &amp;lt;- crop(mNDVI, site, snap = &amp;quot;out&amp;quot;) #&amp;quot;snap=&amp;quot;out&amp;quot;&amp;quot; adds a buffer around the site

plot(mNDVI[[1]])
plot(site, add=T)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-10-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;…and look at a few images through time.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(mNDVI) #Note that R limits it to the first 16 images&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-11-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Lots of variation in space! What about time?&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if(!file.exists(&amp;quot;/Users/jasper/GIT/jslingsby.github.io_local/static/img/output/mNDVI.gif&amp;quot;)) { # Check if the file exists
  saveGIF({
    for (i in 1:dim(mNDVI)[3]) plot(mNDVI[[i]],
                      main=names(mNDVI)[i],
                      legend.lab=&amp;quot;NDVI&amp;quot;,
                      col=rev(terrain.colors(length(c(seq(0,.7,.05),1)))),
                      breaks=seq(0,.7,.05))}, 
    movie.name = &amp;quot;/Users/jasper/GIT/jslingsby.github.io_local/static/img/output/mNDVI.gif&amp;quot;, 
    ani.width = 600, ani.height = 500, 
    interval=.25)
}&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/output/mNDVI.gif&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;*NOTE: this writes a .gif to file and does not render in R (or R notebook), so I had to insert it in the Markdown script.&lt;/p&gt;
&lt;p&gt;You could make it a lot prettier, but still pretty fancy. Not very useful for the print edition though. How about just a simple line graph? this requires extracting the data to a data.frame.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat &amp;lt;- as.data.frame(mNDVI)

dat[1:10,1:10] #look at the data&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##    X2000.02.18 X2000.03.05 X2000.03.21 X2000.04.06 X2000.04.22 X2000.05.08
## 1       0.2889      0.3280      0.3723      0.3743      0.3979      0.3902
## 2       0.3127      0.3745      0.3850      0.3872      0.3680      0.4681
## 3       0.3205      0.3508      0.3909      0.3878      0.3647      0.4488
## 4       0.3256      0.3323      0.3823      0.4001      0.3542      0.4050
## 5       0.3206      0.3841      0.3934      0.3817      0.3864      0.3987
## 6       0.2866      0.3567      0.3723      0.3757      0.3799      0.4278
## 7       0.2866      0.3567      0.3832      0.3808      0.3510      0.4681
## 8       0.3340      0.3709      0.4215      0.3787      0.4191      0.4681
## 9       0.3205      0.4144      0.4215      0.4099      0.3900      0.4615
## 10      0.3256      0.4278      0.4363      0.4085      0.4115      0.4615
##    X2000.05.24 X2000.06.09 X2000.06.25 X2000.07.11
## 1       0.4644      0.4777      0.4730      0.4220
## 2       0.4704      0.4777      0.4730      0.4289
## 3       0.4698      0.4574      0.4340      0.4532
## 4       0.4596      0.4574      0.4636      0.4228
## 5       0.4522      0.4193      0.4636      0.4517
## 6       0.4493      0.4538      0.4091      0.4160
## 7       0.4043      0.4913      0.4730      0.4359
## 8       0.4885      0.4913      0.4616      0.4300
## 9       0.4318      0.4589      0.4908      0.4363
## 10      0.4212      0.4413      0.4697      0.4489&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So each date is a column and each cell in space is a row in our data frame. This isn’t ideal for plotting so let’s reshape the data into long format.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;rownames(dat) &amp;lt;- paste0(&amp;quot;A&amp;quot;,1:20) #Add dummy column labels

dat &amp;lt;- as.data.frame(t(dat)) #transpose data.frame

dat$Date &amp;lt;- as.Date(rownames(dat), format = &amp;quot;X%Y.%m.%d&amp;quot;)

dat &amp;lt;- melt(dat, id=c(&amp;quot;Date&amp;quot;))

head(dat)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##         Date variable  value
## 1 2000-02-18       A1 0.2889
## 2 2000-03-05       A1 0.3280
## 3 2000-03-21       A1 0.3723
## 4 2000-04-06       A1 0.3743
## 5 2000-04-22       A1 0.3979
## 6 2000-05-08       A1 0.3902&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s make some pretty pictures!&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(data = dat, aes(x = Date, y = value, colour = variable)) + geom_line()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-15-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Pretty neat! It looks like our site burnt in the summer of 2000/2001. Now let’s split them up.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(data = dat, aes(x = Date, y = value, colour = variable)) + geom_line() + facet_wrap(~variable)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-16-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Well there’s definitely clear seasonality and, while subtle, there are differences among the cells. What do we see with…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;landsat&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Landsat&lt;/h2&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;First we read in the full record of data for Landsat 8 for our area of interest.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;lsNDVI &amp;lt;- stack(paste0(datwd,&amp;quot;Landsat/2017045_v1_LC8_L1T_TOA_Jonaskop_daily__2013-04-15-2017-03-25.tif&amp;quot;)) #note that I have used LC8 (LandSat 8)
lsNDVI&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## class       : RasterStack 
## dimensions  : 114, 157, 17898, 154  (nrow, ncol, ncell, nlayers)
## resolution  : 30, 30  (x, y)
## extent      : 361320, 366030, 6242370, 6245790  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=34 +south +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## names       : X2017045_//17.03.25.1, X2017045_//17.03.25.2, X2017045_//17.03.25.3, X2017045_//17.03.25.4, X2017045_//17.03.25.5, X2017045_//17.03.25.6, X2017045_//17.03.25.7, X2017045_//17.03.25.8, X2017045_//17.03.25.9, X2017045_//7.03.25.10, X2017045_//7.03.25.11, X2017045_//7.03.25.12, X2017045_//7.03.25.13, X2017045_//7.03.25.14, X2017045_//7.03.25.15, ... 
## min values  :                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768,                -32768, ... 
## max values  :                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767,                 32767, ...&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Then the metadata with dates.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;metdat2 &amp;lt;- read.delim(paste0(datwd,&amp;quot;Landsat/LC8_L1T_TOA_metadata.txt&amp;quot;), sep = &amp;quot; &amp;quot;, header = F) 
head(metdat2) #first few rows of metdat&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##   V1         V2
## 1 0: 2013-04-15
## 2 1: 2013-04-22
## 3 2: 2013-05-17
## 4 3: 2013-05-24
## 5 4: 2013-06-09
## 6 5: 2013-06-18&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;tail(metdat2) #last few rows of metdat (our data goes up to 25th march, 2017)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##       V1         V2
## 149 148: 2017-02-12
## 150 149: 2017-02-21
## 151 150: 2017-02-28
## 152 151: 2017-03-09
## 153 152: 2017-03-16
## 154 153: 2017-03-25&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Extract the dates, embed into the raster and have a look at the first scene.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;date2 &amp;lt;- substr(metdat2[,2], start = 0, stop = 10) #will extract YYYY_MM_DD
names(lsNDVI) &amp;lt;- date2 #assign the date to the &amp;#39;names&amp;#39; of each NDVI value
plot(lsNDVI[[1]]) &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-19-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Looks good, but the scale’s all wrong again, so we need to fix the gain and offset&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;NAvalue(lsNDVI)=0
offs(lsNDVI)=-1.5
gain(lsNDVI)=.001
plot(lsNDVI[[1]])
plot(site, add=T)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-20-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Better! But still suspiscious… Note that I hacked the offset at -1.5 (it’s usually 2) I’ll need to recheck what the gain and offset values should be and fix this later…&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s zoom in on our focal site&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;lsNDVI &amp;lt;- crop(lsNDVI, site, snap = &amp;quot;out&amp;quot;) #&amp;quot;snap=&amp;quot;out&amp;quot;&amp;quot; adds a buffer around the site

plot(lsNDVI[[1]])
plot(site, add=T)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-21-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now let’s have a look at the variation in both space and time.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;plot(lsNDVI)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-22-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Lots of errors because of NA’s! It looks like some scenes are empty, while others are dominated by cloud (we applied a cloud masking algorithm in GEE). We’ll need to get rid of these. Note that this isn’t a problem with the MODIS data, because the MODIS data are an 8-day composite based on 2 scenes per day (i.e the choice of 16 scenes to make up one complete one). We can easily exclude the blank Landsat scenes by identifying those with NA values only (if the minimum or maximum value is NA, then there are no values other than NA).&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;metdat2 &amp;lt;- metdat2[-which(is.na(minValue(lsNDVI))),] #Drop empty scenes from metadata
lsNDVI &amp;lt;- lsNDVI[[-which(is.na(minValue(lsNDVI)))]] #Drop empty scenes from rasterStack&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Now we can look at variation through time using an animation as we did before. Note that in the previous plots the colour range varies. For the animation we need to set a fixed colour range so that a particular shade of green or yellow represents the same value across scenes. For the Landsat data these range from 0.255 to 0.555&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;if(!file.exists(&amp;quot;/Users/jasper/GIT/jslingsby.github.io_local/static/img/output/lsNDVI.gif&amp;quot;)) { # Check if the file exists
  saveGIF({
    for (i in 1:dim(lsNDVI)[3]) plot(lsNDVI[[i]],
                      main=names(lsNDVI)[i],
                      legend.lab=&amp;quot;NDVI&amp;quot;,
                      col=rev(terrain.colors(length(c(seq(min(minValue(lsNDVI)),max(maxValue(lsNDVI)),.01),1)))),
                      breaks=seq(min(minValue(lsNDVI)),max(maxValue(lsNDVI)),.01))}, 
    movie.name = &amp;quot;/Users/jasper/GIT/jslingsby.github.io_local/static/img/output/lsNDVI.gif&amp;quot;, 
    ani.width = 600, ani.height = 500, 
    interval=.25)
}&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;/img/output/lsNDVI.gif&#34; /&gt;

&lt;/div&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Looks like there’s generally lower NDVI in the lower righthand corner parhaps?&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Let’s look at some time-series graphs. First the data wrangling, then plotting; following just about the same formula as for the MODIS data.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ldat &amp;lt;- as.data.frame(lsNDVI)

#ldat[1:10,1:10] #look at the data

rownames(ldat) &amp;lt;- paste0(1:nrow(ldat)) #dummy column labels

ldat &amp;lt;- as.data.frame(t(ldat)) #transpose data.frame

ldat$Date &amp;lt;- as.Date(rownames(ldat), format = &amp;quot;X%Y.%m.%d&amp;quot;)

ldat &amp;lt;- melt(ldat, id=c(&amp;quot;Date&amp;quot;))

colnames(ldat)&amp;lt;- c(&amp;quot;Date&amp;quot;,&amp;quot;Pixel.Number&amp;quot;,&amp;quot;NDVI.Value&amp;quot;)

#head(ldat)

NDVIplot2 &amp;lt;- ggplot(data = ldat, aes(x = Date, y = NDVI.Value, colour = Pixel.Number)) + geom_line() + theme(legend.position=&amp;quot;none&amp;quot;) #remove legend as plot space cannot accommodate it - there are &amp;gt;800 pixels!

NDVIplot2 &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-25-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So we still pick up some nice seasonality! Note this is “zoom in” on just the last ~4 years. It is a bit messy with all &amp;gt;800 pixels though, so let’s select just a few.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;Converting a rasterStack into a data.frame fills the dataframe with raster cell values by row from left to right and numbers them. We know there are 28 rows and 31 columns (= 868 pixels), so we can use this to sample cells of interest.&lt;/p&gt;
&lt;p&gt;This is how the grid is numbered:&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;matrix(1:868, 28, 31, byrow = T)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
##  [1,]    1    2    3    4    5    6    7    8    9    10    11    12    13
##  [2,]   32   33   34   35   36   37   38   39   40    41    42    43    44
##  [3,]   63   64   65   66   67   68   69   70   71    72    73    74    75
##  [4,]   94   95   96   97   98   99  100  101  102   103   104   105   106
##  [5,]  125  126  127  128  129  130  131  132  133   134   135   136   137
##  [6,]  156  157  158  159  160  161  162  163  164   165   166   167   168
##  [7,]  187  188  189  190  191  192  193  194  195   196   197   198   199
##  [8,]  218  219  220  221  222  223  224  225  226   227   228   229   230
##  [9,]  249  250  251  252  253  254  255  256  257   258   259   260   261
## [10,]  280  281  282  283  284  285  286  287  288   289   290   291   292
## [11,]  311  312  313  314  315  316  317  318  319   320   321   322   323
## [12,]  342  343  344  345  346  347  348  349  350   351   352   353   354
## [13,]  373  374  375  376  377  378  379  380  381   382   383   384   385
## [14,]  404  405  406  407  408  409  410  411  412   413   414   415   416
## [15,]  435  436  437  438  439  440  441  442  443   444   445   446   447
## [16,]  466  467  468  469  470  471  472  473  474   475   476   477   478
## [17,]  497  498  499  500  501  502  503  504  505   506   507   508   509
## [18,]  528  529  530  531  532  533  534  535  536   537   538   539   540
## [19,]  559  560  561  562  563  564  565  566  567   568   569   570   571
## [20,]  590  591  592  593  594  595  596  597  598   599   600   601   602
## [21,]  621  622  623  624  625  626  627  628  629   630   631   632   633
## [22,]  652  653  654  655  656  657  658  659  660   661   662   663   664
## [23,]  683  684  685  686  687  688  689  690  691   692   693   694   695
## [24,]  714  715  716  717  718  719  720  721  722   723   724   725   726
## [25,]  745  746  747  748  749  750  751  752  753   754   755   756   757
## [26,]  776  777  778  779  780  781  782  783  784   785   786   787   788
## [27,]  807  808  809  810  811  812  813  814  815   816   817   818   819
## [28,]  838  839  840  841  842  843  844  845  846   847   848   849   850
##       [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24]
##  [1,]    14    15    16    17    18    19    20    21    22    23    24
##  [2,]    45    46    47    48    49    50    51    52    53    54    55
##  [3,]    76    77    78    79    80    81    82    83    84    85    86
##  [4,]   107   108   109   110   111   112   113   114   115   116   117
##  [5,]   138   139   140   141   142   143   144   145   146   147   148
##  [6,]   169   170   171   172   173   174   175   176   177   178   179
##  [7,]   200   201   202   203   204   205   206   207   208   209   210
##  [8,]   231   232   233   234   235   236   237   238   239   240   241
##  [9,]   262   263   264   265   266   267   268   269   270   271   272
## [10,]   293   294   295   296   297   298   299   300   301   302   303
## [11,]   324   325   326   327   328   329   330   331   332   333   334
## [12,]   355   356   357   358   359   360   361   362   363   364   365
## [13,]   386   387   388   389   390   391   392   393   394   395   396
## [14,]   417   418   419   420   421   422   423   424   425   426   427
## [15,]   448   449   450   451   452   453   454   455   456   457   458
## [16,]   479   480   481   482   483   484   485   486   487   488   489
## [17,]   510   511   512   513   514   515   516   517   518   519   520
## [18,]   541   542   543   544   545   546   547   548   549   550   551
## [19,]   572   573   574   575   576   577   578   579   580   581   582
## [20,]   603   604   605   606   607   608   609   610   611   612   613
## [21,]   634   635   636   637   638   639   640   641   642   643   644
## [22,]   665   666   667   668   669   670   671   672   673   674   675
## [23,]   696   697   698   699   700   701   702   703   704   705   706
## [24,]   727   728   729   730   731   732   733   734   735   736   737
## [25,]   758   759   760   761   762   763   764   765   766   767   768
## [26,]   789   790   791   792   793   794   795   796   797   798   799
## [27,]   820   821   822   823   824   825   826   827   828   829   830
## [28,]   851   852   853   854   855   856   857   858   859   860   861
##       [,25] [,26] [,27] [,28] [,29] [,30] [,31]
##  [1,]    25    26    27    28    29    30    31
##  [2,]    56    57    58    59    60    61    62
##  [3,]    87    88    89    90    91    92    93
##  [4,]   118   119   120   121   122   123   124
##  [5,]   149   150   151   152   153   154   155
##  [6,]   180   181   182   183   184   185   186
##  [7,]   211   212   213   214   215   216   217
##  [8,]   242   243   244   245   246   247   248
##  [9,]   273   274   275   276   277   278   279
## [10,]   304   305   306   307   308   309   310
## [11,]   335   336   337   338   339   340   341
## [12,]   366   367   368   369   370   371   372
## [13,]   397   398   399   400   401   402   403
## [14,]   428   429   430   431   432   433   434
## [15,]   459   460   461   462   463   464   465
## [16,]   490   491   492   493   494   495   496
## [17,]   521   522   523   524   525   526   527
## [18,]   552   553   554   555   556   557   558
## [19,]   583   584   585   586   587   588   589
## [20,]   614   615   616   617   618   619   620
## [21,]   645   646   647   648   649   650   651
## [22,]   676   677   678   679   680   681   682
## [23,]   707   708   709   710   711   712   713
## [24,]   738   739   740   741   742   743   744
## [25,]   769   770   771   772   773   774   775
## [26,]   800   801   802   803   804   805   806
## [27,]   831   832   833   834   835   836   837
## [28,]   862   863   864   865   866   867   868&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;So let’s take a few from the bottom right (where the NDVI is generally low):&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;lowc &amp;lt;- c(614, 617, 707, 710)
highc &amp;lt;- c(128, 131, 221, 224)

lowdat &amp;lt;- subset(ldat, Pixel.Number%in%lowc)
highdat &amp;lt;- subset(ldat, Pixel.Number%in%highc)

NDVIplot_low &amp;lt;- ggplot(data = lowdat, aes(x = Date, y = NDVI.Value, colour = Pixel.Number)) + geom_line() #+ theme(legend.position=&amp;quot;none&amp;quot;) #remove legend as plot space cannot accommodate it - there are &amp;gt;800 pixels!

NDVIplot_low &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-27-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;And a few from the top left (where the NDVI is generally high):&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;NDVIplot_high &amp;lt;- ggplot(data = highdat, aes(x = Date, y = NDVI.Value, colour = Pixel.Number)) + geom_line() #+ theme(legend.position=&amp;quot;none&amp;quot;) #remove legend as plot space cannot accommodate it - there are &amp;gt;800 pixels!

NDVIplot_high&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2017-04-03-modis-primer-for-hannah_files/figure-html/unnamed-chunk-28-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>